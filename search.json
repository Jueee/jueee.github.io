[{"title":"搭建 Jekyll 环境","url":"/2020/06/2020-06-17-%E6%90%AD%E5%BB%BAJekyll%E7%8E%AF%E5%A2%83/","content":"<p>需要搭建 Jekyll 环境，通过遵循 Jekyll 的规范，让 Jekyll 帮助我们生成静态网站。</p>\n<ol>\n<li><p>安装 Ruby：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVieS1sYW5nLm9yZy96aF9jbi9kb2N1bWVudGF0aW9uL2luc3RhbGxhdGlvbi8=\">Ruby 安装教程<i class=\"fa fa-external-link-alt\"></i></span>、<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ydWJ5aW5zdGFsbGVyLm9yZy9kb3dubG9hZHMv\">Windows 下载<i class=\"fa fa-external-link-alt\"></i></span></p>\n</li>\n<li><p>打开 CMD，执行命令安装 Jekyll：</p>\n<pre class=\"language-none\"><code class=\"language-none\">gem install jekyll</code></pre>\n</li>\n<li><p>进入仓库文件夹，执行命令：</p>\n<pre class=\"language-none\"><code class=\"language-none\">bundle install</code></pre>\n\n</li>\n</ol>\n<h3 id=\"目录结构\"><a href=\"#目录结构\" class=\"headerlink\" title=\"目录结构\"></a>目录结构</h3><p>每个目录的作用：</p>\n<table>\n<thead>\n<tr>\n<th>文件 / 目录</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>_config.yml</code></td>\n<td>保存<span class=\"exturl\" data-url=\"aHR0cDovL2pla3lsbGNuLmNvbS9kb2NzL2NvbmZpZ3VyYXRpb24v\">配置<i class=\"fa fa-external-link-alt\"></i></span>数据。很多配置选项都可以直接在命令行中进行设置，但是如果你把那些配置写在这儿，你就不用非要去记住那些命令了。</td>\n</tr>\n<tr>\n<td><code>_drafts</code></td>\n<td>drafts（草稿）是未发布的文章。这些文件的格式中都没有 <code>title.MARKUP</code> 数据。学习如何 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmppYW5zaHUuY29tLz90PWh0dHA6Ly9qZWt5bGxjbi5jb20vZG9jcy9kcmFmdHMv\">使用草稿<i class=\"fa fa-external-link-alt\"></i></span>.</td>\n</tr>\n<tr>\n<td><code>_includes</code></td>\n<td>你可以加载这些包含部分到你的布局或者文章中以方便重用。可以用这个标签 <code>{% include file.ext %}</code> 来把文件 <code>_includes/file.ext</code> 包含进来。</td>\n</tr>\n<tr>\n<td><code>_layouts</code></td>\n<td>layouts（布局）是包裹在文章外部的模板。布局可以在 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmppYW5zaHUuY29tLz90PWh0dHA6Ly9qZWt5bGxjbi5jb20vZG9jcy9mcm9udG1hdHRlci8=\">YAML 头信息<i class=\"fa fa-external-link-alt\"></i></span>中根据不同文章进行选择。 这将在下一个部分进行介绍。</td>\n</tr>\n<tr>\n<td><code>_posts</code></td>\n<td>这里放的就是你的文章了。文件格式很重要，必须要符合:<code>YEAR-MONTH-DAY-title.MARKUP</code>。 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmppYW5zaHUuY29tLz90PWh0dHA6Ly9qZWt5bGxjbi5jb20vZG9jcy9wZXJtYWxpbmtzLw==\">永久链接<i class=\"fa fa-external-link-alt\"></i></span> 可以在文章中自己定制，但是数据和标记语言都是根据文件名来确定的。</td>\n</tr>\n<tr>\n<td><code>_data</code></td>\n<td>格式化好的网站数据应放在这里。jekyll 的引擎会自动加载在该目录下所有的 yaml 文件（后缀是 <code>.yml</code>, <code>.yaml</code>, <code>.json</code> 或者 <code>.csv</code> ）。这些文件可以经由 ｀site.data｀ 访问。如果有一个 <code>members.yml</code> 文件在该目录下，你就可以通过 <code>site.data.members</code> 获取该文件的内容。</td>\n</tr>\n<tr>\n<td><code>_site</code></td>\n<td>一旦 Jekyll 完成转换，就会将生成的页面放在这里（默认）。最好将这个目录放进你的 <code>.gitignore</code> 文件中。</td>\n</tr>\n<tr>\n<td><code>.jekyll-metadata</code></td>\n<td>该文件帮助 Jekyll 跟踪哪些文件从上次建立站点开始到现在没有被修改，哪些文件需要在下一次站点建立时重新生成。该文件不会被包含在生成的站点中。将它加入到你的 <code>.gitignore</code> 文件可能是一个好注意。</td>\n</tr>\n<tr>\n<td><code>index.html</code> and other HTML, Markdown, Textile files</td>\n<td> 如果这些文件中包含 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmppYW5zaHUuY29tLz90PWh0dHA6Ly9qZWt5bGxjbi5jb20vZG9jcy9mcm9udG1hdHRlci8=\">YAML 头信息<i class=\"fa fa-external-link-alt\"></i></span> 部分，Jekyll 就会自动将它们进行转换。当然，其他的如 <code>.html</code>, <code>.markdown</code>, <code>.md</code>, 或者 <code>.textile</code> 等在你的站点根目录下或者不是以上提到的目录中的文件也会被转换。</td>\n</tr>\n<tr>\n<td>Other Files/Folders</td>\n<td> 其他一些未被提及的目录和文件如 <code>css</code> 还有 <code>images</code> 文件夹， <code>favicon.ico</code> 等文件都将被完全拷贝到生成的 site 中。这里有一些<span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmppYW5zaHUuY29tLz90PWh0dHA6Ly9qZWt5bGxjbi5jb20vZG9jcy9zaXRlcy8=\">使用 Jekyll 的站点<i class=\"fa fa-external-link-alt\"></i></span>，如果你感兴趣就来看看吧。</td>\n</tr>\n</tbody></table>\n<h3 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h3><ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2pla3lsbGNuLmNvbS9kb2NzL3RlbXBsYXRlcy8=\">jekyll 模板<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9saXF1aWQuYm9vdGNzcy5jb20v\">Liquid 模板语言<i class=\"fa fa-external-link-alt\"></i></span></li>\n</ul>\n<h3 id=\"问题处理\"><a href=\"#问题处理\" class=\"headerlink\" title=\"问题处理\"></a>问题处理</h3><h4 id=\"问题一\"><a href=\"#问题一\" class=\"headerlink\" title=\"问题一\"></a>问题一</h4><blockquote>\n<p><code>bundle install</code> 提示 <code>Could not locate Gemfile</code></p>\n</blockquote>\n<p>原因：项目下缺少 <code>Gemfile</code> 文件。</p>\n<p>解决：<code>jekyll new myblog</code> 创建项目，将  <code>Gemfile</code> 文件拷贝过来。</p>\n<h4 id=\"问题二\"><a href=\"#问题二\" class=\"headerlink\" title=\"问题二\"></a>问题二</h4><blockquote>\n<p>Dependency Error: Yikes! It looks like you don't have jekyll-sitemap or one of its dependencies installed.</p>\n</blockquote>\n<p>解决：在 <code>Gemfile</code> 文件中增加如下内容：</p>\n<pre class=\"language-none\"><code class=\"language-none\">gem 'jekyll-sitemap'\ngem 'jekyll-paginate' </code></pre>\n\n<h4 id=\"问题三\"><a href=\"#问题三\" class=\"headerlink\" title=\"问题三\"></a>问题三</h4><blockquote>\n<p>Liquid Exception: Could not locate the included file 'file.ext' in any of [\"E:/code/GitHub/Jueee/jueee.github.io/_includes\"]. Ensure it exists in one of those directories and, if it is a symlink, does not point outside your site source.</p>\n</blockquote>\n","categories":["Blog"],"tags":["Ruby","Blog","jekyll"]},{"title":"为 Jekyll 博客系统增加百度统计","url":"/2020/06/2020-06-19-%E4%B8%BAJekyll%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E5%A2%9E%E5%8A%A0%E7%99%BE%E5%BA%A6%E7%BB%9F%E8%AE%A1/","content":"<p>百度统计是网站用户行为分析平台，为 Jekyll 博客系统接入百度统计，可以很方便的查看博客的各种访问、统计数据。</p>\n<h3 id=\"百度统计\"><a href=\"#百度统计\" class=\"headerlink\" title=\"百度统计\"></a>百度统计</h3><p>官网介绍</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly90b25namkuYmFpZHUuY29tL3dlYi93ZWxjb21lL2xvZ2lu\">https://tongji.baidu.com/web/welcome/login<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<h3 id=\"域名设置\"><a href=\"#域名设置\" class=\"headerlink\" title=\"域名设置\"></a>域名设置</h3><p>在网站列表中，设置个人域名。</p>\n<h3 id=\"代码设置\"><a href=\"#代码设置\" class=\"headerlink\" title=\"代码设置\"></a>代码设置</h3><p>在 <code>_config.yml</code> 文件中添加：</p>\n<pre class=\"language-none\"><code class=\"language-none\">baidu_tmid: d11c8b9bc802239c2cc46ff39d3faf79</code></pre>\n\n<p>在 <code>footer.html</code> 文件中添加：</p>\n<pre class=\"language-html\" data-language=\"html\"><code class=\"language-html\">{% raw %}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n<span class=\"token keyword\">var</span> _hmt <span class=\"token operator\">=</span> _hmt <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">var</span> hm <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"script\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   hm<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">\"https://hm.baidu.com/hm.js?{{site.baidu_tmid}}\"</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">var</span> s <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTagName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"script\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> \n   s<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span>hm<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>{% endraw %}</code></pre>\n\n","categories":["Blog"],"tags":["Blog","Baidu"]},{"title":"为 Jekyll 博客系统增加来必力评论系统","url":"/2020/07/2020-07-01-%E4%B8%BAJekyll%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E5%A2%9E%E5%8A%A0%E6%9D%A5%E5%BF%85%E5%8A%9B%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F/","content":"<p>来必力（LiveRe）是韩国的产品。是一款通过链接社交网站账户，免去额外的注册过程的社会化评论系统。</p>\n<p>来必力安装简单、使用方便、UI 美观，同时支持所有的主流社交网络，以及评论管理、通知等功能，深受国内外互联网用户的欢迎。</p>\n<p>该产品主要分为中文、英文、韩文三个版本，用户可以根据语言选择对应的版本。</p>\n<h3 id=\"来必力（LiveRe）\"><a href=\"#来必力（LiveRe）\" class=\"headerlink\" title=\"来必力（LiveRe）\"></a>来必力（LiveRe）</h3><p>官网介绍</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGl2ZXJlLmNvbS8=\">https://www.livere.com/<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<p>核心功能：</p>\n<ul>\n<li>使用社交网站账户登录，免去注册过程。</li>\n<li>提高用户的参与和沟通意愿。</li>\n<li>管理 / 删除我的评论内容。</li>\n<li>提供管理页面，管理网站文章及评论内容。</li>\n</ul>\n<h3 id=\"域名设置\"><a href=\"#域名设置\" class=\"headerlink\" title=\"域名设置\"></a>域名设置</h3><p>在网站列表中，设置个人域名。</p>\n<h3 id=\"代码设置\"><a href=\"#代码设置\" class=\"headerlink\" title=\"代码设置\"></a>代码设置</h3><p>在 <code>_config.yml</code> 文件中添加：</p>\n<pre class=\"language-none\"><code class=\"language-none\"># Support for LiveRe comments system.\n# You can get your uid from https://livere.com/insight/myCode (General web site)\nlivere_uid: MTAyMC81MDgwMC8yNzI4Mg==</code></pre>\n\n<p>参考 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGl2ZXJlLmNvbS9pbnNpZ2h0L215Q29kZSVFRiVCQyU4QyVFNSU5QyVBOA==\">https://www.livere.com/insight/myCode，在<i class=\"fa fa-external-link-alt\"></i></span> <code>post.html</code> 文件中添加：</p>\n<pre class=\"language-html\" data-language=\"html\"><code class=\"language-html\">{% raw %}<span class=\"token comment\">&lt;!-- 来必力City版安装代码 --&gt;</span>\n<p><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lv-container<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">data-id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>city<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">data-uid</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{site.livere_uid}}<span class=\"token punctuation\">\"</span></span><span class=\"token style-attr language-css\"><span class=\"token attr-name\">  <span class=\"token attr-name\">style</span></span><span class=\"token punctuation\">=\"</span><span class=\"token attr-value\"><span class=\"token property\">padding-right</span><span class=\"token punctuation\">:</span> 10%<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><br><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\"><br>  <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">d<span class=\"token punctuation\">,</span> s</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><br>     <span class=\"token keyword\">var</span> j<span class=\"token punctuation\">,</span> e <span class=\"token operator\">=</span> d<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTagName</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></span></span></p>\n<pre><code> &lt;span class=\"token keyword\"&gt;if&lt;/span&gt; &lt;span class=\"token punctuation\"&gt;(&lt;/span&gt;&lt;span class=\"token keyword\"&gt;typeof&lt;/span&gt; LivereTower &lt;span class=\"token operator\"&gt;===&lt;/span&gt; &lt;span class=\"token string\"&gt;'function'&lt;/span&gt;&lt;span class=\"token punctuation\"&gt;)&lt;/span&gt; &lt;span class=\"token punctuation\"&gt;&amp;#123;&lt;/span&gt; &lt;span class=\"token keyword\"&gt;return&lt;/span&gt;&lt;span class=\"token punctuation\"&gt;;&lt;/span&gt; &lt;span class=\"token punctuation\"&gt;&amp;#125;&lt;/span&gt;\n\n j &lt;span class=\"token operator\"&gt;=&lt;/span&gt; d&lt;span class=\"token punctuation\"&gt;.&lt;/span&gt;&lt;span class=\"token function\"&gt;createElement&lt;/span&gt;&lt;span class=\"token punctuation\"&gt;(&lt;/span&gt;s&lt;span class=\"token punctuation\"&gt;)&lt;/span&gt;&lt;span class=\"token punctuation\"&gt;;&lt;/span&gt;\n j&lt;span class=\"token punctuation\"&gt;.&lt;/span&gt;src &lt;span class=\"token operator\"&gt;=&lt;/span&gt; &lt;span class=\"token string\"&gt;'https://cdn-city.livere.com/js/embed.dist.js'&lt;/span&gt;&lt;span class=\"token punctuation\"&gt;;&lt;/span&gt;\n j&lt;span class=\"token punctuation\"&gt;.&lt;/span&gt;async &lt;span class=\"token operator\"&gt;=&lt;/span&gt; &lt;span class=\"token boolean\"&gt;true&lt;/span&gt;&lt;span class=\"token punctuation\"&gt;;&lt;/span&gt;\n\n e&lt;span class=\"token punctuation\"&gt;.&lt;/span&gt;parentNode&lt;span class=\"token punctuation\"&gt;.&lt;/span&gt;&lt;span class=\"token function\"&gt;insertBefore&lt;/span&gt;&lt;span class=\"token punctuation\"&gt;(&lt;/span&gt;j&lt;span class=\"token punctuation\"&gt;,&lt;/span&gt; e&lt;span class=\"token punctuation\"&gt;)&lt;/span&gt;&lt;span class=\"token punctuation\"&gt;;&lt;/span&gt;</code></pre>\n</code><p><code class=\"language-html\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">,</span> <span class=\"token string\">'script'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span><br><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>noscript</span><span class=\"token punctuation\">&gt;</span></span>为正常使用来必力评论功能请激活JavaScript<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>noscript</span><span class=\"token punctuation\">&gt;</span></span><br><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span><br><span class=\"token comment\">&lt;!-- City版安装代码已完成 --&gt;</span>{% endraw %}</code></p></pre>:hexoPostRenderEscape--&gt;<p></p>\n","categories":["Blog"],"tags":["Blog","LiveRe"]},{"title":"jekyll 使用中文路径","url":"/2020/07/2020-07-08-jekyll%E4%BD%BF%E7%94%A8%E4%B8%AD%E6%96%87%E8%B7%AF%E5%BE%84/","content":"<h2 id=\"出现问题\"><a href=\"#出现问题\" class=\"headerlink\" title=\"出现问题\"></a>出现问题</h2><p>在使用 jekyll 在本地预览自己写的博客无法正常打开，而提交到 github 上却可以正常解析。</p>\n<p>看了一下，发现原来是因为博客的 markdown 文件使用了中文文件名，jekyll 无法正常解析出现乱码。</p>\n<h2 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h2><p>修改 安装目录 <code>Ruby26-x64\\lib\\ruby\\2.6.0\\webrick\\httpservlet</code> 下的 <code>filehandler.rb</code> 文件，建议先备份。</p>\n<p>找到下列两处，添加一句（+ 的一行为添加部分）</p>\n<p>第 285 行： </p>\n<pre class=\"language-ruby\" data-language=\"ruby\"><code class=\"language-ruby\">path <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>path_info<span class=\"token punctuation\">.</span>dup<span class=\"token punctuation\">.</span>force_encoding<span class=\"token punctuation\">(</span><span class=\"token constant\">Encoding</span><span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token string\">\"filesystem\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">+</span> path<span class=\"token punctuation\">.</span>force_encoding<span class=\"token punctuation\">(</span><span class=\"token string\">\"UTF-8\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 加入编码</span>\n<span class=\"token keyword\">if</span> trailing_pathsep<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>path_info<span class=\"token punctuation\">)</span>       </code></pre>\n<p>第 333 行：</p>\n<pre class=\"language-ruby\" data-language=\"ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">break</span> <span class=\"token keyword\">if</span> base <span class=\"token operator\">==</span> <span class=\"token string\">\"/\"</span>\n<span class=\"token operator\">+</span> base<span class=\"token punctuation\">.</span>force_encoding<span class=\"token punctuation\">(</span><span class=\"token string\">\"UTF-8\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#加入編碼</span>\n<span class=\"token keyword\">break</span> <span class=\"token keyword\">unless</span> <span class=\"token builtin\">File</span><span class=\"token punctuation\">.</span>directory<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">File</span><span class=\"token punctuation\">.</span>expand_path<span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>filename <span class=\"token operator\">+</span> base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  </code></pre>\n\n<p>修改完重新 jekyll serve 即可支持中文文件名。</p>\n","categories":["Blog"],"tags":["Ruby","Blog","jekyll"]},{"title":"模板 List 分两列展示","url":"/2020/07/2020-07-06-%E6%A8%A1%E6%9D%BFList%E5%88%86%E4%B8%A4%E5%88%97%E5%B1%95%E7%A4%BA/","content":"<p>使用 freeMarker 的机会有很多，自然也就会接触下 <code>&lt;List&gt;</code> 标签，我想大家应该都不陌生。</p>\n<p><code>&lt;#list attrList as attr&gt;${a.name}&lt;/#list&gt;</code> 类似的用法很多，但是偶尔会用到两列的展示效果我们改怎么办呢？</p>\n<p>我们可以根据模型中的 int 类型的某一列，一般是自动增长的 id 标识列。</p>\n<h3 id=\"freemarker-模板语言\"><a href=\"#freemarker-模板语言\" class=\"headerlink\" title=\"freemarker 模板语言\"></a>freemarker 模板语言</h3><pre class=\"language-html\" data-language=\"html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>#list</span> <span class=\"token attr-name\">attrList</span> <span class=\"token attr-name\">as</span> <span class=\"token attr-name\">attr</span><span class=\"token punctuation\">&gt;</span></span>\n       &lt;#if attr_index%2 ==0&gt;\n        &lt;#if attr_index==0&gt;\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">&gt;</span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>#else</span><span class=\"token punctuation\">&gt;</span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">&gt;</span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>#if</span><span class=\"token punctuation\">&gt;</span></span>\n       <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>#if</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>118<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>${attr.key!}:<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">&gt;</span></span>${attr.value!}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">&gt;</span></span> \n    &lt;#if attr_index==attrList?size-1&gt;\n        &lt;#if attr_index%2 ==1&gt;\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">&gt;</span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>#else</span><span class=\"token punctuation\">&gt;</span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>118<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">&gt;</span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">&gt;</span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>#if</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>#if</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>#list</span><span class=\"token punctuation\">&gt;</span></span></code></pre>\n\n<h3 id=\"Liquid-模板语言\"><a href=\"#Liquid-模板语言\" class=\"headerlink\" title=\"Liquid 模板语言\"></a>Liquid 模板语言</h3><p>Liquid 是一门开源的模板语言，由 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2hvcGlmeS5jb20v\">Shopify<i class=\"fa fa-external-link-alt\"></i></span> 创造并用 Ruby 实现。它是 Shopify 主题的骨骼，并且被用于加载店铺系统的动态内容。</p>\n<pre class=\"language-html\" data-language=\"html\"><code class=\"language-html\">{% raw %}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>table</span> <span class=\"token punctuation\">&gt;</span></span>\n{% for post in site.gitpagelink %}\n{% assign index_2 = forloop.index | modulo: 2 %}\n    {% if index_2 == 1 %}\n        {% if forloop.index == 1 %} <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">&gt;</span></span> {% else %} <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">&gt;</span></span> {% endif %}\n    {% endif %}\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">&gt;</span></span>{{ post.name }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">&gt;</span></span>\n    {% if forloop.size == forloop.index %}\n        {% if index_2 == 0 %}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">&gt;</span></span>{% else %}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">&gt;</span></span>{% endif %}\n    {% endif %}\n{% endfor %}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>table</span><span class=\"token punctuation\">&gt;</span></span>\n{% endraw %}</code></pre>\n\n","categories":["HTML"],"tags":["HTML","freemarker","Liquid"]},{"title":"使用不蒜子增加 Jekyll 博客访问量统计","url":"/2020/07/2020-07-09-%E4%BD%BF%E7%94%A8%E4%B8%8D%E8%92%9C%E5%AD%90%E5%A2%9E%E5%8A%A0Jekyll%E5%8D%9A%E5%AE%A2%E8%AE%BF%E9%97%AE%E9%87%8F%E7%BB%9F%E8%AE%A1/","content":"<p>“不蒜子” 是一款极简的网页计数器，可以很方便的统计博客的总访问量和访问次数。</p>\n<p>“不蒜子” 与百度统计谷歌分析等有区别：“不蒜子” 可直接将访问次数显示在您在网页上（也可不显示）；对于已经上线一段时间的网站，“不蒜子” 允许您初始化首次数据。</p>\n<h3 id=\"不蒜子\"><a href=\"#不蒜子\" class=\"headerlink\" title=\"不蒜子\"></a>不蒜子</h3><p>官网介绍</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2J1c3VhbnppLmlicnVjZS5pbmZvLw==\">http://busuanzi.ibruce.info/<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<p>两行代码 搞定计数</p>\n<pre class=\"language-html\" data-language=\"html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">async</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>busuanzi_container_site_pv<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n    本站总访问量<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>busuanzi_value_site_pv<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span>次\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span></code></pre>\n\n<h3 id=\"安装标签\"><a href=\"#安装标签\" class=\"headerlink\" title=\"安装标签\"></a>安装标签</h3><p>只需要复制相应的 html 标签到你的网站要显示访问量的位置即可。</p>\n<p>您可以随意更改不蒜子标签为自己喜欢的显示效果，内容参考第三部分<strong>扩展开发</strong>。</p>\n<p>根据你要显示内容的不同，这分几种情况。</p>\n<h4 id=\"显示站点总访问量\"><a href=\"#显示站点总访问量\" class=\"headerlink\" title=\"显示站点总访问量\"></a>显示站点总访问量</h4><p>要显示站点总访问量，复制以下代码添加到你需要显示的位置。</p>\n<p>有两种算法可选：</p>\n<p>算法 a：pv 的方式，单个用户连续点击 n 篇文章，记录 n 次访问量。</p>\n<pre class=\"language-html\" data-language=\"html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>busuanzi_container_site_pv<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>    \n    本站总访问量<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>busuanzi_value_site_pv<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span>次\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span></code></pre>\n\n<p>算法 b：uv 的方式，单个用户连续点击 n 篇文章，只记录 1 次访客数。</p>\n<pre class=\"language-html\" data-language=\"html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>busuanzi_container_site_uv<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>  \n    本站访客数<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>busuanzi_value_site_uv<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span>人次\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span></code></pre>\n\n<h4 id=\"显示单页面访问量\"><a href=\"#显示单页面访问量\" class=\"headerlink\" title=\"显示单页面访问量\"></a>显示单页面访问量</h4><p>要显示每篇文章的访问量，复制以下代码添加到你需要显示的位置。</p>\n<p>算法：pv 的方式，单个用户点击 1 篇文章，本篇文章记录 1 次阅读量。</p>\n<pre class=\"language-html\" data-language=\"html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>busuanzi_container_page_pv<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>  \n    本文总阅读量<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>busuanzi_value_page_pv<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span>次\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span></code></pre>\n\n<h3 id=\"扩展开发\"><a href=\"#扩展开发\" class=\"headerlink\" title=\"扩展开发\"></a>扩展开发</h3><p>不蒜子之所以称为极客的算子，正是因为不蒜子自身只提供标签 + 数字，至于显示的 style 和 css 动画效果，任你发挥。</p>\n<p><code>busuanzi_value_site_pv</code> 的作用是异步回填访问数，这个 id 一定要正确。</p>\n<p><code>busuanzi_container_site_pv</code> 的作用是为防止计数服务访问出错或超时（3 秒）的情况下，使整个标签自动隐藏显示，带来更好的体验。这个 id 可以省略。</p>\n<p>因此，你也可以使用极简模式：</p>\n<pre class=\"language-html\" data-language=\"html\"><code class=\"language-html\">本站总访问量<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>busuanzi_value_site_pv<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span>次\n本站访客数<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>busuanzi_value_site_uv<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span>人次\n本文总阅读量<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>busuanzi_value_page_pv<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span>次</code></pre>\n\n<p>或者个性化一下：</p>\n<pre class=\"language-html\" data-language=\"html\"><code class=\"language-html\">Total <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>busuanzi_value_site_pv<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span> views.\n您是xxx的第<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>busuanzi_value_site_uv<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span>个小伙伴\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>busuanzi_value_page_pv<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span> Hits</code></pre>\n\n<h3 id=\"其他问题\"><a href=\"#其他问题\" class=\"headerlink\" title=\"其他问题\"></a>其他问题</h3><ol>\n<li><p>我只要统计不显示？</p>\n<p>只引入 busuanzi.js，不引入显示标签即可。</p>\n</li>\n<li><p>你的标签太丑了，我想美化一下可以么？</p>\n<p>可以的，您可以用自己站点的 css 进行控制，只要内层 span 的 id 正确以便回填访问次数即可，甚至标签都可以不是 span。</p>\n</li>\n<li><p>中文字体太丑了，我的主题不适合？</p>\n<p>您可以将本站总访问量 xxx 次改成 view xxx times 等英文以获得更和谐的显示效果。</p>\n</li>\n<li><p>在访问量数据未取回来之前，我不想让页面显示为诸如 “本站总访问量 次”，显得太 low，怎么办？</p>\n<p>只需要如下 css，不蒜子执行完毕会自动将标签显示出来，其他以此类推：</p>\n<pre class=\"language-html\" data-language=\"html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>busuanzi_container_site_pv<span class=\"token punctuation\">\"</span></span><span class=\"token style-attr language-css\"><span class=\"token attr-name\"> <span class=\"token attr-name\">style</span></span><span class=\"token punctuation\">='</span><span class=\"token attr-value\"><span class=\"token property\">display</span><span class=\"token punctuation\">:</span>none</span><span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">&gt;</span></span>\n 本站总访问量<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>busuanzi_value_site_pv<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span>次\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span></code></pre>\n\n\n</li>\n</ol>\n<p>   上面的做法还是很 low？！可以在没加载出来前就显示个菊花转转转:<br>   首先，你要引入 font-awesome 字体：</p>\n   <pre class=\"language-html\" data-language=\"html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n或\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span></code></pre>\n\n<p>   其次，修改不蒜子标签：</p>\n   <pre class=\"language-html\" data-language=\"html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>busuanzi_value_page_pv<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>i</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>fa fa-spinner<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>i</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span> Hits\n或（旋转效果）\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>busuanzi_value_page_pv<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>i</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>fa fa-spinner fa-spin<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>i</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span> Hits</code></pre>\n\n<p>   和谐多了！</p>\n<h3 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h3><ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2licnVjZS5pbmZvLzIwMTUvMDQvMDQvYnVzdWFuemkv\">http://ibruce.info/2015/04/04/busuanzi/<i class=\"fa fa-external-link-alt\"></i></span></li>\n</ul>\n","categories":["Blog"],"tags":["Blog"]},{"title":"使用 LFTP 进行 SFTP 文件上传与下载","url":"/2020/07/2020-07-14-%E4%BD%BF%E7%94%A8LFTP%E8%BF%9B%E8%A1%8CSFTP%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%B8%8E%E4%B8%8B%E8%BD%BD/","content":"<h3 id=\"工具介绍\"><a href=\"#工具介绍\" class=\"headerlink\" title=\"工具介绍\"></a>工具介绍</h3><p>LFTP 是一款非常著名的字符界面的文件传输工具。支持 FTP、HTTP、FISH、SFTP、HTTPS 和 FTPS 协议。</p>\n<h3 id=\"软件安装\"><a href=\"#软件安装\" class=\"headerlink\" title=\"软件安装\"></a>软件安装</h3><pre class=\"language-shell\" data-language=\"shell\"><code class=\"language-shell\">apt-cache search lftp\napt-get install lftp -y</code></pre>\n\n<h3 id=\"lftp-的使用\"><a href=\"#lftp-的使用\" class=\"headerlink\" title=\"lftp 的使用\"></a>lftp 的使用</h3><h4 id=\"使用语法\"><a href=\"#使用语法\" class=\"headerlink\" title=\"使用语法\"></a>使用语法</h4><ul>\n<li><code>lftp -[fceup] user:passwd@host</code>：passwd 可选，此方式密码明文保存，history 可查看 </li>\n<li><code>-f &lt;file&gt;</code>：执行文件中的命令后退出</li>\n<li><code>-c &lt;cmd&gt;</code>：执行命令后退出 </li>\n<li><code>-e &lt;cmd&gt;</code>：登录后后执行命令 </li>\n<li><code>-u &lt;user&gt;[,&lt;pass&gt;]</code>：使用指定的用户名 / 口令进行验证 </li>\n<li><code>-p &lt;port&gt;</code>：连接指定的端口，默认 21</li>\n</ul>\n<h4 id=\"常用命令\"><a href=\"#常用命令\" class=\"headerlink\" title=\"常用命令\"></a>常用命令</h4><ul>\n<li><code>cd</code>：切换 FTP 目录 </li>\n<li><code>lcd</code>：切换本地目录</li>\n<li><code>ls</code>：列出 FTP 目录文件</li>\n<li><code>!ls</code>：列出本地目录文件 </li>\n<li><code>find ./ -name file</code>：查找文件</li>\n<li><code>mv</code>：移动</li>\n<li><code>rm</code>：删除</li>\n<li><code>mkdir</code>：新建目录</li>\n<li><code>rmdir</code>：删除目录</li>\n</ul>\n<h4 id=\"上传下载文件\"><a href=\"#上传下载文件\" class=\"headerlink\" title=\"上传下载文件\"></a>上传下载文件</h4><ul>\n<li><p><code>get [cEaO] file -o newfilename</code>：下载文件</p>\n</li>\n<li><p><code>put [cEaO] file -o newfilename</code>：上传文件</p>\n</li>\n<li><p><code>pget -n</code>：多线程下载</p>\n<p>可选参数：</p>\n<ul>\n<li><code>-c</code>：支持断点续传 </li>\n<li><code>-E</code>：下载后删除远端文件</li>\n<li><code>-a</code>：指定传输为 ascii 模式，默认为二进制模式 </li>\n<li><code>-O</code>：指定存放目录</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"上传下载目录\"><a href=\"#上传下载目录\" class=\"headerlink\" title=\"上传下载目录\"></a>上传下载目录</h4><ul>\n<li><p><code>mirror [cRnr] remote [local]</code> </p>\n<p>可选参数： </p>\n<ul>\n<li><code>-c</code>：支持断点续传 </li>\n<li><code>-R</code>：上传整个目录 </li>\n<li><code>-n</code>：只下载较新的档案，可用于增量备份 </li>\n<li><code>-r</code>：只下载当前目录，不递归目录</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"书签管理\"><a href=\"#书签管理\" class=\"headerlink\" title=\"书签管理\"></a>书签管理</h4><ul>\n<li><code>bookmark add name</code>：保存当前连接为书签名字 name，下次打开可直接使用 lftp name</li>\n<li><code>bookmark del name</code>：删除书签</li>\n<li><code>bookmark list</code>：显示书签列表</li>\n<li><code>bookmark edit</code>：编辑书签</li>\n</ul>\n<h4 id=\"编码设置\"><a href=\"#编码设置\" class=\"headerlink\" title=\"编码设置\"></a>编码设置</h4><ul>\n<li><code>set ftp:charset \"gbk\"</code> </li>\n<li><code>set file:charset \"UTF-8\"</code> </li>\n<li>或加入配置文件<code>.lftp/rc</code></li>\n</ul>\n<h4 id=\"主动-被动模式\"><a href=\"#主动-被动模式\" class=\"headerlink\" title=\"主动/被动模式\"></a>主动 / 被动模式</h4><p>默认为被动模式 。</p>\n<p><code>set ftp:passive-mode no</code>：关闭被动模式转为主动模式</p>\n<p>主动客户端开启数据传输端口，被动服务端开启数据传输端口。</p>\n<h3 id=\"Shell脚本\"><a href=\"#Shell脚本\" class=\"headerlink\" title=\"Shell脚本\"></a>Shell 脚本</h3><h4 id=\"批量上传\"><a href=\"#批量上传\" class=\"headerlink\" title=\"批量上传\"></a>批量上传</h4><pre class=\"language-shell\" data-language=\"shell\"><code class=\"language-shell\">#!/bin/bash\n\n#SFTP配置信息\n#用户名\nUSER=root\n#密码\nPASSWORD=5EYS40T04BMF\n#待上传文件根目录\nSRCDIR=/u02/dab/sftpFiles\n#FTP目录\nDESDIR=/u01/sftpFiles\n#IP\nIP=192.168.10.11\n#端口\nPORT=22022\n\n#获取文件\ncd ${SRCDIR} ;\n#目录下的所有文件\n#FILES=`ls` \n#修改时间在执行时间五分钟之前的xml文件\nFILES=`find ${SRCDIR} -mmin -50 -name '*.xml'`\n\nfor FILE in ${FILES}\ndo\n    echo ${FILE}\n#发送文件 (关键部分）  复制出来，如有结尾有空格，请自行去掉\nlftp -u ${USER},${PASSWORD} sftp://${IP}:${PORT} &lt;&lt;EOF\ncd ${DESDIR}/\nlcd ${SRCDIR}\nput ${FILE}\nby\nEOF\n\ndone</code></pre>\n\n<h4 id=\"单文件下载\"><a href=\"#单文件下载\" class=\"headerlink\" title=\"单文件下载\"></a>单文件下载</h4><pre class=\"language-shell\" data-language=\"shell\"><code class=\"language-shell\">#!/bin/bash\n\nUSER=root\n#密码\nPASSWORD=5EYS40T04BMF\n#下载文件目录\nSRCDIR=/u02/dab\n#FTP目录(待下载文件目录)\nDESDIR=/u01/sftpFiles\n#银联IP\nIP=192.168.1.10\n#端口\nPORT=22022\n\nlftp -u ${USER},${PASSWORD} sftp://${IP}:${PORT}&lt;&lt;EOF\ncd ${DESDIR}\nlcd ${SRCDIR}\n#需要下载的文件为text.xml\nget text.xml\nby\nEOF</code></pre>\n\n","categories":["Linux","Shell"],"tags":["Linux","工具"]},{"title":"网页粒子背景插件 canvas-nest.js","url":"/2020/07/2020-07-10-%E7%BD%91%E9%A1%B5%E7%B2%92%E5%AD%90%E8%83%8C%E6%99%AF%E6%8F%92%E4%BB%B6canvas-nest.js/","content":"<p><strong>Canvas-nest.js 是一个非常好看的网页粒子背景插件，不需要依赖任何第三方库即可运行，提供额非常炫酷的背景。</strong></p>\n<h3 id=\"Canvas-nest-js\"><a href=\"#Canvas-nest-js\" class=\"headerlink\" title=\"Canvas-nest.js\"></a>Canvas-nest.js</h3><p>官网介绍</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2h1c3RjYy9jYW52YXMtbmVzdC5qcw==\">https://github.com/hustcc/canvas-nest.js<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<h4 id=\"特征\"><a href=\"#特征\" class=\"headerlink\" title=\"特征\"></a>特征</h4><ul>\n<li>它不依赖 jQuery，并且使用原始的 javascrpit。</li>\n<li>体积小巧，只有 2 Kb。</li>\n<li>易于实现，配置简单。</li>\n<li>您不必是 Web 开发人员即可使用它。</li>\n<li>使用区域渲染进行模块化。</li>\n</ul>\n<h3 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h3><p>使用非常简单，将下面的代码插入到 <code>&lt;body&gt;</code> 和 <code>&lt;/body&gt;</code> 之间就行了。</p>\n<pre class=\"language-html\" data-language=\"html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#34495e<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">opacity</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>0.5<span class=\"token punctuation\">'</span></span> <span class=\"token attr-name\">zIndex</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>-2<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">count</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>99<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>canvas-nest.min.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span></code></pre>\n\n<h4 id=\"组态\"><a href=\"#组态\" class=\"headerlink\" title=\"组态\"></a>组态</h4><ul>\n<li><strong>color</strong>：线条颜色，默认值：<code>'0,0,0'</code>；RGB 值：（R，G，B）。（注意：使用 '，' 分隔。）</li>\n<li><strong>pointColor</strong>：点的颜色，默认值：<code>'0,0,0'</code>；RGB 值：（R，G，B）。（注意：使用 '，' 分隔。）</li>\n<li><strong>opacity</strong>：线的不透明度（0〜1），默认值：<code>0.5</code>。</li>\n<li><strong>count</strong>：线条数量，默认值：<code>99</code>。</li>\n<li><strong>zIndex</strong>：背景的 z-index 属性，默认值：<code>-1</code>。</li>\n</ul>\n","categories":["Blog"],"tags":["Blog","HTML"]},{"title":"使用 rinetd 实现端口转发重定向","url":"/2020/07/2020-07-07-%E4%BD%BF%E7%94%A8rinetd%E5%AE%9E%E7%8E%B0%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E9%87%8D%E5%AE%9A%E5%90%91/","content":"<h3 id=\"工具介绍\"><a href=\"#工具介绍\" class=\"headerlink\" title=\"工具介绍\"></a>工具介绍</h3><p>linux 下简单好用的工具 rinetd，实现端口映射 / 转发 / 重定向。</p>\n<p>用于有效地将连接从一个 IP 地址 / 端口组合重定向到另一 IP 地址 / 端口组合。在操作虚拟服务器、防火墙等时很有用。</p>\n<p>Rinetd 是单一过程的服务器，它处理任何数量的连接到在配置文件 etc/rinetd 中指定的地址 / 端口对。尽管 rinetd 使用非闭锁 I/O 运行作为一个单一过程，它可能重定向很多连接而不对这台机器增加额外的负担。</p>\n<p>官网地址：<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5ib3V0ZWxsLmNvbS9yaW5ldGQ=\">http://www.boutell.com/rinetd<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h3 id=\"软件安装\"><a href=\"#软件安装\" class=\"headerlink\" title=\"软件安装\"></a>软件安装</h3><h4 id=\"方法一：压缩包\"><a href=\"#方法一：压缩包\" class=\"headerlink\" title=\"方法一：压缩包\"></a>方法一：压缩包</h4><pre class=\"language-shell\" data-language=\"shell\"><code class=\"language-shell\">wget http://www.boutell.com/rinetd/http/rinetd.tar.gz\ntar zxvf rinetd.tar.gz\nmake\nmake install</code></pre>\n\n<h4 id=\"方法二：apt-get\"><a href=\"#方法二：apt-get\" class=\"headerlink\" title=\"方法二：apt-get\"></a>方法二：apt-get</h4><pre class=\"language-shell\" data-language=\"shell\"><code class=\"language-shell\">apt-cache search rinetd\napt-get install rinetd -y</code></pre>\n\n<h3 id=\"软件配置\"><a href=\"#软件配置\" class=\"headerlink\" title=\"软件配置\"></a>软件配置</h3><p>配置文件格式：</p>\n<pre class=\"language-none\"><code class=\"language-none\">[Source Address] [Source Port] [Destination Address] [Destination Port]\n源地址 源端口 目的地址 目的端口</code></pre>\n\n<p>在每一单独的行中指定每个要转发的端口。源地址和目的地址都可以是主机名或 IP 地址，IP 地址 0.0.0.0 将 rinetd 绑定到任何可用的本地 IP 地址上。</p>\n<p>例如：</p>\n<pre class=\"language-none\"><code class=\"language-none\">vi /etc/rinetd.conf\n0.0.0.0 8080 172.19.94.3 8080\n0.0.0.0 2222 192.168.0.103 3389\n1.2.3.4 80     192.168.0.10 80</code></pre>\n\n<p>说明一下（0.0.0.0 表示本机绑定所有可用地址）</p>\n<ul>\n<li>将所有发往本机 8080 端口的请求转发到 172.19.94.3 的 8080 端口</li>\n<li>将所有发往本机 2222 端口的请求转发到 192.168.0.103 的 3389 端口</li>\n<li>将所有发往 1.2.3.4 的 80 端口请求转发到 192.168.0.10 的 80 端口</li>\n</ul>\n<h3 id=\"启动程序\"><a href=\"#启动程序\" class=\"headerlink\" title=\"启动程序\"></a>启动程序</h3><p>关闭进程</p>\n<pre class=\"language-none\"><code class=\"language-none\">pkill rinetd</code></pre>\n\n<p>启动转发</p>\n<pre class=\"language-none\"><code class=\"language-none\">rinetd -c /etc/rinetd.conf</code></pre>\n\n<h3 id=\"开机启动\"><a href=\"#开机启动\" class=\"headerlink\" title=\"开机启动\"></a>开机启动</h3><p>把这条命令加到 <code>/etc/rc.local</code> 里面就可以开机自动运行。</p>\n<h3 id=\"查看状态\"><a href=\"#查看状态\" class=\"headerlink\" title=\"查看状态\"></a>查看状态</h3><pre class=\"language-none\"><code class=\"language-none\">netstat -antup</code></pre>\n\n<h3 id=\"注意事项\"><a href=\"#注意事项\" class=\"headerlink\" title=\"注意事项\"></a>注意事项</h3><ol>\n<li><p>rinetd.conf 中绑定的本机端口必须没有被其它程序占用。</p>\n</li>\n<li><p>运行 rinetd 的系统防火墙应该打开绑定的本机端口。</p>\n<p>例如：</p>\n<p>&lt;!--hexoPostRenderEscape:</p><pre class=\"language-none\"><code class=\"language-none\">-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 1111 -jACCEPT<p></p>\n</code></pre></li><code class=\"language-none\">\n</code></ol><code class=\"language-none\">\n</code><p><code class=\"language-none\">-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 2222 -jACCEPT</code>:hexoPostRenderEscape--&gt;</p>\n","categories":["Linux"],"tags":["Linux","工具"]},{"title":"关于 toString 方法的重写工具 ToStringBuilder","url":"/2020/07/2020-07-15-%E5%85%B3%E4%BA%8EtoString%E6%96%B9%E6%B3%95%E7%9A%84%E9%87%8D%E5%86%99%E5%B7%A5%E5%85%B7ToStringBuilder/","content":"<p>Apache 的 <code>commons-lang3</code> 的工具包里有一个 <code>ToStringBuilder</code> 类，这样在打日志的时候可以方便的打印出类实例中的各属性的值。</p>\n<h3 id=\"依赖引入\"><a href=\"#依赖引入\" class=\"headerlink\" title=\"依赖引入\"></a>依赖引入</h3><pre class=\"language-xml\" data-language=\"xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>commons-lang<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>commons-lang<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">&gt;</span></span>2.4<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">&gt;</span></span></code></pre>\n\n<h3 id=\"重写-toString\"><a href=\"#重写-toString\" class=\"headerlink\" title=\"重写 toString\"></a>重写 toString</h3><pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Override</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">ToStringBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">reflectionToString</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\n<p>打印结果参考：</p>\n<blockquote>\n<p>com.zzz.other.City@4eec7777 [id=1,name = 杭州，province = 浙江，country=CN]</p>\n</blockquote>\n<h3 id=\"ToStringStyle\"><a href=\"#ToStringStyle\" class=\"headerlink\" title=\"ToStringStyle\"></a>ToStringStyle</h3><p><code>ToStringBuilder.reflectionToString</code>  默认为 <code>ToStringStyle.DEFAULT_STYLE</code>。</p>\n<p>使用方法：</p>\n<pre class=\"language-none\"><code class=\"language-none\">ToStringBuilder.reflectionToString(this, ToStringStyle.DEFAULT_STYLE);</code></pre>\n\n<p>ToStringStyle 还有其他样式，可调整 ToStringBuilder 的打印结果：</p>\n<ul>\n<li><p><strong>ToStringStyle.DEFAULT_STYLE</strong>：对象及其属性一行显示</p>\n<pre class=\"language-none\"><code class=\"language-none\">com.zzz.other.City@4eec7777[id=1,name=杭州,province=浙江,country=CN]</code></pre>\n</li>\n<li><p><strong>ToStringStyle.MULTI_LINE_STYLE</strong>：属性换行显示</p>\n<pre class=\"language-none\"><code class=\"language-none\">com.zzz.other.City@4eec7777[\nid=1\nname=杭州\nprovince=浙江\ncountry=CN\n]</code></pre>\n</li>\n<li><p><strong>ToStringStyle.NO_FIELD_NAMES_STYLE</strong>：不显示属性名，只显示属性值</p>\n<pre class=\"language-none\"><code class=\"language-none\">com.zzz.other.City@4eec7777[1,杭州,浙江,CN]</code></pre>\n</li>\n<li><p><strong>ToStringStyle.SHORT_PREFIX_STYLE</strong>：对象名称简写</p>\n<pre class=\"language-none\"><code class=\"language-none\">City[id=1,name=杭州,province=浙江,country=CN]</code></pre></li>\n<li><p><strong>ToStringStyle.SIMPLE_STYLE</strong>：只显示属性</p>\n<pre class=\"language-none\"><code class=\"language-none\">1,杭州,浙江,CN</code></pre>\n\n</li>\n</ul>\n<h3 id=\"原理解析\"><a href=\"#原理解析\" class=\"headerlink\" title=\"原理解析\"></a>原理解析</h3><p><code>ReflectionToStringBuilder</code> 主要是通过 java 反射实现的属性拼接。</p>\n<p><strong>org.apache.commons.lang.builder.ReflectionToStringBuilder</strong>：</p>\n <pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> object<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ToStringStyle</span> style<span class=\"token punctuation\">,</span> \n                              <span class=\"token keyword\">boolean</span> outputTransients<span class=\"token punctuation\">,</span> <span class=\"token keyword\">boolean</span> outputStatics<span class=\"token punctuation\">,</span>\n                              <span class=\"token class-name\">Class</span> reflectUpToClass<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ReflectionToStringBuilder</span><span class=\"token punctuation\">(</span>object<span class=\"token punctuation\">,</span> style<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> \n                                         reflectUpToClass<span class=\"token punctuation\">,</span> outputTransients<span class=\"token punctuation\">,</span>\n                                         outputStatics<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStyle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getNullText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token class-name\">Class</span> clazz <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">appendFieldsIn</span><span class=\"token punctuation\">(</span>clazz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>clazz<span class=\"token punctuation\">.</span><span class=\"token function\">getSuperclass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> clazz <span class=\"token operator\">!=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getUpToClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        clazz <span class=\"token operator\">=</span> clazz<span class=\"token punctuation\">.</span><span class=\"token function\">getSuperclass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">appendFieldsIn</span><span class=\"token punctuation\">(</span>clazz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\n<p>其中参数  <code>ToStringStyle</code>  是个抽象类，定义了输出的格式 主要是 append 了一类类信息到字符串上，可以自己继承 <code>ToStringStyle</code>  实现自定义的输出格式。</p>\n","categories":["Java","JavaClass"],"tags":["JavaClass","Apache"]},{"title":"使用 Arthas 热更新 Java 代码","url":"/2020/07/2020-07-16-%E4%BD%BF%E7%94%A8Arthas%E7%83%AD%E6%9B%B4%E6%96%B0Java%E4%BB%A3%E7%A0%81/","content":"<p>Arthas（阿尔萨斯）是 Alibaba 开源的一款 Java 诊断工具，使用它我们可以监控和排查 Java 程序，然而它还提供了非常实用的 Java 热更新功能。</p>\n<p>所谓的 Java 热更新是指在不重启项目的情况下实现代码的更新与替换。使用它可以实现不停机更新 Java 程序，尤其是对那些启动非常耗时的 Java 项目来说，更是效果显著。</p>\n<h3 id=\"Arthas-使用\"><a href=\"#Arthas-使用\" class=\"headerlink\" title=\"Arthas 使用\"></a>Arthas 使用</h3><h4 id=\"Arthas资料\"><a href=\"#Arthas资料\" class=\"headerlink\" title=\"Arthas资料\"></a>Arthas 资料</h4><p>Github 地址：</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFz\"> https://github.com/alibaba/arthas<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<p>Arthas<br>用户文档：</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbGliYWJhLmdpdGh1Yi5pby9hcnRoYXMv\">https://alibaba.github.io/arthas/<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<h4 id=\"下载-Arthas\"><a href=\"#下载-Arthas\" class=\"headerlink\" title=\"下载 Arthas\"></a>下载 Arthas</h4><p>首先，我们先把 Arthas 的 Jar 包下载到本地，它的下载地址是：</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbGliYWJhLmdpdGh1Yi5pby9hcnRoYXMvYXJ0aGFzLWJvb3QuamFy\">https://alibaba.github.io/arthas/arthas-boot.jar<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<h4 id=\"启动-Arthas\"><a href=\"#启动-Arthas\" class=\"headerlink\" title=\"启动 Arthas\"></a>启动 Arthas</h4><p>我们只需要使用普通的 jar 包启动命令：<code>java -jar arthas-boot.jar</code> 来启动 Arthas 即可。</p>\n<h4 id=\"Windows-运行\"><a href=\"#Windows-运行\" class=\"headerlink\" title=\"Windows 运行\"></a>Windows 运行</h4><p>Windows 需要以管理员方式运行，bat 脚本如下：</p>\n<pre class=\"language-bat\" data-language=\"bat\"><code class=\"language-bat\">%1 mshta vbscript:CreateObject(\"Shell.Application\").ShellExecute(\"cmd.exe\",\"/c %~s0 ::\",\"\",\"runas\",1)(window.close)&amp;&amp;exit\ncd /d \"%~dp0\"\njava -jar arthas-boot.jar</code></pre>\n\n<h3 id=\"热更新-Java-代码\"><a href=\"#热更新-Java-代码\" class=\"headerlink\" title=\"热更新 Java 代码\"></a>热更新 Java 代码</h3><p>假如我们原来的代码是这样的：</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">sample<span class=\"token punctuation\">.</span>redefine</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RedefineSuccess</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span>SECONDS<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">printFlag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">printFlag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">boolean</span> flag <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"flag is true.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"flag is false.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\n<p>我们现在想要把 <code>flag</code> 变量改为 <code>false</code> 就可以这样来做：</p>\n<ol>\n<li>使用 Arthas 的内存编译工具将新的 Java 代码编译为字节码；</li>\n<li>使用 Arthas 的 <code>redefine</code> 命令实现热更新。</li>\n</ol>\n<h4 id=\"编译字节码\"><a href=\"#编译字节码\" class=\"headerlink\" title=\"编译字节码\"></a>编译字节码</h4><p>首先，我们需要将新的 Java 代码编译为字节码，我们可以通过 Arthas 提供的 <code>mc</code> 命令实现，<code>mc</code> 是 Memory Compiler（内存编译器）的缩写。</p>\n<p>实现示例如下：</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token punctuation\">[</span>arthas<span class=\"token annotation punctuation\">@10200</span><span class=\"token punctuation\">]</span>$ mc <span class=\"token class-name\">C</span><span class=\"token operator\">:</span><span class=\"token operator\">/</span>arthas<span class=\"token operator\">-</span>demo<span class=\"token operator\">/</span>src<span class=\"token operator\">/</span>main<span class=\"token operator\">/</span>java<span class=\"token operator\">/</span>sample<span class=\"token operator\">/</span>redefine<span class=\"token operator\">/</span><span class=\"token class-name\">RedefineSuccess</span><span class=\"token punctuation\">.</span>java <span class=\"token operator\">-</span>d  <span class=\"token class-name\">E</span><span class=\"token operator\">:</span>\n<span class=\"token class-name\">Memory</span> compiler output<span class=\"token operator\">:</span>\n<span class=\"token class-name\">E</span><span class=\"token operator\">:</span>\\sample\\redefine\\<span class=\"token class-name\">RedefineSuccess</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span>\n<span class=\"token class-name\">Affect</span><span class=\"token punctuation\">(</span>row<span class=\"token operator\">-</span>cnt<span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> cost in <span class=\"token number\">500</span> ms<span class=\"token punctuation\">.</span></code></pre>\n\n<p>其中 <code>-d</code> 表示编译文件的存放位置。</p>\n<blockquote>\n<p>小贴士：我们也可以使用 javac App.java 生成的字节码，它与此步骤执行的结果相同。</p>\n</blockquote>\n<h4 id=\"执行热更新\"><a href=\"#执行热更新\" class=\"headerlink\" title=\"执行热更新\"></a>执行热更新</h4><p>有了字节码文件之后，我们就可以使用 <code>redefine</code> 命令来实现热更新了，实现示例如下：</p>\n<pre class=\"language-none\"><code class=\"language-none\">[arthas@10200]$ redefine e:/sample/redefine/RedefineSuccess.class\nredefine success, size: 1</code></pre>\n\n<p>从上述结果可以看出，热更新执行成功，此时我们去控制台查看执行结果，如下图所示：</p>\n<p><img src=\"/images/2020/07/1594883244673.png\" alt=\"1594883244673\" loading=\"lazy\"></p>\n<p>这说明热更新执行确实成功了。</p>\n<h3 id=\"结合-jad-mc-命令使用\"><a href=\"#结合-jad-mc-命令使用\" class=\"headerlink\" title=\"结合 jad/mc 命令使用\"></a>结合 jad/mc 命令使用</h3><pre class=\"language-shell\" data-language=\"shell\"><code class=\"language-shell\">jad --source-only com.example.demo.arthas.user.UserController &gt; /tmp/UserController.java\nmc /tmp/UserController.java -d /tmp\nredefine /tmp/com/example/demo/arthas/user/UserController.class</code></pre>\n\n<ul>\n<li>jad 命令反编译，然后可以用其它编译器，比如 vim 来修改源码</li>\n<li> mc 命令来内存编译修改过的代码</li>\n<li>用 redefine 命令加载新的字节码</li>\n</ul>\n<h3 id=\"热更新注意事项\"><a href=\"#热更新注意事项\" class=\"headerlink\" title=\"热更新注意事项\"></a>热更新注意事项</h3><h4 id=\"redefine-特别说明\"><a href=\"#redefine-特别说明\" class=\"headerlink\" title=\"redefine 特别说明\"></a>redefine 特别说明</h4><p><code>redefine</code> 命令和 <code>jad</code>/<code>watch</code>/<code>trace</code>/<code>monitor</code>/<code>tt</code> 等命令会冲突。</p>\n<p>执行完 <code>redefine</code> 之后，如果再执行上面提到的命令，则会把 <code>redefine</code> 的字节码重置。 </p>\n<p>原因是 jdk 本身 redefine 和 Retransform 是不同的机制，同时使用两种机制来更新字节码，只有最后修改的会生效。</p>\n<h4 id=\"条件限制\"><a href=\"#条件限制\" class=\"headerlink\" title=\"条件限制\"></a>条件限制</h4><p>使用热更新功能有一些条件限制，我们只能用它来修改方法内部的一些业务代码，如果我们出现了以下任意一种情况，那么热更新就会执行失败：</p>\n<ol>\n<li>增加类属性（类字段）；</li>\n<li>增加或删除方法；</li>\n<li>替换正在运行的方法。</li>\n</ol>\n<p>最后一条我们需要单独说明一下，假如我们把上面的示例改为如下代码：</p>\n <pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">sample<span class=\"token punctuation\">.</span>redefine</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RedefineError</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span>SECONDS<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">boolean</span> flag <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"flag is true.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"flag is false.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n\n<p>那么此时我们再进行热更新操作修改 <code>flag</code> 的值，那么就会执行失败，因为我们替换的是正在运行中的方法，而我们正常示例中的代码之所以能成功，是因为我们在 <code>while</code> 无线循环中调用了另一个方法，而那个方法是被间歇性使用的，因此可以替换成功。</p>\n","categories":["Java","Arthas"],"tags":["Java","Java诊断","Arthas"]},{"title":"博客添加 Fork me on GitHub","url":"/2020/07/2020-07-16-%E5%8D%9A%E5%AE%A2%E6%B7%BB%E5%8A%A0Fork%20me%20on%20GitHub/","content":"<p><strong>在网上浏览博客时经常看到页面的右上角或左上角有一个 fork me on github 的按钮，本文将介绍如何实现。</strong></p>\n<h3 id=\"Fork-me-on-GitHub\"><a href=\"#Fork-me-on-GitHub\" class=\"headerlink\" title=\"Fork me on GitHub\"></a>Fork me on GitHub</h3><p>GitHub 获取 css 文件：</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NpbW9ud2hpdGFrZXIvZ2l0aHViLWZvcmstcmliYm9uLWNzcy8=\">https://github.com/simonwhitaker/github-fork-ribbon-css/<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<p>效果演示：</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaW1vbndoaXRha2VyLmdpdGh1Yi5pby9naXRodWItZm9yay1yaWJib24tY3NzLw==\">https://simonwhitaker.github.io/github-fork-ribbon-css/<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<h3 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h3><p>将以下代码复制到 <code>&lt;head&gt;</code> 页面的中，引入 css：</p>\n<pre class=\"language-none\"><code class=\"language-none\">&lt;link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css\" /&gt;</code></pre>\n\n<p>使用非常简单，将下面的代码插入到 <code>&lt;body&gt;</code> 和 <code>&lt;/body&gt;</code> 之间就行了。</p>\n<pre class=\"language-html\" data-language=\"html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>github-fork-ribbon<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://github.com/Jueee<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>_blank<span class=\"token punctuation\">\"</span></span> \n       <span class=\"token attr-name\">data-ribbon</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Fork me on GitHub<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">title</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Fork me on GitHub<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n    Fork me on GitHub\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">&gt;</span></span></code></pre>\n\n<p>默认是在页面右上角。</p>\n<h3 id=\"其他样式\"><a href=\"#其他样式\" class=\"headerlink\" title=\"其他样式\"></a>其他样式</h3><ul>\n<li><p>固定标签：<code>class=\"github-fork-ribbon fixed\"</code></p>\n</li>\n<li><p>更换位置：</p>\n<ul>\n<li>右上角：<code>class=\"github-fork-ribbon right-top\"</code></li>\n<li>右下角：<code>class=\"github-fork-ribbon right-bottom\"</code></li>\n<li>左上角：<code>class=\"github-fork-ribbon left-top\"</code></li>\n<li>左下角：<code>class=\"github-fork-ribbon left-bottom fixed\"</code></li>\n</ul>\n</li>\n<li><p>更换背景颜色：</p>\n<pre class=\"language-css\" data-language=\"css\"><code class=\"language-css\"><span class=\"token selector\">.github-fork-ribbon.left-bottom:before</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> #333<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\n</li>\n</ul>\n<h3 id=\"小屏幕不显示\"><a href=\"#小屏幕不显示\" class=\"headerlink\" title=\"小屏幕不显示\"></a>小屏幕不显示</h3><p>按照上面的步骤当屏幕缩小后还会显示 fork me on github 图标，但这不是我想要的，如果希望在大屏下显示，小屏后就不显示了。方法如下：</p>\n<p>新增样式：</p>\n<pre class=\"language-css\" data-language=\"css\"><code class=\"language-css\"><span class=\"token selector\">.forkme</span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token atrule\"><span class=\"token rule\">@media</span> <span class=\"token punctuation\">(</span><span class=\"token property\">min-width</span><span class=\"token punctuation\">:</span> 1350px<span class=\"token punctuation\">)</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token selector\">.forkme</span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> inline<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\n<p>代码块上套上 div 加上 class 就行了，如下：</p>\n<pre class=\"language-html\" data-language=\"html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>forkme<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>github-fork-ribbon fixed<span class=\"token punctuation\">\"</span></span>    <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://github.com/Jueee<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">&gt;</span></span>\n        Fork me on GitHub\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span></code></pre>\n\n","categories":["Blog"],"tags":["Blog","HTML"]},{"title":"为 GitLab 代码库配置 Specific Runner","url":"/2020/07/2020-07-25-%E4%B8%BAGitLab%E4%BB%A3%E7%A0%81%E5%BA%93%E9%85%8D%E7%BD%AESpecific%20Runner/","content":"<h3 id=\"添加-k8s-集群\"><a href=\"#添加-k8s-集群\" class=\"headerlink\" title=\"添加 k8s 集群\"></a>添加 k8s 集群</h3><p>单击<strong>添加现有集群</strong>选项卡，然后填写详细信息：</p>\n<ul>\n<li><p><strong>Kubernetes 集群名称</strong>（必填）- 您希望为<strong>集群指定</strong>的名称。</p>\n</li>\n<li><p><strong>环境范围</strong>（必需）-  <a href=\"index.md#setting-the-environment-scope-premium\">与</a>此集群<a href=\"index.md#setting-the-environment-scope-premium\">相关的环境</a>。</p>\n</li>\n<li><p><strong>API URL</strong>（必填）- 这是 GitLab 用于访问 Kubernetes API 的 URL。Kubernetes 公开了几个 API，我们希望所有 API 都具有通用的 “基本” URL，例如，<code>https://kubernetes.example.com</code> 而不是 <code>https://kubernetes.example.com/api/v1</code>。</p>\n<p>通过运行以下命令获取 API URL：</p>\n<pre class=\"language-none\"><code class=\"language-none\">kubectl cluster-info | grep 'Kubernetes master' | awk '/http/ {print $NF}'</code></pre>\n</li>\n<li><p><strong>CA 证书</strong>（必需）- 需要有效的 Kubernetes 证书才能对集群进行身份验证。我们将使用默认创建的证书。</p>\n<ul>\n<li><p>用列出秘密 <code>kubectl get secrets</code>，并命名类似  <code>default-token-xxxxx</code>。复制该令牌名称以在下面使用。</p>\n</li>\n<li><p>通过运行以下命令获取证书：</p>\n<pre class=\"language-none\"><code class=\"language-none\">kubectl get secret &lt;secret name&gt; -o jsonpath=\"{['data']['ca\\.crt']}\" | base64 --decode</code></pre>\n\n<p>注意：<strong>注意：</strong>  如果命令返回整个证书链，则需要在证书链 底部复制 <em>root ca</em> 证书。</p>\n</li>\n</ul>\n</li>\n<li><p><strong>令牌</strong> -GitLab 使用服务令牌对 Kubernetes 进行身份验证，该服务令牌的范围仅限于特定的 <code>namespace</code>。 <strong>使用的令牌应属于具有 cluster-admin 特权的服务帐户  。</strong>要创建此服务帐户：</p>\n<ol>\n<li><p>创建一个 <code>gitlab-admin-service-account.yaml</code> 包含内容的文件：</p>\n<p>&lt;!--hexoPostRenderEscape:</p><pre class=\"language-none\"><code class=\"language-none\">apiVersion: v1<br>kind: ServiceAccount<br>metadata:<br>name: gitlab-admin<br>namespace: kube-system<p></p>\n</code></pre></li><code class=\"language-none\">\n</code></ol><code class=\"language-none\">\n</code></li><code class=\"language-none\">\n</code></ul><code class=\"language-none\">\n<hr>\n<p>apiVersion: rbac.authorization.k8s.io/v1beta1<br>kind: ClusterRoleBinding<br>metadata:<br>  name: gitlab-admin<br>roleRef:<br>  apiGroup: rbac.authorization.k8s.io<br>  kind: ClusterRole<br>  name: cluster-admin<br>subjects:</p>\n</code><ul><code class=\"language-none\">\n</code><li><code class=\"language-none\"></code><p><code class=\"language-none\">kind: ServiceAccount<br>name: gitlab-admin<br>namespace: kube-system</code>:hexoPostRenderEscape--&gt;</p>\n<ol start=\"2\">\n<li><p>将服务帐户和群集角色绑定应用于您的群集：</p>\n<pre class=\"language-none\"><code class=\"language-none\">kubectl apply -f gitlab-admin-service-account.yaml</code></pre>\n\n<p>您将需要 <code>container.clusterRoleBindings.create</code> 许可权才能创建集群级角色。如果您没有此权限，则可以选择启用基本身份验证，然后 <code>kubectl apply</code> 以管理员身份运行  命令：</p>\n<pre class=\"language-none\"><code class=\"language-none\">kubectl apply -f gitlab-admin-service-account.yaml --username=admin --password=&lt;password&gt;</code></pre>\n\n<p>注意：<strong>注意：</strong>  可以打开基本身份验证，并可以使用 Google Cloud Console 获取密码凭据。</p>\n<p>输出：</p>\n<pre class=\"language-none\"><code class=\"language-none\">serviceaccount \"gitlab-admin\" created\nclusterrolebinding \"gitlab-admin\" created</code></pre>\n</li>\n<li><p>检索 <code>gitlab-admin</code> 服务帐户的令牌：</p>\n<pre class=\"language-none\"><code class=\"language-none\">kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep gitlab-admin | awk '{print $1}')</code></pre>\n\n<p>复制 <code>&lt;authentication_token&gt;</code> 输出中的值：</p>\n<p>&lt;!--hexoPostRenderEscape:</p><pre class=\"language-none\"><code class=\"language-none\">Name:         gitlab-admin-token-b5zv4<br>Namespace:    kube-system<br>Labels:       &lt;none&gt;<br>Annotations:  kubernetes.io/service-account.name=gitlab-admin<p></p>\n<pre><code>     kubernetes.io&amp;#x2F;service-account.uid&amp;#x3D;bcfe66ac-39be-11e8-97e8-026dce96b6e8</code></pre>\n</code></pre></li><code class=\"language-none\">\n</code></ol><code class=\"language-none\">\n</code></li><code class=\"language-none\">\n</code></ul><code class=\"language-none\">\n<p>Type:  kubernetes.io/service-account-token</p>\n</code><p><code class=\"language-none\">Data<br>====<br>ca.crt:     1025 bytes<br>namespace:  11 bytes<br>token:      &lt;authentication_token&gt;</code>:hexoPostRenderEscape--&gt;</p>\n<h3 id=\"配置-Specific-Runner\"><a href=\"#配置-Specific-Runner\" class=\"headerlink\" title=\"配置 Specific Runner\"></a>配置 Specific Runner</h3><p>在 GitLab 的 CI/CD 流程中具体执行任务的节点叫做 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmdpdGxhYi5jb20vcnVubmVyLw==\">runner<i class=\"fa fa-external-link-alt\"></i></span>。GitLab 中有两种类型的 runner：</p>\n<ul>\n<li><strong>Shared Runners</strong> 由 GitLab 管理员配置的公有 runner。多个项目公用。作为开发人员无需配置，可以直接使用。</li>\n<li><strong>Specific Runners</strong> 开发人员为每个代码库单独配置的专属 runner。只能执行所属代码库的任务。需要开发人员手动搭建。</li>\n</ul>\n<p>由于我厂的 GitLab 并没有配置任何 Shared Runner。所以只能选择在自己的台式机上手动搭建。</p>\n<h3 id=\"下载-runner-可执行文件\"><a href=\"#下载-runner-可执行文件\" class=\"headerlink\" title=\"下载 runner 可执行文件\"></a>下载 runner 可执行文件</h3><p>根据你的环境下载 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRsYWItcnVubmVyLWRvd25sb2Fkcy5zMy5hbWF6b25hd3MuY29tL2xhdGVzdC9iaW5hcmllcy9naXRsYWItcnVubmVyLXdpbmRvd3MtMzg2LmV4ZQ==\">x86<i class=\"fa fa-external-link-alt\"></i></span> 或者 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRsYWItcnVubmVyLWRvd25sb2Fkcy5zMy5hbWF6b25hd3MuY29tL2xhdGVzdC9iaW5hcmllcy9naXRsYWItcnVubmVyLXdpbmRvd3MtYW1kNjQuZXhl\">amd64<i class=\"fa fa-external-link-alt\"></i></span> 版本。</p>\n<p>创建 <code>D:\\GitLab-Runner</code> 目录，将刚刚下载好的文件复制到该目录并重命名为 <code>gitlab-runner.exe</code>。</p>\n<h3 id=\"获取配置信息\"><a href=\"#获取配置信息\" class=\"headerlink\" title=\"获取配置信息\"></a>获取配置信息</h3><p>进入代码库主页，依次点击 <code>Settings</code> =&gt; <code>CI / CD</code> =&gt; <code>Runners settings</code>。</p>\n<p><img src=\"/images/2020/07/1595562311495.png\" alt=\"1595562311495\" loading=\"lazy\"></p>\n<p>这里展开的信息中有两个字段需要我们记下来。分别是一个 URL 和一个 Token。</p>\n<p><img src=\"/images/2020/07/1595562367478.png\" alt=\"1595562367478\" loading=\"lazy\"></p>\n<h3 id=\"注册-runner\"><a href=\"#注册-runner\" class=\"headerlink\" title=\"注册 runner\"></a>注册 runner</h3><h4 id=\"Linux\"><a href=\"#Linux\" class=\"headerlink\" title=\"Linux\"></a>Linux</h4><pre class=\"language-none\"><code class=\"language-none\">k exec -it runner-gitlab-runner-74cf6f794b-22vln gitlab-runner register -n gitlab-managed-apps</code></pre>\n\n<h4 id=\"Windows\"><a href=\"#Windows\" class=\"headerlink\" title=\"Windows\"></a>Windows</h4><p>进入 <code>D:\\GitLab-Runner</code> 目录执行命令：</p>\n<pre class=\"language-yml\" data-language=\"yml\"><code class=\"language-yml\">./gitlab-runner.exe register</code></pre>\n\n<h4 id=\"进行注册\"><a href=\"#进行注册\" class=\"headerlink\" title=\"进行注册\"></a>进行注册</h4><p>执行完后会进入一个交互式的配置流程，你需要回答以下问题：</p>\n<ul>\n<li><code>Please enter the gitlab-ci coordinator URL</code>：填入上一步获取的 URL</li>\n<li><code>Please enter the gitlab-ci token for this runner</code>：填入上一步获取的 Token</li>\n<li><code>Please enter the gitlab-ci description for this runner</code>：给你的 runner 起一个名字</li>\n<li><code>Please enter the gitlab-ci tags for this runner (comma separated)</code>：GitLab 允许我们给 runner 设置标签，设置好后该 runner 只会执行拥有相同标签的任务。由于我们的 runner 只为我们自己的代码库服务，所以此处不做过多配置。留空即可。</li>\n<li><code>Whether to lock Runner to current project</code>：该 runner 是否应该锁定在当前项目上。由于我们是自己用，选 <code>true</code> 即可。</li>\n<li><code>Please enter the executor: ssh, docker+machine, docker-ssh+machine, kubernetes, docker, parallels, virtualbox, docker-ssh, shell: docker</code>：选择任务执行环境，我们选择最简单的 <code>shell</code>。</li>\n</ul>\n<h3 id=\"验证服务已启动\"><a href=\"#验证服务已启动\" class=\"headerlink\" title=\"验证服务已启动\"></a>验证服务已启动</h3><p>进入代码库主页，依次点击 <code>Settings</code> =&gt; <code>CI / CD</code> =&gt; <code>Runners settings</code>。</p>\n<p><img src=\"/images/2020/07/1595562200358.png\" alt=\"1595562200358\" loading=\"lazy\"></p>\n","categories":["Git"],"tags":["Git"]},{"title":"使用 GitBook 进行团队文档协作","url":"/2020/07/2020-07-24-%E4%BD%BF%E7%94%A8GitBook%E8%BF%9B%E8%A1%8C%E5%9B%A2%E9%98%9F%E6%96%87%E6%A1%A3%E5%8D%8F%E4%BD%9C/","content":"<p><strong>GitBook 提供了 GitBook Editor ，GitBook cli 这两个工具，一个是编辑文档，一个可以生成文档。只要本地搭建一个 Git 服务就完全可以实现本地化了。</strong></p>\n<h3 id=\"工具准备\"><a href=\"#工具准备\" class=\"headerlink\" title=\"工具准备\"></a>工具准备</h3><p>如果没有团队协作要求，只想生成电子书，只在自己机器上安装 GitBook CI 就可以，1，2 就可以省略了。</p>\n<ol>\n<li>GitLab 一键安装包 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9hYm91dC5naXRsYWIuY29tL2Rvd25sb2Fkcy8=\">https://about.gitlab.com/downloads/<i class=\"fa fa-external-link-alt\"></i></span> </li>\n<li>GitLab Ci Runner <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2dpdGxhYmhxL2dpdGxhYi1jaS1ydW5uZXI=\">https://github.com/gitlabhq/gitlab-ci-runner<i class=\"fa fa-external-link-alt\"></i></span> </li>\n<li>GitBook CI <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0dpdGJvb2tJTy9naXRib29rLWNsaQ==\">https://github.com/GitbookIO/gitbook-cli<i class=\"fa fa-external-link-alt\"></i></span> </li>\n<li>GitBook Editor <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZ2l0Ym9vay5jb20vZWRpdG9y\">https://www.gitbook.com/editor<i class=\"fa fa-external-link-alt\"></i></span></li>\n</ol>\n<h3 id=\"GitLab-Runner配置\"><a href=\"#GitLab-Runner配置\" class=\"headerlink\" title=\"GitLab Runner配置\"></a>GitLab Runner 配置</h3><h4 id=\"编辑-gitlab-ci-yml\"><a href=\"#编辑-gitlab-ci-yml\" class=\"headerlink\" title=\"编辑 .gitlab-ci.yml\"></a>编辑 .gitlab-ci.yml</h4><pre class=\"language-yml\" data-language=\"yml\"><code class=\"language-yml\"># 定义 stages\nstages:\n  - build\n# 定义 job\nGenerateHTML:\n  stage: build\n  script:\n    - p=`pwd`\n    - echo $p\n    - gitbook build</code></pre>\n\n<p>gitlab 执行构建，会在文件夹下生成 _book 的目录。</p>\n<p>手工执行 gitbook serve 启动。</p>\n<p>打开 ip:4000 就可以查看文档了。</p>\n<h3 id=\"相关命令\"><a href=\"#相关命令\" class=\"headerlink\" title=\"相关命令\"></a>相关命令</h3><pre class=\"language-ruby\" data-language=\"ruby\"><code class=\"language-ruby\">$ gitbook init <span class=\"token comment\"># 初始化一个仓库</span>\n\n$ gitbook install <span class=\"token comment\"># 安装插件</span>\n\n$ gitbook serve <span class=\"token comment\"># 本地预览</span>\n\n$ gitbook serve <span class=\"token operator\">--</span>port <span class=\"token number\">8001</span> <span class=\"token comment\"># 指定端口,默认4000</span>\n\n$ gitbook build  <span class=\"token comment\"># 输出一个静态网站</span>\n\n$ gitbook pdf <span class=\"token comment\"># 生成pdf文件</span>\n\n$ gitbook help <span class=\"token comment\"># 查看帮助</span></code></pre>\n\n<p>可以使用 <code>--log=debug</code> 和 <code>--debug</code> 来获得更详细的错误消息（堆栈跟踪）。例如：</p>\n<pre class=\"language-none\"><code class=\"language-none\">$ gitbook build ./ --log=debug --debug</code></pre>\n\n<p>or</p>\n<pre class=\"language-none\"><code class=\"language-none\">$ gitbook serve ./ --log=debug --debug</code></pre>\n\n<h3 id=\"Docker容器化\"><a href=\"#Docker容器化\" class=\"headerlink\" title=\"Docker容器化\"></a>Docker 容器化</h3><p><code>Dockerfile</code> 文件如下：</p>\n<pre class=\"language-none\"><code class=\"language-none\">From node:10\n\nLABEL version=$VERSION\n\nENV TZ=Asia/Shanghai\nRUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo $TZ &gt; /etc/timezone\n\nWORKDIR /gitbook\nCOPY xxx_deploy /gitbook\n\nRUN npm install gitbook-cli -g &amp;&amp; gitbook fetch ${VERSION} &amp;&amp; npm cache clear --force &amp;&amp; rm -rf /tmp/*\nRUN gitbook build\n\nCMD [\"gitbook\", \"serve\",\"--port\",\"4000\"]</code></pre>\n\n<h3 id=\"问题解决\"><a href=\"#问题解决\" class=\"headerlink\" title=\"问题解决\"></a>问题解决</h3><h4 id=\"windows更新报错\"><a href=\"#windows更新报错\" class=\"headerlink\" title=\"windows更新报错\"></a>windows 更新报错</h4><p>gitbook 的新版本，在 windows 下有个 bug，当文件内容发生更新时，gitbook 报错然后退出：</p>\n<pre class=\"language-none\"><code class=\"language-none\">Error: EPERM: operation not permitted, open</code></pre>\n\n<p>gitbook 官方已有 bug，存在半年了，一直没有 fix：</p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0dpdGJvb2tJTy9naXRib29rL2lzc3Vlcy8xMzc5\">git serve can't restart when file changes<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0dpdGJvb2tJTy9naXRib29rLWNsaS9pc3N1ZXMvNTE=\">gitbook-cli crashes with EPERM: operation not permitted on windows<i class=\"fa fa-external-link-alt\"></i></span></li>\n</ul>\n<p><strong>解决方法</strong></p>\n<p>在官方 bugfix 之前，暂时只能回避：</p>\n<ol>\n<li><p>不要在 windows 下使用 gitbook：linux 没有这个问题</p>\n</li>\n<li><p>不是办法的办法：</p>\n<p>新建一个 <code>run.bat</code> ，内容如下：</p>\n<pre class=\"language-bash\" data-language=\"bash\"><code class=\"language-bash\">@Echo off\n:Start\ncall gitbook serve\ngoto Start</code></pre>\n\n<p>每次崩溃之后立即重新启动一次，凑合着用吧。</p>\n</li>\n</ol>\n<h4 id=\"底部链接修改与隐藏\"><a href=\"#底部链接修改与隐藏\" class=\"headerlink\" title=\"底部链接修改与隐藏\"></a>底部链接修改与隐藏</h4><p>用 GitBook 生成的网页中，在左侧目录下方默认有一个 Published with GitBook 连接，可以将这个连接去掉，或者替换成其它连接。</p>\n<p>在 GitBook 站点目录创建 <code>_layouts-&gt;website-&gt;summary.html</code></p>\n<pre class=\"language-html\" data-language=\"html\"><code class=\"language-html\">{% raw %}\n{% macro articles(_articles) %}\n    {% for article in _articles %}\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>chapter {% if article.path == file.path and not article.anchor %}active{% endif %}<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">data-level</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{ article.level }}<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">{%</span> <span class=\"token attr-name\">if</span> <span class=\"token attr-name\">article.path</span> <span class=\"token attr-name\">%}data-path</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{ article.path|resolveFile }}<span class=\"token punctuation\">\"</span></span><span class=\"token attr-name\">{%</span> <span class=\"token attr-name\">endif</span> <span class=\"token attr-name\">%}</span><span class=\"token punctuation\">&gt;</span></span>\n            {% if article.path and getPageByPath(article.path) %}\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{ article.path|resolveFile }}{{ article.anchor }}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n            {% elif article.url %}\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>_blank<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{ article.url }}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n            {% else %}\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">&gt;</span></span>\n            {% endif %}\n                    {% if article.level != \"0\" and config.pluginsConfig['theme-default'].showLevel %}\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>b</span><span class=\"token punctuation\">&gt;</span></span>{{ article.level }}.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>b</span><span class=\"token punctuation\">&gt;</span></span>\n                    {% endif %}\n                    {{ article.title }}\n            {% if article.path  or article.url %}\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">&gt;</span></span>\n            {% else %}\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span>\n            {% endif %}\n\n            {% if article.articles.length &gt; 0 %}\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>articles<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n                {{ articles(article.articles, file, config) }}\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">&gt;</span></span>\n            {% endif %}\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">&gt;</span></span>\n    {% endfor %}\n{% endmacro %}\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>summary<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n    {% set _divider = false %}\n    {% if config.links.sidebar  %}\n    {% for linkTitle, link in config.links.sidebar  %}\n        {% set _divider = true %}\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">&gt;</span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{ link }}<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>_blank<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>custom-link<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>{{ linkTitle }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">&gt;</span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">&gt;</span></span>\n    {% endfor %}\n    {% endif %}\n\n    {% if _divider %}\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>divider<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">&gt;</span></span>\n    {% endif %}\n\n    {% for part in summary.parts %}\n        {% if part.title %}\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>header<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>{{ part.title }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">&gt;</span></span>\n        {% elif not loop.first %}\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>divider<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">&gt;</span></span>\n        {% endif %}\n        {{ articles(part.articles, file, config) }}\n    {% endfor %}\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>divider<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">&gt;</span></span>\n\n    <span class=\"token comment\">&lt;!--&lt;li&gt;\n        &lt;a href=\"https://www.gitbook.com\" target=\"blank\" class=\"gitbook-link\"&gt;\n            {{ \"GITBOOK_LINK\"|t }}\n        &lt;/a&gt;\n    &lt;/li&gt;--&gt;</span>\n</code><p><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">&gt;</span></span><br>{% endraw %}</code></p></pre>:hexoPostRenderEscape--&gt;<p></p>\n","categories":["Blog"],"tags":["Blog","GitBook"]},{"title":"为 Github 项目说明添加优美标签","url":"/2020/07/2020-07-30-%E4%B8%BAGithub%E9%A1%B9%E7%9B%AE%E8%AF%B4%E6%98%8E%E6%B7%BB%E5%8A%A0%E4%BC%98%E7%BE%8E%E6%A0%87%E7%AD%BE/","content":"<p>大家在 Github 上看项目的时候，是不是经常在项目介绍 README.md 里看到这种高大上的标签：</p>\n<p> <img src=\"/images/2020/07/1596161123283.png\" alt=\"1596161123283\" loading=\"lazy\"></p>\n<p><strong>接下来我们来制作这种标签</strong>。</p>\n<h3 id=\"标签网站\"><a href=\"#标签网站\" class=\"headerlink\" title=\"标签网站\"></a>标签网站</h3><ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaGllbGRzLmlvLw==\">https://shields.io/<i class=\"fa fa-external-link-alt\"></i></span></li>\n</ul>\n<h3 id=\"制作标签\"><a href=\"#制作标签\" class=\"headerlink\" title=\"制作标签\"></a>制作标签</h3><p>下拉，找到 Your Badge：</p>\n<p><img src=\"/images/2020/07/1596160368983.png\" alt=\"1596160368983\" loading=\"lazy\"></p>\n<p>填写 <strong>subject、status、color</strong> 三个字段，点击 <strong>Make Badge</strong> 生成标签：</p>\n<p><img src=\"/images/2020/07/1596160688666.png\" alt=\"1596160688666\" loading=\"lazy\"></p>\n<p>生成结果：</p>\n<p><img src=\"/images/2020/07/1596160441795.png\" alt=\"1596160441795\" loading=\"lazy\"></p>\n<p>复制标签地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pbWcuc2hpZWxkcy5pby9iYWRnZS9hdXRob3ItSnVlZWUtZ3JlZW4=\">https://img.shields.io/badge/author-Jueee-green<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p>在 README.md 里添加如下代码：</p>\n<pre class=\"language-html\" data-language=\"html\"><code class=\"language-html\">![](https://img.shields.io/badge/author-Jueee-green)</code></pre>\n\n<p>可以看到如下显示：</p>\n<p><img src=\"https://img.shields.io/badge/author-Jueee-green\" loading=\"lazy\"></p>\n<p>这些图片 url 是有规律的：<code>文字-文字-颜色</code>。</p>\n<h3 id=\"组合标签\"><a href=\"#组合标签\" class=\"headerlink\" title=\"组合标签\"></a>组合标签</h3><pre class=\"language-none\"><code class=\"language-none\">![](https://img.shields.io/badge/build-success-green) ![](https://img.shields.io/badge/version-1.0-orange) ![](https://img.shields.io/badge/author-Jueee-blue)</code></pre>\n\n<p>效果如下：</p>\n<p><img src=\"/images/2020/07/1596162573650.png\" alt=\"1596162573650\" loading=\"lazy\"></p>\n<h3 id=\"添加点击事件\"><a href=\"#添加点击事件\" class=\"headerlink\" title=\"添加点击事件\"></a>添加点击事件</h3><p>为标签添加点击事件，代码如下：</p>\n<pre class=\"language-none\"><code class=\"language-none\">[![](https://img.shields.io/badge/author-Jueee-green)](点击跳转的链接)</code></pre>\n\n<h4 id=\"为啥这么写？\"><a href=\"#为啥这么写？\" class=\"headerlink\" title=\"为啥这么写？\"></a>为啥这么写？</h4><p>我们知道，MarkDown 中<strong>链接</strong>显示语法为</p>\n<pre class=\"language-csharp\" data-language=\"csharp\"><code class=\"language-csharp\"><span class=\"token punctuation\">[</span>链接名称<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>链接地址<span class=\"token punctuation\">)</span></code></pre>\n\n<p><strong>图片</strong>显示语法为：</p>\n<pre class=\"language-css\" data-language=\"css\"><code class=\"language-css\">![图片名称]<span class=\"token punctuation\">(</span>图片地址<span class=\"token punctuation\">)</span></code></pre>\n\n<p>那么带链接的图片就是将两者语法嵌套就行了，即 <code>[链接名称]</code> 部分变成图片显示语法，语法变成：</p>\n<pre class=\"language-csharp\" data-language=\"csharp\"><code class=\"language-csharp\"><span class=\"token punctuation\">[</span><span class=\"token operator\">!</span><span class=\"token punctuation\">[</span>图片名称<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>图片地址<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>链接地址<span class=\"token punctuation\">)</span></code></pre>","categories":["Blog"],"tags":["Blog","HTML"]},{"title":"Arthas 之各模块简介","url":"/2020/08/2020-08-02-Arthas%E4%B9%8B%E5%90%84%E6%A8%A1%E5%9D%97%E7%AE%80%E4%BB%8B/","content":"<h3 id=\"Arthas\"><a href=\"#Arthas\" class=\"headerlink\" title=\"Arthas\"></a>Arthas</h3><h4 id=\"项目代码\"><a href=\"#项目代码\" class=\"headerlink\" title=\"项目代码\"></a>项目代码</h4><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFz\">GitHub Code by arthas<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h4 id=\"包含模块\"><a href=\"#包含模块\" class=\"headerlink\" title=\"包含模块\"></a>包含模块</h4><p><img src=\"/images/2020/08/1596679506644.png\" alt=\"1596679506644\" loading=\"lazy\"></p>\n<h3 id=\"模块简介\"><a href=\"#模块简介\" class=\"headerlink\" title=\"模块简介\"></a>模块简介</h3><ul>\n<li>arthas-agent：基于 JavaAgent 技术的代理</li>\n<li> bin：一些启动脚本</li>\n<li> arthas-boot：Java 版本的一键安装启动脚本</li>\n<li> arthas-client：telnet client 代码</li>\n<li> arthas-common：一些共用的工具类和枚举类</li>\n<li> arthas-core：核心库，各种 arthas 命令的交互和实现</li>\n<li> arthas-demo：示例代码</li>\n<li> arthas-memorycompiler：内存编绎器代码</li>\n<li> arthas-packaging：maven 打包相关的</li>\n<li> arthas-site：arthas 站点</li>\n<li> arthas-spy：编织到目标类中的各个切面</li>\n<li> static：静态资源</li>\n<li> arthas-testcase：测试</li>\n</ul>\n<h3 id=\"主要功能\"><a href=\"#主要功能\" class=\"headerlink\" title=\"主要功能\"></a>主要功能</h3><p>Arthas 提供的功能主要可以分为以下三个方面：</p>\n<ol>\n<li>信息监控<ul>\n<li>进程运行基本信息包括：内存、CPU 占用、线程信息、线程堆栈、线程数统计、环境变量信息。</li>\n<li>对象信息：类对象静态属性、 Mbean 的属性信息、已加载类信息、类加载器、类方法信息。</li>\n</ul>\n</li>\n<li>方法调用<ul>\n<li>方法调用入参、返回值查看。</li>\n<li>方法被调用的调用路径、调用耗时、方法调用次数、成功次数、失败次数等统计。</li>\n<li>记录和重做方法调用。</li>\n</ul>\n</li>\n<li>类文件处理<ul>\n<li> dump 已加载类的字节码、字节码反编译、类编译、类重新热加载。</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"模块关系\"><a href=\"#模块关系\" class=\"headerlink\" title=\"模块关系\"></a>模块关系</h3><p>整体宏观模块调用图：</p>\n<p><img src=\"/images/2020/08/1596698216827.png\" alt=\"1596698216827\" loading=\"lazy\"></p>\n<p>模块描述：</p>\n<p><img src=\"/images/2020/08/1596616373228.png\" alt=\"1596616373228\" loading=\"lazy\"></p>\n<h3 id=\"核心类描述\"><a href=\"#核心类描述\" class=\"headerlink\" title=\"核心类描述\"></a>核心类描述</h3><p>核心类描述：</p>\n<p><img src=\"/images/2020/08/1596710846489.png\" alt=\"1596710846489\" loading=\"lazy\"></p>\n<p>核心类描述（精简版）</p>\n<p><img src=\"/images/2020/08/1596700025625.png\" alt=\"1596700025625\" loading=\"lazy\"></p>\n<h3 id=\"常用命令汇总\"><a href=\"#常用命令汇总\" class=\"headerlink\" title=\"常用命令汇总\"></a>常用命令汇总</h3><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2lzc3Vlcy8xMDAz\">Arthas 常用命令汇总<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p><img src=\"/images/2020/08/1596701687793.png\" alt=\"1596701687793\" loading=\"lazy\"></p>\n","categories":["Java","Arthas"],"tags":["Java","Java诊断","Arthas"]},{"title":"迁移 VMware 虚拟机至微软 Hyper-V","url":"/2020/07/2020-07-31-%E8%BF%81%E7%A7%BBVMware%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%87%B3%E5%BE%AE%E8%BD%AFHyper-V/","content":"<h3 id=\"Hyper-V-虚拟机\"><a href=\"#Hyper-V-虚拟机\" class=\"headerlink\" title=\"Hyper-V 虚拟机\"></a>Hyper-V 虚拟机</h3><p>Hyper-V 是微软的一款虚拟化产品，是微软第一个采用类似 Vmware ESXi 和 Citrix Xen 的基于 hypervisor 的技术。</p>\n<h3 id=\"开启-Hyper-V\"><a href=\"#开启-Hyper-V\" class=\"headerlink\" title=\"开启 Hyper-V\"></a>开启 Hyper-V</h3><p>进入电脑的控制面板 -&gt; 程序 -&gt; 启用或关闭 Windows 功能 -&gt; 把 Hyper-v 勾上，启用后电脑会重启。</p>\n<p><img src=\"/images/2020/07/1595925972986.png\" alt=\"1595925972986\" loading=\"lazy\"></p>\n<h3 id=\"迁移VMware虚拟机\"><a href=\"#迁移VMware虚拟机\" class=\"headerlink\" title=\"迁移VMware虚拟机\"></a>迁移 VMware 虚拟机</h3><h4 id=\"使用微软MVMC工具实现迁移\"><a href=\"#使用微软MVMC工具实现迁移\" class=\"headerlink\" title=\"使用微软MVMC工具实现迁移\"></a>使用微软 MVMC 工具实现迁移</h4><p>MVMC 工具可以直接由微软官网下载</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5taWNyb3NvZnQuY29tL2VuLXVzL2Rvd25sb2FkL2RldGFpbHMuYXNweD9pZD00MjQ5Nw==\">下载链接<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<p>下载完成后，将安装文件拷贝到要安装 MVMC 的服务器上。</p>\n<h4 id=\"安装StarWind-V2V-Converter\"><a href=\"#安装StarWind-V2V-Converter\" class=\"headerlink\" title=\"安装StarWind V2V Converter\"></a>安装 StarWind V2V Converter</h4><p>下载 StarWind V2V Converter 安装文件并执行安装，安装过程按照引导进行即可。</p>\n<p>安装完成后，打开 <code>StarWind V2V Image Converter</code>。</p>\n<p>选择 Local file：</p>\n<p><img src=\"/images/2020/07/1596174987682.png\" alt=\"1596174987682\" loading=\"lazy\"></p>\n<p>Next，选择 VMware 虚拟机的 vmdk 文件：</p>\n<p><img src=\"/images/2020/07/1596175078239.png\" alt=\"1596175078239\" loading=\"lazy\"></p>\n<p>再点击 Next，等待转换完成，即可。</p>\n<p><img src=\"/images/2020/07/1596174902166.png\" alt=\"1596174902166\" loading=\"lazy\"></p>\n<h4 id=\"导入-vhd-文件\"><a href=\"#导入-vhd-文件\" class=\"headerlink\" title=\"导入 vhd 文件\"></a>导入 vhd 文件</h4><p>打开 Hyper-V，新建虚拟机。</p>\n<p>指定名称和存储位置。</p>\n<p><img src=\"/images/2020/07/1596175210979.png\" alt=\"1596175210979\" loading=\"lazy\"></p>\n<p>指定虚拟机的代数，选择第一代。</p>\n<blockquote>\n<p>Windows10 Hyper-V 支持的虚拟机文件格式有两代，第一代的文件后缀为.vhd；第二代的文件后缀为.vhdx。</p>\n</blockquote>\n<p><img src=\"/images/2020/07/1596175283830.png\" alt=\"1596175283830\" loading=\"lazy\"></p>\n<p>分配内存：</p>\n<p><img src=\"/images/2020/07/1596175352095.png\" alt=\"1596175352095\" loading=\"lazy\"></p>\n<p>配置网络：</p>\n<p><img src=\"/images/2020/07/1596175380895.png\" alt=\"1596175380895\" loading=\"lazy\"></p>\n<p>选择指定刚刚生成的.vhd 文件：</p>\n<p><img src=\"/images/2020/07/1596175428931.png\" alt=\"1596175428931\" loading=\"lazy\"></p>\n<p>转换导入成功，接下来，虚拟机就可以运行了。</p>\n<h3 id=\"Hyper-v虚拟机联网配置\"><a href=\"#Hyper-v虚拟机联网配置\" class=\"headerlink\" title=\"Hyper-v虚拟机联网配置\"></a>Hyper-v 虚拟机联网配置</h3><h4 id=\"新建虚拟交换机\"><a href=\"#新建虚拟交换机\" class=\"headerlink\" title=\"新建虚拟交换机\"></a>新建虚拟交换机</h4><p>选择：</p>\n<p><img src=\"/images/2020/07/1596175872059.png\" alt=\"1596175872059\" loading=\"lazy\"></p>\n<p>输入交换机名称和选择外部网络，可以看到外部网络的下拉框的选项，这里选择当前计算机的联网方式。</p>\n<p>如何知道当前使用什么方式联网呢？--- 查看网络适配器。</p>\n<p><img src=\"/images/2020/07/1596176082370.png\" alt=\"1596176082370\" loading=\"lazy\"></p>\n<p><strong>如果主机切换了联网方式，只要去虚拟机里改下对应的下拉选项即可。</strong></p>\n<p><img src=\"/images/2020/07/1596175973333.png\" alt=\"1596175973333\" loading=\"lazy\"></p>\n<p>点击确定，建立虚拟交换机。</p>\n<h4 id=\"更改虚拟机的网络适配器\"><a href=\"#更改虚拟机的网络适配器\" class=\"headerlink\" title=\"更改虚拟机的网络适配器\"></a>更改虚拟机的网络适配器</h4><p>右键 --- 设置 --- 网络适配器：</p>\n<p><img src=\"/images/2020/07/1596176189357.png\" alt=\"1596176189357\" loading=\"lazy\"></p>\n<h3 id=\"debian-设置网络\"><a href=\"#debian-设置网络\" class=\"headerlink\" title=\"debian 设置网络\"></a>debian 设置网络</h3><p>问题描述：</p>\n<p>配置完 /etc/networking/interfaces 后，使用 /etc/init.d/networking restart 出现启动失败，根据提示输入 systemctl status networking.service 发现不认识 /etc/networking/interfaces 中配置的虚拟网卡 (或者是因为虚拟机的重新移动导致的设备不匹配问题等)</p>\n<p>解决方法：</p>\n<p>首先可以查看 etc/udev/rules.d/70-persistent-net.rules 是否存在，如果存在，则删除 rm etc/udev/rules.d/70-persistent-net.rules，重启即可</p>\n<p>如果 etc/udev/rules.d/70-persistent-net.rules 不存在，则 ifconfig -a 查看全部网卡，修改 /etc/networking/interfaces 中的网卡名和 ifconfig -a 命令显示的网卡名匹配，重启网络即可。</p>\n","categories":["Windows","软件"],"tags":["Windows","软件"]},{"title":"Arthas 之 jad 反编译原理","url":"/2020/08/2020-08-04-Arthas%E4%B9%8Bjad%E5%8F%8D%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/","content":"<h3 id=\"jad-命令介绍\"><a href=\"#jad-命令介绍\" class=\"headerlink\" title=\"jad 命令介绍\"></a>jad 命令介绍</h3><p>jad 即 java decompiler，把 JVM 已加载类的字节码反编译成 Java 代码。</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbGliYWJhLmdpdGh1Yi5pby9hcnRoYXMvamFkLmh0bWw=\">https://alibaba.github.io/arthas/jad.html<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<h3 id=\"获取到类的字节码\"><a href=\"#获取到类的字节码\" class=\"headerlink\" title=\"获取到类的字节码\"></a>获取到类的字节码</h3><p>反编译有两部分工作：</p>\n<ol>\n<li>获取到字节码</li>\n<li>反编译为 Java 代码</li>\n</ol>\n<p>那么怎么从运行的 JVM 里获取到字节码？</p>\n<p>最常见的思路是，在 <code>classpaths</code> 下面查找，比如 <code>ClassLoader.getResource(\"java/lang/String.class\")</code>，但是这样子查找到的字节码不一定对。比如可能有多个冲突的 jar，或者有 Java Agent 修改了字节码。</p>\n<h3 id=\"ClassFileTransformer机制\"><a href=\"#ClassFileTransformer机制\" class=\"headerlink\" title=\"ClassFileTransformer机制\"></a>ClassFileTransformer 机制</h3><p>从 JDK 1.5 起，有一套 <code>ClassFileTransformer</code> 的机制，Java Agent 通过 <code>Instrumentation</code> 注册 <code>ClassFileTransformer</code>，那么在类加载或者 <code>retransform</code> 时就可以回调修改字节码。</p>\n<p>显然，在 Arthas 里，要增强的类是已经被加载的，所以它们的字节码都是在 <code>retransform</code> 时被修改的。<br>通过显式调用 <code>Instrumentation.retransformClasses(Class&lt;?&gt;...)</code> 可以触发回调。</p>\n<p>Arthas 里增强字节码的 <code>watch</code>/<code>trace</code>/<code>stack</code>/<code>tt</code> 等命令都是通过 <code>ClassFileTransformer</code> 来实现的。</p>\n<p><code>java.lang.instrument.ClassFileTransformer</code> 的接口如下：</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ClassFileTransformer</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token function\">transform</span><span class=\"token punctuation\">(</span>  <span class=\"token class-name\">ClassLoader</span>         loader<span class=\"token punctuation\">,</span>\n                <span class=\"token class-name\">String</span>              className<span class=\"token punctuation\">,</span>\n                <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">&gt;</span></span>            classBeingRedefined<span class=\"token punctuation\">,</span>\n                <span class=\"token class-name\">ProtectionDomain</span>    protectionDomain<span class=\"token punctuation\">,</span>\n                <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>              classfileBuffer<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IllegalClassFormatException</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\n<p>看到这里，读者应该猜到 <code>jad</code> 是怎么获取到字节码的了：</p>\n<ol>\n<li>注册一个 <code>ClassFileTransformer</code></li>\n<li>通过 <code>Instrumentation.retransformClasses</code> 触发回调</li>\n<li>在回调的 <code>transform</code> 函数里获取到字节码</li>\n<li>删掉注册的 <code>ClassFileTransformer</code></li>\n</ol>\n<h3 id=\"使用cfr来反编译\"><a href=\"#使用cfr来反编译\" class=\"headerlink\" title=\"使用cfr来反编译\"></a>使用 cfr 来反编译</h3><p>获取到字节码之后，怎样转换为 Java 代码呢？</p>\n<p>以前大家使用比较多的反编译软件可能是 <code>jd-gui</code>，但是它不支持 JDK8 的 lambda 语法和一些新版本 JDK 的特性。</p>\n<p>后面比较成熟的反编译软件是 <code>cfr</code>，它以前是不开源的。直到最近的 <code>0.145</code> 版本，作者终于开源了，可喜可贺。地址是</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2xlaWJuaXR6MjcvY2Zy\">https://github.com/leibnitz27/cfr<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<p>在 Arthas <code>jad</code> 命令里，通过调用 <code>cfr</code> 来完成反编译。</p>\n<h3 id=\"jad-命令的缺陷\"><a href=\"#jad-命令的缺陷\" class=\"headerlink\" title=\"jad 命令的缺陷\"></a>jad 命令的缺陷</h3><p>99% 的情况下，<code>jad</code> 命令 dump 下来的字节码是准确的，除了一些极端情况。</p>\n<ol>\n<li>因为 JVM 里注册的 <code>ClassFileTransformer</code> 可能有多个，那么在 JVM 里运行的字节码里，可能是被多个 <code>ClassFileTransformer</code> 处理过的。</li>\n<li>触发了 <code>retransformClasses</code> 之后，这些注册的 <code>ClassFileTransformer</code> 会被依次回，上一个处理的字节码传递到下一个。<br>所以不能保证这些 <code>ClassFileTransformer</code> 第二次执行会返回同样的结果。</li>\n<li>有可能一些 <code>ClassFileTransformer</code> 会被删掉，触发 <code>retransformClasses</code> 之后，之前的一些修改就会丢失掉。</li>\n</ol>\n<p>所以目前在 Arthas 里，如果开两个窗口，一个窗口执行 <code>watch</code>/<code>tt</code> 等命令，另一个窗口对这个类执行 <code>jad</code>，那么可以观察到 <code>watch</code>/<code>tt</code> 停止了输出，实际上是因为字节码在触发了 <code>retransformClasses</code> 之后，<code>watch</code>/<code>tt</code> 所做的修改丢失了。</p>\n<h3 id=\"精确获取字节码\"><a href=\"#精确获取字节码\" class=\"headerlink\" title=\"精确获取字节码\"></a>精确获取字节码</h3><p>如果想精确获取到 JVM 内运行的 Java 字节码，可以使用这个 <code>dumpclass</code> 工具，它是通过 <code>sa-jdi.jar</code> 来实现的，保证 dump 下来的字节码是 JVM 内所运行的。</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hlbmd5dW5hYmMvZHVtcGNsYXNz\">https://github.com/hengyunabc/dumpclass<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<h3 id=\"jad-命令实现过程\"><a href=\"#jad-命令实现过程\" class=\"headerlink\" title=\"jad 命令实现过程\"></a>jad 命令实现过程</h3><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL21haW4vamF2YS9jb20vdGFvYmFvL2FydGhhcy9jb3JlL2NvbW1hbmQva2xhc3MxMDAvSmFkQ29tbWFuZC5qYXZh\">JadCommand.java<i class=\"fa fa-external-link-alt\"></i></span>：</p>\n<p><code>process()</code> -&gt; <code>processExactMatch()</code> -&gt; <code>Decompiler.decompile()</code></p>\n<h3 id=\"cfr反编译示例\"><a href=\"#cfr反编译示例\" class=\"headerlink\" title=\"cfr反编译示例\"></a>cfr 反编译示例</h3><p>参考 Arthas 代码：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL21haW4vamF2YS9jb20vdGFvYmFvL2FydGhhcy9jb3JlL3V0aWwvRGVjb21waWxlci5qYXZh\">com.taobao.arthas.core.util.Decompiler.java<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h4 id=\"引入依赖\"><a href=\"#引入依赖\" class=\"headerlink\" title=\"引入依赖\"></a>引入依赖</h4><p>首先，需要引入 maven 依赖：</p>\n<pre class=\"language-xml\" data-language=\"xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>org.benf<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>cfr<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">&gt;</span></span>0.150<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">&gt;</span></span></code></pre>\n\n<h4 id=\"编写方法\"><a href=\"#编写方法\" class=\"headerlink\" title=\"编写方法\"></a>编写方法</h4><p>编写反编译类 <code>sample.utils.Decompiler</code>：</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\">\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">decompile</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> classFilePath<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> methodName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">decompile</span><span class=\"token punctuation\">(</span>classFilePath<span class=\"token punctuation\">,</span> methodName<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/**\n * @param classFilePath\n * @param methodName\n * @param hideUnicode\n * @return\n */</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">decompile</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> classFilePath<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> methodName<span class=\"token punctuation\">,</span> <span class=\"token keyword\">boolean</span> hideUnicode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">final</span> <span class=\"token class-name\">StringBuilder</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringBuilder</span><span class=\"token punctuation\">(</span><span class=\"token number\">8192</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">OutputSinkFactory</span> mySink <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OutputSinkFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token annotation punctuation\">@Override</span>\n        <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SinkClass</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">getSupportedSinks</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SinkType</span> sinkType<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SinkClass</span><span class=\"token punctuation\">&gt;</span></span> collection<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">asList</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SinkClass</span><span class=\"token punctuation\">.</span>STRING<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SinkClass</span><span class=\"token punctuation\">.</span>DECOMPILED<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SinkClass</span><span class=\"token punctuation\">.</span>DECOMPILED_MULTIVER<span class=\"token punctuation\">,</span>\n                            <span class=\"token class-name\">SinkClass</span><span class=\"token punctuation\">.</span>EXCEPTION_MESSAGE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token annotation punctuation\">@Override</span>\n        <span class=\"token keyword\">public</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token class-name\">Sink</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">getSink</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">SinkType</span> sinkType<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SinkClass</span> sinkClass<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Sink</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token annotation punctuation\">@Override</span>\n                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> sinkable<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token comment\">// skip message like: Analysing type demo.MathGame</span>\n                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sinkType <span class=\"token operator\">==</span> <span class=\"token class-name\">SinkType</span><span class=\"token punctuation\">.</span>PROGRESS<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                    result<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>sinkable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> options <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">/**\n     * @see org.benf.cfr.reader.util.MiscConstants.Version.getVersion() Currently,\n     *      the cfr version is wrong. so disable show cfr version.\n     */</span>\n    options<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"showversion\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"false\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    options<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hideutf\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span>hideUnicode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isBlank</span><span class=\"token punctuation\">(</span>methodName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        options<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"methodname\"</span><span class=\"token punctuation\">,</span> methodName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token class-name\">CfrDriver</span> driver <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CfrDriver</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">withOptions</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">withOutputSink</span><span class=\"token punctuation\">(</span>mySink<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> toAnalyse <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    toAnalyse<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>classFilePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    driver<span class=\"token punctuation\">.</span><span class=\"token function\">analyse</span><span class=\"token punctuation\">(</span>toAnalyse<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\n<h4 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h4><pre class=\"language-none\"><code class=\"language-none\">String className = \"sample/redefine/RedefineSuccess.class\";\nString classPath = Thread.currentThread().getContextClassLoader().getResource(className).getFile();\nSystem.out.println(classPath);\n\nString result = decompile(classPath, null);\nSystem.out.println(result);\n\nString result2 = decompile(classPath, \"printFlag\");\nSystem.out.println(result2);</code></pre>\n\n<h4 id=\"输出\"><a href=\"#输出\" class=\"headerlink\" title=\"输出\"></a>输出</h4><pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token operator\">/</span><span class=\"token class-name\">C</span><span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token class-name\">Codes</span><span class=\"token operator\">/</span><span class=\"token class-name\">JavaWorkSpace</span><span class=\"token operator\">/</span>workspace48<span class=\"token operator\">/</span>arthas<span class=\"token operator\">-</span>demo<span class=\"token operator\">/</span>target<span class=\"token operator\">/</span>classes<span class=\"token operator\">/</span>sample<span class=\"token operator\">/</span>redefine<span class=\"token operator\">/</span><span class=\"token class-name\">RedefineSuccess</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span>\n<span class=\"token comment\">/*\n * Decompiled with CFR.\n */</span>\n<span class=\"token keyword\">package</span> <span class=\"token namespace\">sample<span class=\"token punctuation\">.</span>redefine</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RedefineSuccess</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span>SECONDS<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">3L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">RedefineSuccess</span><span class=\"token punctuation\">.</span><span class=\"token function\">printFlag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">printFlag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">boolean</span> flag <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"flag is true.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"flag is false.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">printFlag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">boolean</span> flag <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"flag is true.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"flag is false.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\n<h3 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h3><blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2hlbmd5dW5hYmMuZ2l0aHViLmlvL2FydGhhcy1qYWQv\">http://hengyunabc.github.io/arthas-jad/<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n","categories":["Java","Arthas"],"tags":["Java","Java诊断","Arthas"]},{"title":"idea 相关配置总结","url":"/2020/07/2020-08-06-idea%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%E6%80%BB%E7%BB%93/","content":"<h3 id=\"对maven仓库建立快捷方式\"><a href=\"#对maven仓库建立快捷方式\" class=\"headerlink\" title=\"对maven仓库建立快捷方式\"></a>对 maven 仓库建立快捷方式</h3><p>对于 maven 仓库配置在其他磁盘的情况，建立快捷方式。</p>\n<p>使用管理员权限执行如下命令：</p>\n<pre class=\"language-powershell\" data-language=\"powershell\"><code class=\"language-powershell\">cmd <span class=\"token operator\">/</span>c mklink <span class=\"token operator\">/</span>D C:\\Users\\hzweiyongqiang\\<span class=\"token punctuation\">.</span>m2\\repository E:\\code\\Java\\repository</code></pre>\n\n<h3 id=\"配置阿里云中央仓库\"><a href=\"#配置阿里云中央仓库\" class=\"headerlink\" title=\"配置阿里云中央仓库\"></a>配置阿里云中央仓库</h3><p>进入到 idea 安装目录，找到 \\plugins\\maven\\lib 目录，可以看到 maven 有几个</p>\n<p><img src=\"/images/2020/08/1596678866870.png\" alt=\"1596678866870\" loading=\"lazy\"></p>\n<p>修改 maven3 下 conf 目录下的 settings.xml 。</p>\n<p>找到 mirrors，添加以下内容：</p>\n<pre class=\"language-xml\" data-language=\"xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mirror</span><span class=\"token punctuation\">&gt;</span></span>  \n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>id</span><span class=\"token punctuation\">&gt;</span></span>alimaven<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>id</span><span class=\"token punctuation\">&gt;</span></span>  \n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">&gt;</span></span>aliyun maven<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">&gt;</span></span>  \n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>url</span><span class=\"token punctuation\">&gt;</span></span>http://maven.aliyun.com/nexus/content/groups/public/<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>url</span><span class=\"token punctuation\">&gt;</span></span>  \n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mirrorOf</span><span class=\"token punctuation\">&gt;</span></span>central<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mirrorOf</span><span class=\"token punctuation\">&gt;</span></span>          \n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mirror</span><span class=\"token punctuation\">&gt;</span></span></code></pre>\n\n<p>修改后保存，打开 idea，菜单 file-settings, 搜索 maven，选择刚才修改的 maven：</p>\n<p><img src=\"/images/2020/08/1596679064163.png\" alt=\"1596679064163\" loading=\"lazy\"></p>\n<p>设置好后保存，以后使用 maven 速度会提升很多倍。</p>\n<h3 id=\"鼠标控制放大缩小\"><a href=\"#鼠标控制放大缩小\" class=\"headerlink\" title=\"鼠标控制放大缩小\"></a>鼠标控制放大缩小</h3><p>File -&gt; Setting -&gt; Editor -&gt; General</p>\n<p><img src=\"/images/2020/08/1596680119868.png\" alt=\"1596680119868\" loading=\"lazy\"></p>\n","categories":["软件","IDE"],"tags":["软件","IDE","idea"]},{"title":"搭建 hexo+github+next 主题博客","url":"/2020/08/2020-08-07-%E6%90%AD%E5%BB%BAhexo+github+next%E4%B8%BB%E9%A2%98%E5%8D%9A%E5%AE%A2/","content":"<h3 id=\"博客介绍\"><a href=\"#博客介绍\" class=\"headerlink\" title=\"博客介绍\"></a>博客介绍</h3><p>博客预览地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy8=\">https://theme-next.js.org/<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h3 id=\"搭建博客\"><a href=\"#搭建博客\" class=\"headerlink\" title=\"搭建博客\"></a>搭建博客</h3><p>GitHub：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvdGhlbWUtbmV4dC1kb2Nz\">https://github.com/next-theme/theme-next-docs<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p>在本地安装：</p>\n<pre class=\"language-shell\" data-language=\"shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> clone https://github.com/next-theme/theme-next-docs\n<span class=\"token builtin class-name\">cd</span> theme-next-docs\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span></code></pre>\n\n<p>生成：</p>\n<pre class=\"language-none\"><code class=\"language-none\">npx hexo generate</code></pre>\n\n<p>运行：</p>\n<pre class=\"language-none\"><code class=\"language-none\">npx hexo server</code></pre>\n\n<h3 id=\"博客主题\"><a href=\"#博客主题\" class=\"headerlink\" title=\"博客主题\"></a>博客主题</h3><p>GitHub：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvaGV4by10aGVtZS1uZXh0\">https://github.com/next-theme/hexo-theme-next<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h3 id=\"发布到github-io\"><a href=\"#发布到github-io\" class=\"headerlink\" title=\"发布到github.io\"></a>发布到 github.io</h3><p>在 hexo 下的_config.yml 文件中配置：</p>\n<pre class=\"language-yml\" data-language=\"yml\"><code class=\"language-yml\">deploy:\n  type: git\n  repository: git@github.com:Jueee/jueee.github.io.git\n  branch: master</code></pre>\n\n<p>安装插件：</p>\n<pre class=\"language-none\"><code class=\"language-none\">npm install hexo-deployer-git --save</code></pre>\n\n<p>打开你的 git bash，输入 <code>hexo d</code> 就会将本次有改动的代码全部提交，没有改动的不会：</p>\n<pre class=\"language-none\"><code class=\"language-none\">$ npx hexo g -d</code></pre>\n\n<p>【注】部署这个命令一定要用 git bash，否则会提示 <code>Permission denied (publickey).</code></p>\n<p>此时，会在项目中生成 <code>.deploy_git</code> 文件夹。</p>\n<p>打开 git bash，切换到 hexo/.deploy_git，执行</p>\n<pre class=\"language-none\"><code class=\"language-none\">git init</code></pre>\n\n<p>再绑定远程仓库</p>\n<pre class=\"language-none\"><code class=\"language-none\">git remote add origin git@github.com:jueee/jueee.github.io.git</code></pre>\n\n<p>回到 cmd 命令行</p>\n<pre class=\"language-none\"><code class=\"language-none\">$ npx hexo g -d</code></pre>\n\n<p>搞定了，成功提交了正确的博客内容。</p>\n<h3 id=\"常用hexo命令\"><a href=\"#常用hexo命令\" class=\"headerlink\" title=\"常用hexo命令\"></a>常用 hexo 命令</h3><p>常见命令</p>\n<pre class=\"language-none\"><code class=\"language-none\">hexo new \"postName\" #新建文章\nhexo new page \"pageName\" #新建页面\nhexo generate #生成静态页面至public目录\nhexo server #开启预览访问端口（默认端口4000，'ctrl + c'关闭server）\nhexo deploy #部署到GitHub\nhexo help  # 查看帮助\nhexo version  #查看Hexo的版本</code></pre>\n\n<p>缩写：</p>\n<pre class=\"language-none\"><code class=\"language-none\">hexo n == hexo new\nhexo g == hexo generate\nhexo s == hexo server\nhexo d == hexo deploy</code></pre>\n\n<p>组合命令：</p>\n<pre class=\"language-none\"><code class=\"language-none\">hexo s -g #生成并本地预览\nhexo d -g #生成并上传</code></pre>\n\n<h3 id=\"问题处理\"><a href=\"#问题处理\" class=\"headerlink\" title=\"问题处理\"></a>问题处理</h3><pre class=\"language-none\"><code class=\"language-none\">PS E:\\code\\GitHub\\Jueee\\jueee-blog&gt; npx hexo clean\n(node:44956) ExperimentalWarning: The fs.promises API is experimental\nERROR { err:\n   E:\\code\\GitHub\\Jueee\\jueee-blog\\node_modules\\hexo-theme-next\\package.json:2\n     \"_from\": \"hexo-theme-next@8.0.0-rc.5\",</code></pre>\n\n<p>查看 node 版本</p>\n<pre class=\"language-none\"><code class=\"language-none\">node -v\nv10.16.0\nnpm -v\n6.9.0</code></pre>\n\n<p>需要升级 node 到最新版。</p>\n<p>下载地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ub2RlanMub3JnL3poLWNuL2Rvd25sb2FkLw==\">https://nodejs.org/zh-cn/download/<i class=\"fa fa-external-link-alt\"></i></span></p>\n","categories":["Blog"],"tags":["Blog","Node.js"]},{"title":"hexo 博客个性化设置","url":"/2020/08/2020-08-08-hexo%E5%8D%9A%E5%AE%A2%E4%B8%AA%E6%80%A7%E5%8C%96%E8%AE%BE%E7%BD%AE/","content":"<h3 id=\"创建categories\"><a href=\"#创建categories\" class=\"headerlink\" title=\"创建categories\"></a>创建 categories</h3><ol>\n<li><p><strong>新建一个页面，命名为 categories。命令如下：</strong></p>\n<pre class=\"language-none\"><code class=\"language-none\">npx hexo new page categories</code></pre>\n\n<p>在 myBlog/source 下会新生成一个新的文件夹 categories<br>，在该文件夹下会有一个 index.md 文件。</p>\n</li>\n<li><p><strong>编辑 categories 文件夹下的 index.md</strong></p>\n<pre class=\"language-none\"><code class=\"language-none\">title: categories\ndate: 2020-08-07 10:29:47\ntype: \"categories\"\ncomments: false</code></pre>\n</li>\n<li><p><strong>在菜单中添加链接。</strong></p>\n<p>编辑主题的 <code>_config.next.yml</code>，将 menu 中的 categories: /categories 注释去掉，如下:</p>\n<pre class=\"language-none\"><code class=\"language-none\">categories: /categories/ || fa fa-fw fa-th</code></pre>\n</li>\n<li><p><strong>安装依赖</strong></p>\n<pre class=\"language-none\"><code class=\"language-none\">npm install hexo-generator-index --save\nnpm install hexo-generator-archive --save\nnpm install hexo-generator-category --save\nnpm install hexo-generator-tag --save</code></pre>\n\n</li>\n</ol>\n<p>参考：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvL3dpa2kvTWlncmF0aW5nLWZyb20tMi54LXRvLTMuMA==\">https://github.com/hexojs/hexo/wiki/Migrating-from-2.x-to-3.0<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h3 id=\"添加README-md\"><a href=\"#添加README-md\" class=\"headerlink\" title=\"添加README.md\"></a>添加 README.md</h3><h4 id=\"添加README-md-1\"><a href=\"#添加README-md-1\" class=\"headerlink\" title=\"添加README.md\"></a>添加 README.md</h4><p>使用 Github Pages 和 Hexo 搭建的博客，如果在最开始建立仓库的时候没有创建 README.md 文件，那么在后期如何添加呢？</p>\n<p>添加方法：在根目录 source 文件夹下新建 README.md 即可。</p>\n<p>新增：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0p1ZWVlL2p1ZWVlLWJsb2cvYmxvYi9tYXN0ZXIvc291cmNlL1JFQURNRS5tZA==\">source/README.md<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p>效果：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0p1ZWVlL2p1ZWVlLmdpdGh1Yi5pbw==\">https://github.com/Jueee/jueee.github.io<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h4 id=\"显示异常\"><a href=\"#显示异常\" class=\"headerlink\" title=\"显示异常\"></a>显示异常</h4><p>当我们执行 <code>hexo g -d</code> 部署博客的时候会发现 README.md 变成了 README.html。</p>\n<p>原因就在于当我们在执行 <code>hexo g -d</code> 命令时，.md 文件会被转化成 HTML 文件，并将这些文件放到 public 目录里，最后再提交到远程 GitHub 仓库。</p>\n<p>而 Hexo 也提供了一个方法，让 md 文件不被转换成 HTML，在根目录的 _config.yml 配置文件里，找到 skip_render 关键字，添加 README.md，让解释器跳过渲染：</p>\n<pre class=\"language-yml\" data-language=\"yml\"><code class=\"language-yml\">skip_render:\n  - README.md</code></pre>\n\n<h3 id=\"修改脚注\"><a href=\"#修改脚注\" class=\"headerlink\" title=\"修改脚注\"></a>修改脚注</h3><p>修改文件： <code>source\\_data\\footer.njk</code></p>\n<pre class=\"language-html\" data-language=\"html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>footer-custom<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>powered-by<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>由 <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://github.com/next-theme/theme-next-docs<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>theme-link<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>noopener<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>_blank<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>Hexo<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">&gt;</span></span> v8.0.0 驱动<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>post-meta-divider<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>|<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>theme-info<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>主题 – <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://github.com/next-theme/hexo-theme-next<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>theme-link<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>noopener<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>_blank<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>Hexo.NexT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">&gt;</span></span> v8.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span></code></pre>\n\n<h3 id=\"代码高亮\"><a href=\"#代码高亮\" class=\"headerlink\" title=\"代码高亮\"></a>代码高亮</h3><p>由于 Hexo 自带的代码高亮主题显示不好看，所以主题中使用到了 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2VsZTgyOC9oZXhvLXByaXNtLXBsdWdpbg==\">hexo-prism-plugin<i class=\"fa fa-external-link-alt\"></i></span> 的 Hexo 插件来做代码高亮，安装命令如下：</p>\n<p>bash</p>\n<pre class=\"language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i -S hexo-prism-plugin</code></pre>\n\n<p>然后，修改 Hexo 根目录下<code>_config.yml</code> 文件中 <code>highlight.enable</code> 的值为 <code>false</code>，并新增 <code>prism</code> 插件相关的配置，主要配置如下：</p>\n<pre class=\"language-yml\" data-language=\"yml\"><code class=\"language-yml\">highlight:\n  enable: false\n\nprism_plugin:\n  mode: 'preprocess'    # realtime/preprocess\n  theme: 'tomorrow'\n  line_number: false    # default false\n  custom_css:</code></pre>\n\n<p>配置参考：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvaGV4by1wcmlzbS1wbHVnaW4=\">https://www.npmjs.com/package/hexo-prism-plugin<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h3 id=\"修改菜单\"><a href=\"#修改菜单\" class=\"headerlink\" title=\"修改菜单\"></a>修改菜单</h3><p>将导航栏的 “归档” 修改为 “博客”。</p>\n<p>修改文件： <code>source\\_data\\languages.yml</code></p>\n<pre class=\"language-yml\" data-language=\"yml\"><code class=\"language-yml\">zh-CN:\n  menu:\n    archives: 博客</code></pre>\n\n<h3 id=\"相关热门帖子\"><a href=\"#相关热门帖子\" class=\"headerlink\" title=\"相关热门帖子\"></a>相关热门帖子</h3><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RlYTMvaGV4by1yZWxhdGVkLXBvcHVsYXItcG9zdHM=\">NexT<i class=\"fa fa-external-link-alt\"></i></span> 根据 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RlYTMvaGV4by1yZWxhdGVkLXBvcHVsYXItcG9zdHM=\">hexo-related-popular-posts<i class=\"fa fa-external-link-alt\"></i></span> 支持相关的帖子功能.</p>\n<p><code>hexo-related-popular-posts</code> 通过执行以下命令来安装网站根目录:</p>\n<pre class=\"language-bash\" data-language=\"bash\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> <span class=\"token function\">install</span> hexo-related-popular-posts\n$ npx hexo clean</code></pre>\n\n<p>可以通过将值设置 <code>related_posts.enable</code> 为 <code>true</code>in 来启用它主题配置文件.</p>\n<pre class=\"language-yml\" data-language=\"yml\"><code class=\"language-yml\">related_posts:\n  enable: true</code></pre>\n\n\n<h3 id=\"更换网页图标\"><a href=\"#更换网页图标\" class=\"headerlink\" title=\"更换网页图标\"></a>更换网页图标</h3><h4 id=\"制作favicon图标\"><a href=\"#制作favicon图标\" class=\"headerlink\" title=\"制作favicon图标\"></a>制作 favicon 图标</h4><ol>\n<li>准备好用作标签页 / 网页小图标 favicon 的图片</li>\n<li>搜索 <em>favicon 在线</em>，可以看到一些在线图片转 favicon 的工具<br>我用的是这个（link）： <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5iaXRidWcubmV0Lw==\">bitbug<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li> 利用工具做成图标。<br>我做了 16x16，与 32x32 的。</li>\n</ol>\n<h4 id=\"编辑配置文件\"><a href=\"#编辑配置文件\" class=\"headerlink\" title=\"编辑配置文件\"></a>编辑配置文件</h4><p>在 next 主题的<strong>_config.yml</strong> 文件，修改新的图片作为 favicon 的对象：</p>\n<pre class=\"language-yml\" data-language=\"yml\"><code class=\"language-yml\">favicon:\n  small: /images/basic/jue.ico\n  medium: /images/basic/jue.ico</code></pre>\n\n","categories":["Blog"],"tags":["Blog","Node.js"]},{"title":"博客网址增加站点分析","url":"/2020/08/2020-08-09-%E5%8D%9A%E5%AE%A2%E7%BD%91%E5%9D%80%E5%A2%9E%E5%8A%A0%E7%AB%99%E7%82%B9%E5%88%86%E6%9E%90/","content":"<h3 id=\"谷歌分析\"><a href=\"#谷歌分析\" class=\"headerlink\" title=\"谷歌分析\"></a>谷歌分析</h3><ol>\n<li><p>创建一个帐户并登录<span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbmFseXRpY3MuZ29vZ2xlLmNvbS8=\"> Google Analytics（分析）<i class=\"fa fa-external-link-alt\"></i></span>。<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdXBwb3J0Lmdvb2dsZS5jb20vYW5hbHl0aWNzLz9obD1lbiN0b3BpYz0zNTQ0OTA2\">更详细的文档<i class=\"fa fa-external-link-alt\"></i></span></p>\n</li>\n<li><p>编辑 主题配置文件并 <code>tracking_id</code> 在部分下填写 <code>google_analytics</code> 您的 Google 跟踪 ID。Google 曲目 ID 始终以开头 <code>UA-</code>。</p>\n<pre class=\"language-yml\" data-language=\"yml\"><code class=\"language-yml\"># Google Analytics\ngoogle_analytics:\ntracking_id: UA-XXXXXXXX-X\nonly_pageview: false</code></pre>\n</li>\n<li><p>当 field <code>only_pageview</code> 设置为 true 时，NexT 将仅向 <code>pageview</code>Google Analytics（分析）发送事件。<br>使用它而不是使用它的好处 <code>only_pageview: false</code> 是减少了站点上的外部脚本，这将为您提供更好的性能，但没有完整的分析功能。</p>\n</li>\n</ol>\n<h3 id=\"百度分析\"><a href=\"#百度分析\" class=\"headerlink\" title=\"百度分析\"></a>百度分析</h3><ol>\n<li><p>登录<span class=\"exturl\" data-url=\"aHR0cHM6Ly90b25namkuYmFpZHUuY29tLw==\">百度分析<i class=\"fa fa-external-link-alt\"></i></span> 并找到网站代码获取页面。</p>\n</li>\n<li><p>在后面复制脚本 ID <code>hm.js?</code>，如下图：</p>\n<p><img src=\"/images/2020/08/1597041510807.png\" alt=\"1597041510807\" loading=\"lazy\"></p>\n</li>\n<li><p>编辑 主题配置文件并将部分更改 <code>baidu_analytics</code> 为您的脚本 ID。</p>\n<pre class=\"language-yml\" data-language=\"yml\"><code class=\"language-yml\"># Baidu Analytics ID\nbaidu_analytics: your_id</code></pre>\n\n</li>\n</ol>\n","categories":["Blog"],"tags":["Blog"]},{"title":"Arthas 之源码简要分析","url":"/2020/08/2020-08-03-Arthas%E4%B9%8B%E6%BA%90%E7%A0%81%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/","content":"<h3 id=\"启动模块（boot）\"><a href=\"#启动模块（boot）\" class=\"headerlink\" title=\"启动模块（boot）\"></a>启动模块（boot）</h3><h4 id=\"启动-Arthas\"><a href=\"#启动-Arthas\" class=\"headerlink\" title=\"启动 Arthas\"></a>启动 Arthas</h4><pre class=\"language-shell\" data-language=\"shell\"><code class=\"language-shell\"><span class=\"token function\">wget</span> https://alibaba.github.io/arthas/arthas-boot.jar\njava -jar arthas-boot.jar</code></pre>\n\n<p><strong>模块代码</strong>：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL3RyZWUvbWFzdGVyL2Jvb3Q=\">GitHub Code by arthas-boot<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h4 id=\"模块入口\"><a href=\"#模块入口\" class=\"headerlink\" title=\"模块入口\"></a>模块入口</h4><p>在 arthas-boot 模块的 pom.xml 文件中，找到启动类：</p>\n<pre class=\"language-xml\" data-language=\"xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>manifest</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mainClass</span><span class=\"token punctuation\">&gt;</span></span>com.taobao.arthas.boot.Bootstrap<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mainClass</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>manifest</span><span class=\"token punctuation\">&gt;</span></span></code></pre>\n\n<p><code>com.taobao.arthas.boot.Bootstrap.main()</code> 方法：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2Jsb2IvbWFzdGVyL2Jvb3Qvc3JjL21haW4vamF2YS9jb20vdGFvYmFvL2FydGhhcy9ib290L0Jvb3RzdHJhcC5qYXZhI0wyNzM=\">GitHub Code by Bootstrap.java<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h4 id=\"源码分析\"><a href=\"#源码分析\" class=\"headerlink\" title=\"源码分析\"></a>源码分析</h4><h5 id=\"参数解析\"><a href=\"#参数解析\" class=\"headerlink\" title=\"参数解析\"></a>参数解析</h5><p>使用了阿里开源的组件 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvY2xp\">cli<i class=\"fa fa-external-link-alt\"></i></span>，对参数进行了解析。</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token class-name\">CLI</span> cli <span class=\"token operator\">=</span> <span class=\"token class-name\">CLIConfigurator</span><span class=\"token punctuation\">.</span><span class=\"token function\">define</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Bootstrap</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">CommandLine</span> commandLine <span class=\"token operator\">=</span> cli<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">asList</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">CLIConfigurator</span><span class=\"token punctuation\">.</span><span class=\"token function\">inject</span><span class=\"token punctuation\">(</span>commandLine<span class=\"token punctuation\">,</span> bootstrap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token function\">usage</span><span class=\"token punctuation\">(</span>cli<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\n<h5 id=\"参数处理\"><a href=\"#参数处理\" class=\"headerlink\" title=\"参数处理\"></a>参数处理</h5><p>对传入的参数进行处理。</p>\n<p>如调整日志级别，设置 RepoMirror 地址，Java 版本，telnet/http 的端口检查。</p>\n<h5 id=\"检查-pid\"><a href=\"#检查-pid\" class=\"headerlink\" title=\"检查 pid\"></a>检查 pid</h5><p>如果在传入参数中没有 pid，则会调用本地 jps 命令，列出 java 进程（当然会排除本身）</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">long</span> pid <span class=\"token operator\">=</span> bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">getPid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// select pid</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pid <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        pid <span class=\"token operator\">=</span> <span class=\"token class-name\">ProcessUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span>bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">isVerbose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> telnetPortPid<span class=\"token punctuation\">,</span> bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">getSelect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InputMismatchException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Please input an integer to select pid.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pid <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Please select an available pid.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2Jsb2IvbWFzdGVyL2Jvb3Qvc3JjL21haW4vamF2YS9jb20vdGFvYmFvL2FydGhhcy9ib290L1Byb2Nlc3NVdGlscy5qYXZhI0wxMjM=\">GitHub Code by ProcessUtils.java<i class=\"fa fa-external-link-alt\"></i></span></p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">listProcessByJps</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">boolean</span> v<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LinkedHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">String</span> jps <span class=\"token operator\">=</span> <span class=\"token string\">\"jps\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">File</span> jpsFile <span class=\"token operator\">=</span> <span class=\"token function\">findJps</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>jpsFile <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        jps <span class=\"token operator\">=</span> jpsFile<span class=\"token punctuation\">.</span><span class=\"token function\">getAbsolutePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token class-name\">AnsiLog</span><span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Try use jps to lis java process, jps: \"</span> <span class=\"token operator\">+</span> jps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> command <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        command <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span> jps<span class=\"token punctuation\">,</span> <span class=\"token string\">\"-v\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-l\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        command <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span> jps<span class=\"token punctuation\">,</span> <span class=\"token string\">\"-l\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> lines <span class=\"token operator\">=</span> <span class=\"token class-name\">ExecutingCommand</span><span class=\"token punctuation\">.</span><span class=\"token function\">runNative</span><span class=\"token punctuation\">(</span>command<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">AnsiLog</span><span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jps result: \"</span> <span class=\"token operator\">+</span> lines<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">long</span> currentPid <span class=\"token operator\">=</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseLong</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PidUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentPid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> line <span class=\"token operator\">:</span> lines<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> strings <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\\\s+\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>strings<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">long</span> pid <span class=\"token operator\">=</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseLong</span><span class=\"token punctuation\">(</span>strings<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pid <span class=\"token operator\">==</span> currentPid<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>strings<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&gt;=</span> <span class=\"token number\">2</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">isJpsProcess</span><span class=\"token punctuation\">(</span>strings<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// skip jps</span>\n                <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            result<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>pid<span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// https://github.com/alibaba/arthas/issues/970</span>\n            <span class=\"token comment\">// ignore</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\n<h5 id=\"启动服务端\"><a href=\"#启动服务端\" class=\"headerlink\" title=\"启动服务端\"></a>启动服务端</h5><p>进入主逻辑，会在用户目录下建立 <code>.arthas</code> 目录，同时下载 <code>arthas-core</code> 和 <code>arthas-agent</code> 等 lib 文件，然后启动客户端和服务端。</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>telnetPortPid <span class=\"token operator\">&gt;</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> pid <span class=\"token operator\">==</span> telnetPortPid<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">AnsiLog</span><span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"The target process already listen port {}, skip attach.\"</span><span class=\"token punctuation\">,</span> bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">getTelnetPort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//double check telnet port and pid before attach</span>\n    telnetPortPid <span class=\"token operator\">=</span> <span class=\"token function\">findProcessByTelnetClient</span><span class=\"token punctuation\">(</span>arthasHomeDir<span class=\"token punctuation\">.</span><span class=\"token function\">getAbsolutePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">getTelnetPort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">checkTelnetPortPid</span><span class=\"token punctuation\">(</span>bootstrap<span class=\"token punctuation\">,</span> telnetPortPid<span class=\"token punctuation\">,</span> pid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// start arthas-core.jar</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> attachArgs <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-jar\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span>arthasHomeDir<span class=\"token punctuation\">,</span> <span class=\"token string\">\"arthas-core.jar\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAbsolutePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-pid\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span> <span class=\"token operator\">+</span> pid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-target-ip\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">getTargetIp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-telnet-port\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span> <span class=\"token operator\">+</span> bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">getTelnetPort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-http-port\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span> <span class=\"token operator\">+</span> bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">getHttpPort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-core\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span>arthasHomeDir<span class=\"token punctuation\">,</span> <span class=\"token string\">\"arthas-core.jar\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAbsolutePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-agent\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span>arthasHomeDir<span class=\"token punctuation\">,</span> <span class=\"token string\">\"arthas-agent.jar\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAbsolutePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">getSessionTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-session-timeout\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span> <span class=\"token operator\">+</span> bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">getSessionTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">getTunnelServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-tunnel-server\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">getTunnelServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">getAgentId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-agent-id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">getAgentId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">getStatUrl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-stat-url\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        attachArgs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">getStatUrl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token class-name\">AnsiLog</span><span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Try to attach process \"</span> <span class=\"token operator\">+</span> pid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">AnsiLog</span><span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Start arthas-core.jar args: \"</span> <span class=\"token operator\">+</span> attachArgs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 启动服务端</span>\n    <span class=\"token class-name\">ProcessUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">startArthasCore</span><span class=\"token punctuation\">(</span>pid<span class=\"token punctuation\">,</span> attachArgs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">AnsiLog</span><span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Attach process {} success.\"</span><span class=\"token punctuation\">,</span> pid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\n<h5 id=\"启动客户端\"><a href=\"#启动客户端\" class=\"headerlink\" title=\"启动客户端\"></a>启动客户端</h5><p>最后通过反射的方式来启动字符客户端，等待用户输入指令。</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token class-name\">URLClassLoader</span> classLoader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLClassLoader</span><span class=\"token punctuation\">(</span>\n                <span class=\"token keyword\">new</span> URL<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span>arthasHomeDir<span class=\"token punctuation\">,</span> <span class=\"token string\">\"arthas-client.jar\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toURI</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toURL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">&gt;</span></span> telnetConsoleClas <span class=\"token operator\">=</span> classLoader<span class=\"token punctuation\">.</span><span class=\"token function\">loadClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"com.taobao.arthas.client.TelnetConsole\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Method</span> mainMethod <span class=\"token operator\">=</span> telnetConsoleClas<span class=\"token punctuation\">.</span><span class=\"token function\">getMethod</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"main\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n\n<h3 id=\"服务端模块（core）\"><a href=\"#服务端模块（core）\" class=\"headerlink\" title=\"服务端模块（core）\"></a>服务端模块（core）</h3><p><strong>模块代码</strong>：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL3RyZWUvbWFzdGVyL2NvcmU=\">GitHub Code by arthas-core<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h4 id=\"模块入口-1\"><a href=\"#模块入口-1\" class=\"headerlink\" title=\"模块入口\"></a>模块入口</h4><p>在 arthas-core 模块的 pom.xml 中，找到启动类：</p>\n<pre class=\"language-xml\" data-language=\"xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>transformers</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>transformer</span> <span class=\"token attr-name\">implementation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.apache.maven.plugins.shade.resource.ManifestResourceTransformer<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mainClass</span><span class=\"token punctuation\">&gt;</span></span>com.taobao.arthas.core.Arthas<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mainClass</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>transformer</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>transformers</span><span class=\"token punctuation\">&gt;</span></span></code></pre>\n\n<p><code>com.taobao.arthas.core.Arthas.main()</code> 方法：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL21haW4vamF2YS9jb20vdGFvYmFvL2FydGhhcy9jb3JlL0FydGhhcy5qYXZh\">GitHub Code by Arthas.java<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h4 id=\"源码分析-1\"><a href=\"#源码分析-1\" class=\"headerlink\" title=\"源码分析\"></a>源码分析</h4><h5 id=\"连接进程\"><a href=\"#连接进程\" class=\"headerlink\" title=\"连接进程\"></a>连接进程</h5><p>使用 <code>VirutalMachine.attach(pid)</code> 来连接进程，同时使用 <code>virtualMachine.loadAgent</code> 加载自定义的 agent.</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">attachAgent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Configure</span> configure<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 省略部分代码</span>\n    <span class=\"token comment\">// 连接进程</span>\n            virtualMachine <span class=\"token operator\">=</span> <span class=\"token class-name\">VirtualMachine</span><span class=\"token punctuation\">.</span><span class=\"token function\">attach</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span> <span class=\"token operator\">+</span> configure<span class=\"token punctuation\">.</span><span class=\"token function\">getJavaPid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 省略部分代码</span>\n    <span class=\"token comment\">// 动态加载Agent</span>\n        virtualMachine<span class=\"token punctuation\">.</span><span class=\"token function\">loadAgent</span><span class=\"token punctuation\">(</span>arthasAgentPath<span class=\"token punctuation\">,</span>\n                configure<span class=\"token punctuation\">.</span><span class=\"token function\">getArthasCore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\";\"</span> <span class=\"token operator\">+</span> configure<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\n<h3 id=\"JavaAgent代理（agent）\"><a href=\"#JavaAgent代理（agent）\" class=\"headerlink\" title=\"JavaAgent代理（agent）\"></a>JavaAgent 代理（agent）</h3><p><strong>模块代码</strong>：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL3RyZWUvbWFzdGVyL2FnZW50\">GitHub Code by arthas-agent<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h4 id=\"模块入口-2\"><a href=\"#模块入口-2\" class=\"headerlink\" title=\"模块入口\"></a>模块入口</h4><p>在 arthas-core 模块的 pom.xml 中，找到启动类：</p>\n<pre class=\"language-xml\" data-language=\"xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>manifestEntries</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Premain-Class</span><span class=\"token punctuation\">&gt;</span></span>com.taobao.arthas.agent334.AgentBootstrap<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Premain-Class</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Agent-Class</span><span class=\"token punctuation\">&gt;</span></span>com.taobao.arthas.agent334.AgentBootstrap<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Agent-Class</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>manifestEntries</span><span class=\"token punctuation\">&gt;</span></span></code></pre>\n\n<p><code>com.taobao.arthas.agent334.AgentBootstrap.main()</code> 方法：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2Jsb2IvbWFzdGVyL2FnZW50L3NyYy9tYWluL2phdmEvY29tL3Rhb2Jhby9hcnRoYXMvYWdlbnQzMzQvQWdlbnRCb290c3RyYXAuamF2YQ==\">GitHub Code by AgentBootstrap.java<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h4 id=\"源码分析-2\"><a href=\"#源码分析-2\" class=\"headerlink\" title=\"源码分析\"></a>源码分析</h4><p><code>main()</code> 方法中对于 <code>arthas-spy</code>(简单理解为勾子类，类似于 spring aop 的前置方法，后置方法) 进行了加载。</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">final</span> <span class=\"token class-name\">ClassLoader</span> agentLoader <span class=\"token operator\">=</span> <span class=\"token function\">getClassLoader</span><span class=\"token punctuation\">(</span>inst<span class=\"token punctuation\">,</span> arthasCoreJarFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n\n<p>将 spyJar 添加到了 BootstrapClassLoader (启动类加载器)，优先加载启动类加载器，spy 可以在各个 ClassLoader 中使用。</p>\n<pre class=\"language-none\"><code class=\"language-none\">private static ClassLoader getClassLoader(Instrumentation inst, File arthasCoreJarFile) throws Throwable {\n    // 构造自定义的类加载器，尽量减少Arthas对现有工程的侵蚀\n    return loadOrDefineClassLoader(arthasCoreJarFile);\n}</code></pre>\n\n<p>异步调用 bind () 方法，启动服务端，监听端口，和客户端进行通讯。</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token class-name\">Thread</span> bindingThread <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>inst<span class=\"token punctuation\">,</span> agentLoader<span class=\"token punctuation\">,</span> agentArgs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> throwable<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            throwable<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span>ps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n\n","categories":["Java","Arthas"],"tags":["Java","Java诊断","Arthas"]},{"title":"博客网址增加站点地图 sitemap","url":"/2020/08/2020-08-09-%E5%8D%9A%E5%AE%A2%E7%BD%91%E5%9D%80%E5%A2%9E%E5%8A%A0%E7%AB%99%E7%82%B9%E5%9C%B0%E5%9B%BEsitemap/","content":"<p>站点地图是一种文件，您可以通过该文件列出您网站上的网页，从而将您网站内容的组织架构告知 Google 和其他搜索引擎。Googlebot 等搜索引擎网页抓取工具会读取此文件，以便更加智能地抓取您的网站。</p>\n<h3 id=\"站点地图\"><a href=\"#站点地图\" class=\"headerlink\" title=\"站点地图\"></a>站点地图</h3><p>站点地图是一个网站所有链接的容器。很多网站的连接层次比较深，爬虫很难抓取到，站点地图可以方便爬虫抓取网站页面，通过抓取网站页面，清晰了解网站的架构，网站地图一般存放在根目录下并命名 sitemap，为爬虫指路，增加网站重要内容页面的收录。</p>\n<p>站点地图就是根据网站的结构、框架、内容，生成的导航网页文件。站点地图对于提高用户体验有好处，它们为网站访问者指明方向，并帮助迷失的访问者找到他们想看的页面。</p>\n<h3 id=\"添加sitemap\"><a href=\"#添加sitemap\" class=\"headerlink\" title=\"添加sitemap\"></a>添加 sitemap</h3><ol>\n<li><p>安装插件：</p>\n<pre class=\"language-none\"><code class=\"language-none\">npm install hexo-generator-sitemap --save\nnpm install hexo-generator-baidu-sitemap --save</code></pre>\n</li>\n<li><p>在博客目录的_config.yml 中添加如下代码：</p>\n<pre class=\"language-yml\" data-language=\"yml\"><code class=\"language-yml\"># 自动生成sitemap\nsitemap:\n path: sitemap.xml\nbaidusitemap:\n path: baidusitemap.xml</code></pre>\n</li>\n<li><p>编译博客</p>\n<pre class=\"language-shell\" data-language=\"shell\"><code class=\"language-shell\">npx hexo generate</code></pre>\n</li>\n<li><p>在你的博客根目录的 public 下面发现生成了 sitemap.xml 以及 baidusitemap.xml 就表示成功了。</p>\n<p>如下图所示：</p>\n<p><img src=\"/images/2020/08/1597229983009.png\" alt=\"1597229983009\" loading=\"lazy\"></p>\n</li>\n</ol>\n<h3 id=\"查看站点地图\"><a href=\"#查看站点地图\" class=\"headerlink\" title=\"查看站点地图\"></a>查看站点地图</h3><ul>\n<li><a href=\"https://jueee.github.io/sitemap.xml\">sitemap.xml</a></li>\n<li><a href=\"https://jueee.github.io/baidusitemap.xml\">baidusitemap.xml</a></li>\n</ul>\n","categories":["Blog"],"tags":["Blog","SEO"]},{"title":"Neo4j 初始化密码","url":"/2020/08/2020-08-10-Neo4j%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AF%86%E7%A0%81/","content":"<h3 id=\"初始化Neo4j\"><a href=\"#初始化Neo4j\" class=\"headerlink\" title=\"初始化Neo4j\"></a>初始化 Neo4j</h3><p>Web 浏览器访问：<code>http://IP:7474/</code></p>\n<p>连接 URL 为 ：<code>bolt://IP:7687</code>，初始用户名、密码为 <code>neo4j</code>，如下图所示：</p>\n<p><img src=\"/images/2020/08/1597130874884.png\" alt=\"1597130874884\" loading=\"lazy\"></p>\n<p>初始化登录成功后，会要求重置 neo4j 密码，修改并确认新密码。</p>\n<p><img src=\"/images/2020/08/1597130933055.png\" alt=\"1597130933055\" loading=\"lazy\"></p>\n<h3 id=\"浏览器下更改密码\"><a href=\"#浏览器下更改密码\" class=\"headerlink\" title=\"浏览器下更改密码\"></a>浏览器下更改密码</h3><p>Web 浏览器访问：<code>http://IP:7474/</code>，登录成功后，输入命令：</p>\n<pre class=\"language-none\"><code class=\"language-none\">:server change-password</code></pre>\n\n<h3 id=\"命令行更改密码\"><a href=\"#命令行更改密码\" class=\"headerlink\" title=\"命令行更改密码\"></a>命令行更改密码</h3><ol>\n<li>进入 neo4j 安装目录， 并进入 bin 目录；</li>\n<li>运行 <code>./cypher-shell</code> 命令， 输入用户名，密码（初始默认用户名和密码为 neo4j）</li>\n<li>输入命令: <code>CALL dbms.security.changePassword('123456');</code> 输入命令  <code>:exit;</code> 退出</li>\n</ol>\n<p>例如：</p>\n<p><img src=\"/images/2020/08/1597132382397.png\" alt=\"1597132382397\" loading=\"lazy\"></p>\n<h3 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h3><p>neo4j 设置项：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9uZW80ai5jb20vZG9jcy9vcGVyYXRpb25zLW1hbnVhbC9jdXJyZW50L3JlZmVyZW5jZS9wcm9jZWR1cmVzLw==\">https://neo4j.com/docs/operations-manual/current/reference/procedures/<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p>设置初始化密码：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9uZW80ai5jb20vZG9jcy9vcGVyYXRpb25zLW1hbnVhbC9jdXJyZW50L2NvbmZpZ3VyYXRpb24vc2V0LWluaXRpYWwtcGFzc3dvcmQv\">https://neo4j.com/docs/operations-manual/current/configuration/set-initial-password/<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p>密码和用户恢复：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9uZW80ai5jb20vZG9jcy9vcGVyYXRpb25zLW1hbnVhbC9jdXJyZW50L2NvbmZpZ3VyYXRpb24vcGFzc3dvcmQtYW5kLXVzZXItcmVjb3Zlcnkv\">https://neo4j.com/docs/operations-manual/current/configuration/password-and-user-recovery/<i class=\"fa fa-external-link-alt\"></i></span></p>\n","categories":["Neo4j"],"tags":["Neo4j"]},{"title":"MySQL 中 DBlink 的使用","url":"/2020/08/2020-08-11-MySQL%E4%B8%ADDBlink%E7%9A%84%E4%BD%BF%E7%94%A8/","content":"<p>在实际工作中，我们可能会遇到需要操作其他数据库实例的部分表，但又不想系统连接多库。此时我们就需要用到数据表映射。</p>\n<p>如同 Oracle 中的 DBlink 一般，使用过 Oracle DBlink 数据库链接的人都知道可以跨实例来进行数据查询，同样的，Mysql 自带的 FEDERATED 引擎完美的帮我们解决了该问题。</p>\n<h3 id=\"检查引擎\"><a href=\"#检查引擎\" class=\"headerlink\" title=\"检查引擎\"></a>检查引擎</h3><p>查看 target 端是否安装了 FEDERATED 存储引擎：</p>\n<pre class=\"language-mysql\" data-language=\"mysql\"><code class=\"language-mysql\">mysql&gt; show engines ;</code></pre>\n\n<p>例如：</p>\n<p><img src=\"/images/2020/08/1597126521400.png\" alt=\"1597126521400\" loading=\"lazy\"></p>\n<h3 id=\"安装引擎\"><a href=\"#安装引擎\" class=\"headerlink\" title=\"安装引擎\"></a>安装引擎</h3><p>注意：如果没有安装 <strong>FEDERATED 引擎</strong>，执行：</p>\n<pre class=\"language-mysql\" data-language=\"mysql\"><code class=\"language-mysql\">install plugin federated soname 'ha_federated.so';</code></pre>\n\n<p>例如：</p>\n<p><img src=\"/images/2020/08/1597126538702.png\" alt=\"1597126538702\" loading=\"lazy\"></p>\n<p>再次检查引擎：</p>\n<pre class=\"language-mysql\" data-language=\"mysql\"><code class=\"language-mysql\">mysql&gt; show engines ;</code></pre>\n\n<p>例如：</p>\n<p><img src=\"/images/2020/08/1597126564647.png\" alt=\"1597126564647\" loading=\"lazy\"></p>\n<h3 id=\"开启引擎\"><a href=\"#开启引擎\" class=\"headerlink\" title=\"开启引擎\"></a>开启引擎</h3><p>将 federated 添加到 my.cnf 重启数据库</p>\n<pre class=\"language-cnf\" data-language=\"cnf\"><code class=\"language-cnf\">vi /etc/my.cnf\n[mysqld]\nfederated</code></pre>\n\n<p>再次检查引擎，例如：</p>\n<p><img src=\"/images/2020/08/1597126649766.png\" alt=\"1597126649766\" loading=\"lazy\"></p>\n<h3 id=\"建表访问\"><a href=\"#建表访问\" class=\"headerlink\" title=\"建表访问\"></a>建表访问</h3><p>使用 CONNECTION 创建 FEDERATED 引擎表通用模型：</p>\n<pre class=\"language-mysql\" data-language=\"mysql\"><code class=\"language-mysql\">CREATE TABLE (......) \nENGINE =FEDERATED CONNECTION='mysql://username:password@hostname:port/database/tablename'</code></pre>\n\n<p>注意 ENGINE=FEDERATED CONNECTION 后为源端地址 避免使用带 @的密码</p>\n<h3 id=\"使用总结\"><a href=\"#使用总结\" class=\"headerlink\" title=\"使用总结\"></a>使用总结</h3><p>基于 MySQL5.7.23 版本，笔者在源端及目标端实验了多种 DDL 及 DML，现简单总结如下，有兴趣的同学可以试试看。</p>\n<ul>\n<li>目标端建表结构可以与源端不一样 推荐与源端结构一致</li>\n<li>源端 DDL (CREATE、ALTER、DROP 等语句) 语句更改表结构 目标端不会变化</li>\n<li>源端 DML（SELECT、UPDATE、INSERT、DELETEt 等语句）语句目标端查询会同步</li>\n<li>源端 drop 表 目标端结构还在但无法查询</li>\n<li>目标端不能执行 DDL 语句</li>\n<li>目标端执行 DML 语句 源端数据也会变化</li>\n<li>目标端 truncate 表 源端表数据也会被清空</li>\n<li>目标端 drop 表对源端无影响</li>\n</ul>\n<h3 id=\"最佳实践\"><a href=\"#最佳实践\" class=\"headerlink\" title=\"最佳实践\"></a>最佳实践</h3><p>目前 FEDERATED 引擎使用范围还不多，若确实有跨实例访问的需求，建议做好规范，个人总结最佳实践如下：</p>\n<ol>\n<li>源端专门创建只读权限的用户来供目标端使用。</li>\n<li>目标端建议用 CREATE SERVER 方式创建 FEDERATED 表。</li>\n<li>FEDERATED 表不宜太多，迁移时要特别注意。</li>\n<li>目标端应该只做查询使用，禁止在目标端更改 FEDERATED 表。</li>\n<li>建议目标端表名及结构和源端保持一致。</li>\n<li>源端表结构变更后 目标端要及时删除重建。</li>\n</ol>\n","categories":["MySQL"],"tags":["MySQL"]},{"title":"浏览器提速软件 SpeedyFox","url":"/2020/08/2020-08-12-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%90%E9%80%9F%E8%BD%AF%E4%BB%B6SpeedyFox/","content":"<h3 id=\"软件介绍\"><a href=\"#软件介绍\" class=\"headerlink\" title=\"软件介绍\"></a>软件介绍</h3><p>SpeedyFox 是一个超级简单的工具，一个单窗口，没有选项的工具来优化浏览器的性能。</p>\n<p>SpeedyFox 声称通过对 SQLITE 数据库进行碎片整理来加速浏览器。它说，这些数据库随着时间的推移而变得变形，减慢了启动速度，并推迟了使用 Cookie 和历史记录的操作。</p>\n<h3 id=\"下载网址\"><a href=\"#下载网址\" class=\"headerlink\" title=\"下载网址\"></a>下载网址</h3><blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jcnlzdGFsaWRlYS5jb20vc3BlZWR5Zm94\">https://crystalidea.com/speedyfox<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<h3 id=\"使用软件\"><a href=\"#使用软件\" class=\"headerlink\" title=\"使用软件\"></a>使用软件</h3><p>Edge 浏览器，Chrome、Firefox 等浏览器，以及大部分国产浏览器，都可以使用。SpeedyFox 能自动识别，浏览器的配置文件路径。</p>\n<p>所以，打开软件，只要直接点击 Optimize 按钮就行了，不需要复杂的配置。</p>\n<p>优化过程可能需要 5 秒钟到一分钟，具体取决于数据库的大小。整个优化过程很安全，因为它不会影响您的历史记录，书签，密码等。</p>\n<p>根据您的浏览活动，建议每 1-2 周对您的个人资料进行一次优化。</p>\n<p>如下图所示：</p>\n<p><img src=\"/images/2020/08/1597286104064.png\" alt=\"1597286104064\" loading=\"lazy\"></p>\n","categories":["Windows","软件"],"tags":["Windows","软件"]},{"title":"Arthas 之通过 thread 命令定位线程问题","url":"/2020/08/2020-08-13-Arthas%E4%B9%8B%E9%80%9A%E8%BF%87thread%E5%91%BD%E4%BB%A4%E5%AE%9A%E4%BD%8D%E7%BA%BF%E7%A8%8B%E9%97%AE%E9%A2%98/","content":"<p>通过 Arthas 中的 thread 命令，可以查看当前线程信息及线程的堆栈。从而可以定位线程问题。</p>\n<h3 id=\"thread-命令介绍\"><a href=\"#thread-命令介绍\" class=\"headerlink\" title=\"thread 命令介绍\"></a>thread 命令介绍</h3><p>官方文档：</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbGliYWJhLmdpdGh1Yi5pby9hcnRoYXMvdGhyZWFkLmh0bWw=\">https://alibaba.github.io/arthas/thread.html<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<h4 id=\"参数说明\"><a href=\"#参数说明\" class=\"headerlink\" title=\"参数说明\"></a>参数说明</h4><p>使用 <code>thread --help</code> 获取 thread 命令的帮助信息：</p>\n<p><img src=\"/images/2020/08/1597314852787.png\" alt=\"1597314852787\" loading=\"lazy\"></p>\n<p>主要参数说明如下：</p>\n<table>\n<thead>\n<tr>\n<th>参数名称</th>\n<th>参数说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><em> id</em></td>\n<td> 线程 id</td>\n</tr>\n<tr>\n<td>[n:]</td>\n<td> 指定最忙的前 N 个线程并打印堆栈</td>\n</tr>\n<tr>\n<td> [b]</td>\n<td> 找出当前阻塞其他线程的线程</td>\n</tr>\n<tr>\n<td> [i <code>&lt;value&gt;</code>]</td>\n<td> 指定 cpu 占比统计的采样间隔，单位为毫秒</td>\n</tr>\n</tbody></table>\n<h4 id=\"线程常见状态\"><a href=\"#线程常见状态\" class=\"headerlink\" title=\"线程常见状态\"></a>线程常见状态</h4><p>定位线程问题之前，先回顾一下线程的几种常见状态：</p>\n<ul>\n<li><p><strong>RUNNABLE</strong> 运行中</p>\n</li>\n<li><p><strong>TIMED_WAITIN</strong> 调用了以下方法的线程会进入 <strong>TIMED_WAITING</strong>：</p>\n<ol>\n<li>Thread#sleep()</li>\n<li>Object#wait () 并加了超时参数</li>\n<li> Thread#join () 并加了超时参数</li>\n<li> LockSupport#parkNanos()</li>\n<li>LockSupport#parkUntil()</li>\n</ol>\n</li>\n<li><p><strong>WAITING</strong> 当线程调用以下方法时会进入 WAITING 状态：</p>\n<ol>\n<li>Object#wait () 而且不加超时参数</li>\n<li> Thread#join () 而且不加超时参数</li>\n<li> LockSupport#park()</li>\n</ol>\n</li>\n<li><p><strong>BLOCKED</strong> 阻塞，等待锁</p>\n</li>\n</ul>\n<h4 id=\"cpu占比的统计\"><a href=\"#cpu占比的统计\" class=\"headerlink\" title=\"cpu占比的统计\"></a>cpu 占比的统计</h4><blockquote>\n<p>这里的 cpu 统计的是，一段采样间隔内，当前 JVM 里各个线程所占用的 cpu 时间占总 cpu 时间的百分比。</p>\n<p>其计算方法为： 首先进行一次采样，获得所有线程的 cpu 的使用时间 (调用的是 <code>java.lang.management.ThreadMXBean#getThreadCpuTime</code> 这个接口)，然后睡眠一段时间，默认 100ms，可以通过 <code>-i</code> 参数指定，然后再采样一次，最后得出这段时间内各个线程消耗的 cpu 时间情况，最后算出百分比。</p>\n</blockquote>\n<blockquote>\n<p>注意： 这个统计也会产生一定的开销（JDK 这个接口本身开销比较大），因此会看到 as 的线程占用一定的百分比，为了降低统计自身的开销带来的影响，可以把采样间隔拉长一些，比如 5000 毫秒。</p>\n</blockquote>\n<blockquote>\n<p>如果想看从 Java 进程启动开始到现在的 cpu 占比情况：可以使用<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL29sZHJhdGxlZS91c2VmdWwtc2NyaXB0cy9ibG9iL21hc3Rlci9kb2NzL2phdmEubWQjLXNob3ctYnVzeS1qYXZhLXRocmVhZHM=\"> show-busy-java-threads<i class=\"fa fa-external-link-alt\"></i></span>这个脚本</p>\n</blockquote>\n<h3 id=\"示例代码\"><a href=\"#示例代码\" class=\"headerlink\" title=\"示例代码\"></a>示例代码</h3><p>首先编写一个有各种情况的测试类运行起来，再使用 <strong>Arthas</strong> 进行问题定位：</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ThreadDemo</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">HashSet</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> hashSet <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashSet</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">ExecutorService</span> executorService <span class=\"token operator\">=</span> <span class=\"token class-name\">Executors</span><span class=\"token punctuation\">.</span><span class=\"token function\">newFixedThreadPool</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token function\">addHashSetThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 不断的向 hashSet 集合增加数据</span>\n\n        <span class=\"token function\">cpuHigh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 模拟 CPU 过高</span>\n        <span class=\"token function\">cpuNormal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 模拟线程阻塞</span>\n\n        <span class=\"token function\">deadThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 模拟线程死锁</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * 极度消耗CPU的线程\n     */</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">cpuHigh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Thread</span> thread <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-&gt;</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cpu start 100\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// 添加到线程</span>\n        executorService<span class=\"token punctuation\">.</span><span class=\"token function\">submit</span><span class=\"token punctuation\">(</span>thread<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * 普通消耗CPU的线程\n     */</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">cpuNormal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-&gt;</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cpu start\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * 模拟线程阻塞,向已经满了的线程池提交线程\n     */</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Thread</span> thread <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-&gt;</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"thread start\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// 添加到线程</span>\n        executorService<span class=\"token punctuation\">.</span><span class=\"token function\">submit</span><span class=\"token punctuation\">(</span>thread<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * 死锁\n     */</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">deadThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">/** 创建资源 */</span>\n        <span class=\"token class-name\">Object</span> resourceA <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Object</span> resourceB <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// 创建线程</span>\n        <span class=\"token class-name\">Thread</span> threadA <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-&gt;</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">synchronized</span> <span class=\"token punctuation\">(</span>resourceA<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" get ResourceA\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"waiting get resourceB\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">synchronized</span> <span class=\"token punctuation\">(</span>resourceB<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" get resourceB\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">Thread</span> threadB <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-&gt;</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">synchronized</span> <span class=\"token punctuation\">(</span>resourceB<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" get ResourceB\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"waiting get resourceA\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">synchronized</span> <span class=\"token punctuation\">(</span>resourceA<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" get resourceA\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        threadA<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        threadB<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * 不断的向 hashSet 集合添加数据\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addHashSetThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 初始化常量</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-&gt;</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                    hashSet<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"count\"</span> <span class=\"token operator\">+</span> count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">10000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    count<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\n<h3 id=\"定位-CPU-使用较高的线程\"><a href=\"#定位-CPU-使用较高的线程\" class=\"headerlink\" title=\"定位 CPU 使用较高的线程\"></a>定位 CPU 使用较高的线程</h3><p>上面的代码例子有一个 <code>CPU</code> 空转的死循环，非常的消耗 <code>CPU性能</code>，那么怎么找出来呢？</p>\n<p>使用 <strong>thread</strong> 查看<strong>所有</strong>线程信息，同时会列出每个线程的 <code>CPU</code> 使用率，可以看到图里 ID 为 12 的线程 CPU 使用 100%。</p>\n<p><img src=\"/images/2020/08/1597314558126.png\" alt=\"1597314558126\" loading=\"lazy\"></p>\n<p>使用命令 <strong>thread 12</strong> 查看 CPU 消耗较高的 12 号线程信息，可以看到 CPU 使用较高的方法和行数。</p>\n<p><img src=\"/images/2020/08/1597314597613.png\" alt=\"1597314597613\" loading=\"lazy\"></p>\n<p>如果只是为了寻找 CPU 使用较高的线程，可以直接使用命令 <strong>thread -n [显示的线程个数]</strong> ，就可以排列出 CPU 使用率 <strong>Top N</strong> 的线程。</p>\n<p><img src=\"/images/2020/08/1597314636547.png\" alt=\"1597314636547\" loading=\"lazy\"></p>\n<p>定位到的 CPU 使用最高的方法：</p>\n<p><img src=\"/images/2020/08/1597314662083.png\" alt=\"1597314662083\" loading=\"lazy\"></p>\n<h3 id=\"定位线程阻塞\"><a href=\"#定位线程阻塞\" class=\"headerlink\" title=\"定位线程阻塞\"></a>定位线程阻塞</h3><p>上面的模拟代码里，定义了线程池大小为 1 的线程池，然后在 <code>cpuHigh</code> 方法里提交了一个线程，在 <code>thread</code> 方法再次提交了一个线程，后面的这个线程因为线程池已满，会阻塞下来。</p>\n<p>使用 <strong>thread | grep pool</strong> 命令查看线程池里线程信息。</p>\n<p><img src=\"/images/2020/08/1597314720720.png\" alt=\"1597314720720\" loading=\"lazy\"></p>\n<p>可以看到线程池有 <strong>WAITING</strong> 的线程：</p>\n<p><img src=\"/images/2020/08/1597314739701.png\" alt=\"1597314739701\" loading=\"lazy\"></p>\n<h3 id=\"定位线程死锁\"><a href=\"#定位线程死锁\" class=\"headerlink\" title=\"定位线程死锁\"></a>定位线程死锁</h3><p>上面的模拟代码里 <code>deadThread</code> 方法实现了一个死锁，使用 <strong>thread -b</strong> 命令查看直接定位到死锁信息。</p>\n<p><img src=\"/images/2020/08/1597314791433.png\" alt=\"1597314791433\" loading=\"lazy\"></p>\n","categories":["Java","Arthas"],"tags":["Java","Java诊断","Arthas"]},{"title":"Git 每次都需要输入用户名密码的问题解决","url":"/2020/08/2020-08-13-Git%E6%AF%8F%E6%AC%A1%E9%83%BD%E9%9C%80%E8%A6%81%E8%BE%93%E5%85%A5%E7%94%A8%E6%88%B7%E5%90%8D%E5%AF%86%E7%A0%81%E7%9A%84%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/","content":"<h3 id=\"提交GitHub\"><a href=\"#提交GitHub\" class=\"headerlink\" title=\"提交GitHub\"></a>提交 GitHub</h3><p>使用 git 提交文件到 github, 每次都要输入用户名和密码，操作起来很麻烦，以下方法可解决，记录以下。</p>\n<h4 id=\"问题原因\"><a href=\"#问题原因\" class=\"headerlink\" title=\"问题原因\"></a>问题原因</h4><p>在 clone 项目的时候，使用了 https 方式，而不是 ssh 方式。默认 clone 方式是：https。</p>\n<p><img src=\"/images/2020/08/1597317084639.png\" alt=\"1597317084639\" loading=\"lazy\"></p>\n<h4 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h4><ol>\n<li><p>查看 clone 地址：<code>git remote -v</code></p>\n<p><img src=\"/images/2020/08/1597317130019.png\" alt=\"1597317130019\" loading=\"lazy\"></p>\n<p>说明是 https 方式，现在换成 ssh 方式。</p>\n</li>\n<li><p>移除 https 的方式：<code>git remote rm origin</code></p>\n<p><img src=\"/images/2020/08/1597317256891.png\" alt=\"1597317256891\" loading=\"lazy\"></p>\n<p>再次查看 clone 地址：<code>git remote -v</code>，显示没有地址。</p>\n</li>\n<li><p>查看 ssh 方式地址，在 github 上，切换到 ssh 方式，然后复制地址。</p>\n<p><img src=\"/images/2020/08/1597317342069.png\" alt=\"1597317342069\" loading=\"lazy\"></p>\n</li>\n<li><p>添加新的 git 方式： <code>git remote add origin git 地址</code></p>\n<p><img src=\"/images/2020/08/1597317394906.png\" alt=\"1597317394906\" loading=\"lazy\"></p>\n</li>\n<li><p>重新 push：<code>git push origin master</code>。</p>\n</li>\n</ol>\n<h3 id=\"提交普通-Git\"><a href=\"#提交普通-Git\" class=\"headerlink\" title=\"提交普通 Git\"></a>提交普通 Git</h3><h4 id=\"解决办法1\"><a href=\"#解决办法1\" class=\"headerlink\" title=\"解决办法1\"></a>解决办法 1</h4><p>在 <code>C:\\Users\\Administrator</code> 中的<code>.gitconfig</code> 文件，文本编辑器打开，记事本就可以，添加一行</p>\n<pre class=\"language-none\"><code class=\"language-none\">[credential]\n    helper = store</code></pre>\n\n<h4 id=\"解决方法2\"><a href=\"#解决方法2\" class=\"headerlink\" title=\"解决方法2\"></a>解决方法 2</h4><p>git bash 进入你的项目目录，输入：</p>\n<pre class=\"language-none\"><code class=\"language-none\">git config --global credential.helper store</code></pre>\n\n<p>然后会修改 <code>C:\\Users\\Administrator</code> 中的<code>.gitconfig</code> 文件。</p>\n","categories":["Git"],"tags":["Git"]},{"title":"Arthas 之通过 trace 命令定位耗时问题","url":"/2020/08/2020-08-14-Arthas%E4%B9%8B%E9%80%9A%E8%BF%87trace%E5%91%BD%E4%BB%A4%E5%AE%9A%E4%BD%8D%E8%80%97%E6%97%B6%E9%97%AE%E9%A2%98/","content":"<h3 id=\"trace（内部调用路径）\"><a href=\"#trace（内部调用路径）\" class=\"headerlink\" title=\"trace（内部调用路径）\"></a>trace（内部调用路径）</h3><h4 id=\"方法介绍\"><a href=\"#方法介绍\" class=\"headerlink\" title=\"方法介绍\"></a>方法介绍</h4><p>通过 Arthas 中的 trace 命令，可以查看方法内部调用路径，并输出方法路径上的每个节点上耗时。</p>\n<p>官方文档：</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbGliYWJhLmdpdGh1Yi5pby9hcnRoYXMvdHJhY2UuaHRtbA==\">https://alibaba.github.io/arthas/trace.html<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<h4 id=\"参数说明\"><a href=\"#参数说明\" class=\"headerlink\" title=\"参数说明\"></a>参数说明</h4><p>使用 <code>thread --help</code> 获取 thread 命令的帮助信息：</p>\n<p><img src=\"/images/2020/08/1597393992311.png\" alt=\"1597393992311\" loading=\"lazy\"></p>\n<p>主要参数说明如下：</p>\n<table>\n<thead>\n<tr>\n<th>参数名称</th>\n<th>参数说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><em> class-pattern</em></td>\n<td> 类名表达式匹配</td>\n</tr>\n<tr>\n<td><em> method-pattern</em></td>\n<td> 方法名表达式匹配</td>\n</tr>\n<tr>\n<td><em> condition-express</em></td>\n<td> 条件表达式</td>\n</tr>\n<tr>\n<td> [E]</td>\n<td> 开启正则表达式匹配，默认为通配符匹配</td>\n</tr>\n<tr>\n<td><code>[n:]</code></td>\n<td>命令执行次数</td>\n</tr>\n<tr>\n<td><code>#cost</code></td>\n<td>方法执行耗时</td>\n</tr>\n</tbody></table>\n<h4 id=\"定位耗时问题\"><a href=\"#定位耗时问题\" class=\"headerlink\" title=\"定位耗时问题\"></a>定位耗时问题</h4><p>使用 **trace ** 命令开始检测耗时情况。</p>\n<pre class=\"language-none\"><code class=\"language-none\">trace sample.demo.controller.UserController getUser</code></pre>\n\n<p>结果如下：</p>\n<p><img src=\"/images/2020/08/1597402146114.png\" alt=\"1597402146114\" loading=\"lazy\"></p>\n<p>继续跟踪耗时高的方法，然后再次访问。</p>\n<pre class=\"language-none\"><code class=\"language-none\">trace sample.demo.TraceService get</code></pre>\n\n<p>结果如下：</p>\n<p><img src=\"/images/2020/08/1597402247630.png\" alt=\"1597402247630\" loading=\"lazy\"></p>\n<p>很清楚的看到是 <code>TraceService</code> 的 <code>mysql</code> 方法耗时是最高的。</p>\n<h3 id=\"monitor（方法调用监控）\"><a href=\"#monitor（方法调用监控）\" class=\"headerlink\" title=\"monitor（方法调用监控）\"></a>monitor（方法调用监控）</h3><h4 id=\"方法介绍-1\"><a href=\"#方法介绍-1\" class=\"headerlink\" title=\"方法介绍\"></a>方法介绍</h4><p>monitor 命令可以对匹配 <code>class-pattern</code>／<code>method-pattern</code> 的类、方法的调用进行监控。</p>\n<p>官方文档：</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbGliYWJhLmdpdGh1Yi5pby9hcnRoYXMvbW9uaXRvci5odG1s\">https://alibaba.github.io/arthas/monitor.html<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<h4 id=\"参数说明-1\"><a href=\"#参数说明-1\" class=\"headerlink\" title=\"参数说明\"></a>参数说明</h4><p>使用 <code>monitor --help</code> 获取 monitor 命令的帮助信息：</p>\n<p><img src=\"/images/2020/08/1597402367532.png\" alt=\"1597402367532\" loading=\"lazy\"></p>\n<p>方法拥有一个命名参数 <code>[c:]</code>，意思是统计周期（cycle of output），拥有一个整型的参数值</p>\n<table>\n<thead>\n<tr>\n<th>参数名称</th>\n<th>参数说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><em> class-pattern</em></td>\n<td> 类名表达式匹配</td>\n</tr>\n<tr>\n<td><em> method-pattern</em></td>\n<td> 方法名表达式匹配</td>\n</tr>\n<tr>\n<td> [E]</td>\n<td> 开启正则表达式匹配，默认为通配符匹配</td>\n</tr>\n<tr>\n<td><code>[c:]</code></td>\n<td>统计周期，默认值为 120 秒</td>\n</tr>\n</tbody></table>\n<h4 id=\"监控的维度说明\"><a href=\"#监控的维度说明\" class=\"headerlink\" title=\"监控的维度说明\"></a>监控的维度说明</h4><table>\n<thead>\n<tr>\n<th>监控项</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td> timestamp</td>\n<td> 时间戳</td>\n</tr>\n<tr>\n<td> class</td>\n<td>Java 类</td>\n</tr>\n<tr>\n<td> method</td>\n<td> 方法（构造方法、普通方法）</td>\n</tr>\n<tr>\n<td>total</td>\n<td> 调用次数</td>\n</tr>\n<tr>\n<td> success</td>\n<td> 成功次数</td>\n</tr>\n<tr>\n<td> fail</td>\n<td> 失败次数</td>\n</tr>\n<tr>\n<td> rt</td>\n<td> 平均 RT</td>\n</tr>\n<tr>\n<td>fail-rate</td>\n<td> 失败率</td>\n</tr>\n</tbody></table>\n<h4 id=\"统计方法耗时\"><a href=\"#统计方法耗时\" class=\"headerlink\" title=\"统计方法耗时\"></a>统计方法耗时</h4><p>使用 <strong>monitor</strong> 命令监控统计方法的执行情况。</p>\n<p>每 10 秒统计一次 <code>com.UserServiceImpl</code> 类的 <code>get</code> 方法执行情况。</p>\n<pre class=\"language-none\"><code class=\"language-none\">monitor -c 10 sample.demo.controller.UserController getUser</code></pre>\n\n<p><img src=\"/images/2020/08/1597402331522.png\" alt=\"1597402331522\" loading=\"lazy\"></p>\n<h3 id=\"watch（观察方法信息）\"><a href=\"#watch（观察方法信息）\" class=\"headerlink\" title=\"watch（观察方法信息）\"></a>watch（观察方法信息）</h3><h4 id=\"方法介绍-2\"><a href=\"#方法介绍-2\" class=\"headerlink\" title=\"方法介绍\"></a>方法介绍</h4><p>watch 让你能方便的观察到指定方法的调用情况。能观察到的范围为：<code>返回值</code>、<code>抛出异常</code>、<code>入参</code>，通过编写 <code>OGNL</code> 表达式进行对应变量的查看。</p>\n<p>官方文档：</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbGliYWJhLmdpdGh1Yi5pby9hcnRoYXMvd2F0Y2guaHRtbA==\">https://alibaba.github.io/arthas/watch.html<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<h4 id=\"参数说明-2\"><a href=\"#参数说明-2\" class=\"headerlink\" title=\"参数说明\"></a>参数说明</h4><p>使用 <code>watch --help</code> 获取 watch 命令的帮助信息：</p>\n<p><img src=\"/images/2020/08/1597402622041.png\" alt=\"1597402622041\" loading=\"lazy\"></p>\n<p>watch 的参数比较多，主要是因为它能在 4 个不同的场景观察对象：</p>\n<table>\n<thead>\n<tr>\n<th>参数名称</th>\n<th>参数说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><em> class-pattern</em></td>\n<td> 类名表达式匹配</td>\n</tr>\n<tr>\n<td><em> method-pattern</em></td>\n<td> 方法名表达式匹配</td>\n</tr>\n<tr>\n<td><em> express</em></td>\n<td> 观察表达式</td>\n</tr>\n<tr>\n<td><em> condition-express</em></td>\n<td> 条件表达式</td>\n</tr>\n<tr>\n<td> [b]</td>\n<td> 在<strong>方法调用之前</strong>观察</td>\n</tr>\n<tr>\n<td> [e]</td>\n<td> 在<strong>方法异常之后</strong>观察</td>\n</tr>\n<tr>\n<td> [s]</td>\n<td> 在<strong>方法返回之后</strong>观察</td>\n</tr>\n<tr>\n<td> [f]</td>\n<td> 在<strong>方法结束之后</strong> (正常返回和异常返回) 观察【默认】</td>\n</tr>\n<tr>\n<td>[E]</td>\n<td> 开启正则表达式匹配，默认为通配符匹配</td>\n</tr>\n<tr>\n<td> [x:]</td>\n<td> 指定输出结果的属性遍历深度，默认为 1</td>\n</tr>\n</tbody></table>\n<h4 id=\"特别说明\"><a href=\"#特别说明\" class=\"headerlink\" title=\"特别说明\"></a><strong>特别说明</strong></h4><ul>\n<li>watch 命令定义了 4 个观察事件点，即 <code>-b</code> 方法调用前，<code>-e</code> 方法异常后，<code>-s</code> 方法返回后，<code>-f</code> 方法结束后</li>\n<li> 4 个观察事件点 <code>-b</code>、<code>-e</code>、<code>-s</code> 默认关闭，<code>-f</code> 默认打开，当指定观察点被打开后，在相应事件点会对观察表达式进行求值并输出</li>\n<li>这里要注意<code>方法入参</code>和<code>方法出参</code>的区别，有可能在中间被修改导致前后不一致，除了 <code>-b</code> 事件点 <code>params</code> 代表方法入参外，其余事件都代表方法出参</li>\n<li>当使用 <code>-b</code> 时，由于观察事件点是在方法调用前，此时返回值或异常均不存在</li>\n</ul>\n<h4 id=\"观察方法信息\"><a href=\"#观察方法信息\" class=\"headerlink\" title=\"观察方法信息\"></a>观察方法信息</h4><h5 id=\"查看入参和出参\"><a href=\"#查看入参和出参\" class=\"headerlink\" title=\"查看入参和出参\"></a>查看入参和出参</h5><pre class=\"language-none\"><code class=\"language-none\">$ watch sample.demo.controller.UserController getUser '{params[0],returnObj}'</code></pre>\n\n<p><img src=\"/images/2020/08/1597402871452.png\" alt=\"1597402871452\" loading=\"lazy\"></p>\n<h5 id=\"查看入参和出参大小\"><a href=\"#查看入参和出参大小\" class=\"headerlink\" title=\"查看入参和出参大小\"></a>查看入参和出参大小</h5><pre class=\"language-none\"><code class=\"language-none\">$ watch sample.demo.controller.UserController getUser '{params[0],returnObj.size}'</code></pre>\n\n<p><img src=\"/images/2020/08/1597402936287.png\" alt=\"1597402936287\" loading=\"lazy\"></p>\n<h5 id=\"查看入参和出参String\"><a href=\"#查看入参和出参String\" class=\"headerlink\" title=\"查看入参和出参String\"></a>查看入参和出参 String</h5><pre class=\"language-none\"><code class=\"language-none\">$ watch sample.demo.controller.UserController getUser '{params[0],returnObj.toString()}'</code></pre>\n\n<p><img src=\"/images/2020/08/1597402988837.png\" alt=\"1597402988837\" loading=\"lazy\"></p>\n<h5 id=\"查看方法异常之后\"><a href=\"#查看方法异常之后\" class=\"headerlink\" title=\"查看方法异常之后\"></a>查看方法异常之后</h5><pre class=\"language-none\"><code class=\"language-none\">$ watch sample.demo.controller.UserController getUser '{params[0],returnObj}' -e</code></pre>\n\n<p><img src=\"/images/2020/08/1597403442198.png\" alt=\"1597403442198\" loading=\"lazy\"></p>\n<h3 id=\"stack（方法调用路径）\"><a href=\"#stack（方法调用路径）\" class=\"headerlink\" title=\"stack（方法调用路径）\"></a>stack（方法调用路径）</h3><h4 id=\"方法介绍-3\"><a href=\"#方法介绍-3\" class=\"headerlink\" title=\"方法介绍\"></a>方法介绍</h4><p>stack 输出当前方法被调用的调用路径。</p>\n<p>官方文档：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbGliYWJhLmdpdGh1Yi5pby9hcnRoYXMvc3RhY2suaHRtbA==\">https://alibaba.github.io/arthas/stack.html<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h4 id=\"参数说明-3\"><a href=\"#参数说明-3\" class=\"headerlink\" title=\"参数说明\"></a>参数说明</h4><p>使用 <code>stack --help</code> 获取 stack 命令的帮助信息：</p>\n<p><img src=\"/images/2020/08/1597403694320.png\" alt=\"1597403694320\" loading=\"lazy\"></p>\n<p>主要参数如下：</p>\n<table>\n<thead>\n<tr>\n<th>参数名称</th>\n<th>参数说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><em> class-pattern</em></td>\n<td> 类名表达式匹配</td>\n</tr>\n<tr>\n<td><em> method-pattern</em></td>\n<td> 方法名表达式匹配</td>\n</tr>\n<tr>\n<td><em> condition-express</em></td>\n<td> 条件表达式</td>\n</tr>\n<tr>\n<td> [E]</td>\n<td> 开启正则表达式匹配，默认为通配符匹配</td>\n</tr>\n<tr>\n<td><code>[n:]</code></td>\n<td>执行次数限制</td>\n</tr>\n</tbody></table>\n<h4 id=\"方法调用路径\"><a href=\"#方法调用路径\" class=\"headerlink\" title=\"方法调用路径\"></a>方法调用路径</h4><pre class=\"language-none\"><code class=\"language-none\">$ stack sample.demo.controller.UserController getUser</code></pre>\n\n<p><img src=\"/images/2020/08/1597403757289.png\" alt=\"1597403757289\" loading=\"lazy\"></p>\n<h3 id=\"tt（方法调用时空隧道）\"><a href=\"#tt（方法调用时空隧道）\" class=\"headerlink\" title=\"tt（方法调用时空隧道）\"></a>tt（方法调用时空隧道）</h3><h4 id=\"方法介绍-4\"><a href=\"#方法介绍-4\" class=\"headerlink\" title=\"方法介绍\"></a>方法介绍</h4><p>tt 方法执行数据的时空隧道，记录下指定方法每次调用的入参和返回信息，并能对这些不同的时间下调用进行观测。</p>\n<p>官方文档：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbGliYWJhLmdpdGh1Yi5pby9hcnRoYXMvdHQuaHRtbA==\">https://alibaba.github.io/arthas/tt.html<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h4 id=\"参数说明-4\"><a href=\"#参数说明-4\" class=\"headerlink\" title=\"参数说明\"></a>参数说明</h4><ul>\n<li><p><code>-t</code></p>\n<p>tt 命令有很多个主参数，<code>-t</code> 就是其中之一。这个参数的表明希望记录下类 <code>*Test</code> 的 <code>print</code> 方法的每次执行情况。</p>\n</li>\n<li><p><code>-n 3</code></p>\n<p>当你执行一个调用量不高的方法时可能你还能有足够的时间用 <code>CTRL+C</code> 中断 tt 命令记录的过程，但如果遇到调用量非常大的方法，瞬间就能将你的 JVM 内存撑爆。</p>\n<p>此时你可以通过 <code>-n</code> 参数指定你需要记录的次数，当达到记录次数时 Arthas 会主动中断 tt 命令的记录过程，避免人工操作无法停止的情况。</p>\n</li>\n</ul>\n<h4 id=\"返回结果说明\"><a href=\"#返回结果说明\" class=\"headerlink\" title=\"返回结果说明\"></a>返回结果说明</h4><table>\n<thead>\n<tr>\n<th>表格字段</th>\n<th>字段解释</th>\n</tr>\n</thead>\n<tbody><tr>\n<td> INDEX</td>\n<td> 时间片段记录编号，每一个编号代表着一次调用，后续 tt 还有很多命令都是基于此编号指定记录操作，非常重要。</td>\n</tr>\n<tr>\n<td>TIMESTAMP</td>\n<td> 方法执行的本机时间，记录了这个时间片段所发生的本机时间</td>\n</tr>\n<tr>\n<td> COST(ms)</td>\n<td> 方法执行的耗时</td>\n</tr>\n<tr>\n<td> IS-RET</td>\n<td> 方法是否以正常返回的形式结束</td>\n</tr>\n<tr>\n<td> IS-EXP</td>\n<td> 方法是否以抛异常的形式结束</td>\n</tr>\n<tr>\n<td> OBJECT</td>\n<td> 执行对象的 <code>hashCode()</code>，注意，曾经有人误认为是对象在 JVM 中的内存地址，但很遗憾他不是。但他能帮助你简单的标记当前执行方法的类实体</td>\n</tr>\n<tr>\n<td> CLASS</td>\n<td> 执行的类名</td>\n</tr>\n<tr>\n<td> METHOD</td>\n<td> 执行的方法名</td>\n</tr>\n</tbody></table>\n<h4 id=\"方法调用时空隧道\"><a href=\"#方法调用时空隧道\" class=\"headerlink\" title=\"方法调用时空隧道\"></a>方法调用时空隧道</h4><h5 id=\"开始记录方法调用信息\"><a href=\"#开始记录方法调用信息\" class=\"headerlink\" title=\"开始记录方法调用信息\"></a>开始记录方法调用信息</h5><pre class=\"language-none\"><code class=\"language-none\">$ tt -t sample.demo.controller.UserController getUser</code></pre>\n\n<p><img src=\"/images/2020/08/1597403958714.png\" alt=\"1597403958714\" loading=\"lazy\"></p>\n<h5 id=\"查看记录的方法调用信息\"><a href=\"#查看记录的方法调用信息\" class=\"headerlink\" title=\"查看记录的方法调用信息\"></a>查看记录的方法调用信息</h5><pre class=\"language-none\"><code class=\"language-none\">tt -l</code></pre>\n\n<p><img src=\"/images/2020/08/1597404208135.png\" alt=\"1597404208135\" loading=\"lazy\"></p>\n<h5 id=\"查看调用记录的详细信息\"><a href=\"#查看调用记录的详细信息\" class=\"headerlink\" title=\"查看调用记录的详细信息\"></a>查看调用记录的详细信息</h5><pre class=\"language-none\"><code class=\"language-none\">tt -i 1001</code></pre>\n\n<p><img src=\"/images/2020/08/1597404218381.png\" alt=\"1597404218381\" loading=\"lazy\"></p>\n<h5 id=\"重新发起调用\"><a href=\"#重新发起调用\" class=\"headerlink\" title=\"重新发起调用\"></a>重新发起调用</h5><pre class=\"language-none\"><code class=\"language-none\">tt -i 1001 -p</code></pre>\n\n<p><img src=\"/images/2020/08/1597404320236.png\" alt=\"1597404320236\" loading=\"lazy\"></p>\n","categories":["Java","Arthas"],"tags":["Java","Java诊断","Arthas"]},{"title":"Arthas 之定位方法调用问题","url":"/2020/08/2020-08-14-Arthas%E4%B9%8B%E5%AE%9A%E4%BD%8D%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E9%97%AE%E9%A2%98/","content":"<p>通过 Arthas 中的 trace/monitor/watch/stack/tt 等命令，可以查看方法内部调用信息，从而定位定位方法调用问题。</p>\n<h3 id=\"示例代码\"><a href=\"#示例代码\" class=\"headerlink\" title=\"示例代码\"></a>示例代码</h3><p>Spring Boot 启动类 <code>sample.demo.ServerDemoApplication</code>：</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@SpringBootApplication</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ServerDemoApplication</span> <span class=\"token punctuation\">{</span>\n\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ServerDemoApplication</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre>\n\n<p>控制类 <code>sample.demo.controller.UserController</code>：</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserService</span> userService<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"/user\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> uid<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 模拟用户查询</span>\n        userService<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>uid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">&gt;</span></span> hashMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        hashMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"uid\"</span><span class=\"token punctuation\">,</span> uid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        hashMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"name\"</span> <span class=\"token operator\">+</span> uid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span>hashMap<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> hashMap<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\n<p>Service 类：<code>sample.demo.service.UserService</code>：</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> uid<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">check</span><span class=\"token punctuation\">(</span>uid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">service</span><span class=\"token punctuation\">(</span>uid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">redis</span><span class=\"token punctuation\">(</span>uid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">mysql</span><span class=\"token punctuation\">(</span>uid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">service</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> uid<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            count <span class=\"token operator\">+=</span> i<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"service  end {}\"</span><span class=\"token punctuation\">,</span> count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">redis</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> uid<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            count <span class=\"token operator\">+=</span> i<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"redis  end {}\"</span><span class=\"token punctuation\">,</span> count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">mysql</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> uid<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">long</span> count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">10000000</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            count <span class=\"token operator\">+=</span> i<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mysql end {}\"</span><span class=\"token punctuation\">,</span> count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">check</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> uid<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>uid <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> uid <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n             log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"uid不正确，uid:{}\"</span><span class=\"token punctuation\">,</span> uid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n             <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"uid不正确\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">}</span>\n         <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n     <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\n<h3 id=\"trace（内部调用路径）\"><a href=\"#trace（内部调用路径）\" class=\"headerlink\" title=\"trace（内部调用路径）\"></a>trace（内部调用路径）</h3><h4 id=\"方法介绍\"><a href=\"#方法介绍\" class=\"headerlink\" title=\"方法介绍\"></a>方法介绍</h4><p>通过 Arthas 中的 trace 命令，可以查看方法内部调用路径，并输出方法路径上的每个节点上耗时。</p>\n<p>官方文档：</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbGliYWJhLmdpdGh1Yi5pby9hcnRoYXMvdHJhY2UuaHRtbA==\">https://alibaba.github.io/arthas/trace.html<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<h4 id=\"参数说明\"><a href=\"#参数说明\" class=\"headerlink\" title=\"参数说明\"></a>参数说明</h4><p>使用 <code>thread --help</code> 获取 thread 命令的帮助信息：</p>\n<p><img src=\"/images/2020/08/1597393992311.png\" alt=\"1597393992311\" loading=\"lazy\"></p>\n<p>主要参数说明如下：</p>\n<table>\n<thead>\n<tr>\n<th>参数名称</th>\n<th>参数说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><em> class-pattern</em></td>\n<td> 类名表达式匹配</td>\n</tr>\n<tr>\n<td><em> method-pattern</em></td>\n<td> 方法名表达式匹配</td>\n</tr>\n<tr>\n<td><em> condition-express</em></td>\n<td> 条件表达式</td>\n</tr>\n<tr>\n<td> [E]</td>\n<td> 开启正则表达式匹配，默认为通配符匹配</td>\n</tr>\n<tr>\n<td><code>[n:]</code></td>\n<td>命令执行次数</td>\n</tr>\n<tr>\n<td><code>#cost</code></td>\n<td>方法执行耗时</td>\n</tr>\n</tbody></table>\n<h4 id=\"定位耗时问题\"><a href=\"#定位耗时问题\" class=\"headerlink\" title=\"定位耗时问题\"></a>定位耗时问题</h4><p>使用 **trace ** 命令开始检测耗时情况。</p>\n<pre class=\"language-none\"><code class=\"language-none\">trace sample.demo.controller.UserController getUser</code></pre>\n\n<p>结果如下：</p>\n<p><img src=\"/images/2020/08/1597402146114.png\" alt=\"1597402146114\" loading=\"lazy\"></p>\n<p>继续跟踪耗时高的方法，然后再次访问。</p>\n<pre class=\"language-none\"><code class=\"language-none\">trace sample.demo.TraceService get</code></pre>\n\n<p>结果如下：</p>\n<p><img src=\"/images/2020/08/1597402247630.png\" alt=\"1597402247630\" loading=\"lazy\"></p>\n<p>很清楚的看到是 <code>TraceService</code> 的 <code>mysql</code> 方法耗时是最高的。</p>\n<h3 id=\"monitor（方法调用监控）\"><a href=\"#monitor（方法调用监控）\" class=\"headerlink\" title=\"monitor（方法调用监控）\"></a>monitor（方法调用监控）</h3><h4 id=\"方法介绍-1\"><a href=\"#方法介绍-1\" class=\"headerlink\" title=\"方法介绍\"></a>方法介绍</h4><p>monitor 命令可以对匹配 <code>class-pattern</code>／<code>method-pattern</code> 的类、方法的调用进行监控。</p>\n<p>官方文档：</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbGliYWJhLmdpdGh1Yi5pby9hcnRoYXMvbW9uaXRvci5odG1s\">https://alibaba.github.io/arthas/monitor.html<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<h4 id=\"参数说明-1\"><a href=\"#参数说明-1\" class=\"headerlink\" title=\"参数说明\"></a>参数说明</h4><p>使用 <code>monitor --help</code> 获取 monitor 命令的帮助信息：</p>\n<p><img src=\"/images/2020/08/1597402367532.png\" alt=\"1597402367532\" loading=\"lazy\"></p>\n<p>方法拥有一个命名参数 <code>[c:]</code>，意思是统计周期（cycle of output），拥有一个整型的参数值</p>\n<table>\n<thead>\n<tr>\n<th>参数名称</th>\n<th>参数说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><em> class-pattern</em></td>\n<td> 类名表达式匹配</td>\n</tr>\n<tr>\n<td><em> method-pattern</em></td>\n<td> 方法名表达式匹配</td>\n</tr>\n<tr>\n<td> [E]</td>\n<td> 开启正则表达式匹配，默认为通配符匹配</td>\n</tr>\n<tr>\n<td><code>[c:]</code></td>\n<td>统计周期，默认值为 120 秒</td>\n</tr>\n</tbody></table>\n<h4 id=\"监控的维度说明\"><a href=\"#监控的维度说明\" class=\"headerlink\" title=\"监控的维度说明\"></a>监控的维度说明</h4><table>\n<thead>\n<tr>\n<th>监控项</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td> timestamp</td>\n<td> 时间戳</td>\n</tr>\n<tr>\n<td> class</td>\n<td>Java 类</td>\n</tr>\n<tr>\n<td> method</td>\n<td> 方法（构造方法、普通方法）</td>\n</tr>\n<tr>\n<td>total</td>\n<td> 调用次数</td>\n</tr>\n<tr>\n<td> success</td>\n<td> 成功次数</td>\n</tr>\n<tr>\n<td> fail</td>\n<td> 失败次数</td>\n</tr>\n<tr>\n<td> rt</td>\n<td> 平均 RT</td>\n</tr>\n<tr>\n<td>fail-rate</td>\n<td> 失败率</td>\n</tr>\n</tbody></table>\n<h4 id=\"统计方法耗时\"><a href=\"#统计方法耗时\" class=\"headerlink\" title=\"统计方法耗时\"></a>统计方法耗时</h4><p>使用 <strong>monitor</strong> 命令监控统计方法的执行情况。</p>\n<p>每 10 秒统计一次 <code>com.UserServiceImpl</code> 类的 <code>get</code> 方法执行情况。</p>\n<pre class=\"language-none\"><code class=\"language-none\">monitor -c 10 sample.demo.controller.UserController getUser</code></pre>\n\n<p><img src=\"/images/2020/08/1597402331522.png\" alt=\"1597402331522\" loading=\"lazy\"></p>\n<h3 id=\"watch（观察方法信息）\"><a href=\"#watch（观察方法信息）\" class=\"headerlink\" title=\"watch（观察方法信息）\"></a>watch（观察方法信息）</h3><h4 id=\"方法介绍-2\"><a href=\"#方法介绍-2\" class=\"headerlink\" title=\"方法介绍\"></a>方法介绍</h4><p>watch 让你能方便的观察到指定方法的调用情况。能观察到的范围为：<code>返回值</code>、<code>抛出异常</code>、<code>入参</code>，通过编写 <code>OGNL</code> 表达式进行对应变量的查看。</p>\n<p>官方文档：</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbGliYWJhLmdpdGh1Yi5pby9hcnRoYXMvd2F0Y2guaHRtbA==\">https://alibaba.github.io/arthas/watch.html<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<h4 id=\"参数说明-2\"><a href=\"#参数说明-2\" class=\"headerlink\" title=\"参数说明\"></a>参数说明</h4><p>使用 <code>watch --help</code> 获取 watch 命令的帮助信息：</p>\n<p><img src=\"/images/2020/08/1597402622041.png\" alt=\"1597402622041\" loading=\"lazy\"></p>\n<p>watch 的参数比较多，主要是因为它能在 4 个不同的场景观察对象：</p>\n<table>\n<thead>\n<tr>\n<th>参数名称</th>\n<th>参数说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><em> class-pattern</em></td>\n<td> 类名表达式匹配</td>\n</tr>\n<tr>\n<td><em> method-pattern</em></td>\n<td> 方法名表达式匹配</td>\n</tr>\n<tr>\n<td><em> express</em></td>\n<td> 观察表达式</td>\n</tr>\n<tr>\n<td><em> condition-express</em></td>\n<td> 条件表达式</td>\n</tr>\n<tr>\n<td> [b]</td>\n<td> 在<strong>方法调用之前</strong>观察</td>\n</tr>\n<tr>\n<td> [e]</td>\n<td> 在<strong>方法异常之后</strong>观察</td>\n</tr>\n<tr>\n<td> [s]</td>\n<td> 在<strong>方法返回之后</strong>观察</td>\n</tr>\n<tr>\n<td> [f]</td>\n<td> 在<strong>方法结束之后</strong> (正常返回和异常返回) 观察【默认】</td>\n</tr>\n<tr>\n<td>[E]</td>\n<td> 开启正则表达式匹配，默认为通配符匹配</td>\n</tr>\n<tr>\n<td> [x:]</td>\n<td> 指定输出结果的属性遍历深度，默认为 1</td>\n</tr>\n</tbody></table>\n<h4 id=\"观察表达式\"><a href=\"#观察表达式\" class=\"headerlink\" title=\"观察表达式\"></a>观察表达式</h4><p>观察表达式的构成主要由 ognl 表达式组成，所以你可以这样写 <code>\"{params,returnObj}\"</code>，只要是一个合法的 ognl 表达式，都能被正常支持。</p>\n<p>观察的维度也比较多，主要体现在参数 <code>advice</code> 的数据结构上。<code>Advice</code> 参数最主要是封装了通知节点的所有信息。请参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbGliYWJhLmdpdGh1Yi5pby9hcnRoYXMvYWR2aWNlLWNsYXNzLmh0bWw=\">表达式核心变量<i class=\"fa fa-external-link-alt\"></i></span>中关于该节点的描述。</p>\n<ul>\n<li>特殊用法请参考：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2lzc3Vlcy83MQ==\">https://github.com/alibaba/arthas/issues/71<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li>OGNL 表达式官网：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jb21tb25zLmFwYWNoZS5vcmcvcHJvcGVyL2NvbW1vbnMtb2dubC9sYW5ndWFnZS1ndWlkZS5odG1s\">https://commons.apache.org/proper/commons-ognl/language-guide.html<i class=\"fa fa-external-link-alt\"></i></span></li>\n</ul>\n<h4 id=\"特别说明\"><a href=\"#特别说明\" class=\"headerlink\" title=\"特别说明\"></a><strong>特别说明</strong></h4><ul>\n<li>watch 命令定义了 4 个观察事件点，即 <code>-b</code> 方法调用前，<code>-e</code> 方法异常后，<code>-s</code> 方法返回后，<code>-f</code> 方法结束后</li>\n<li> 4 个观察事件点 <code>-b</code>、<code>-e</code>、<code>-s</code> 默认关闭，<code>-f</code> 默认打开，当指定观察点被打开后，在相应事件点会对观察表达式进行求值并输出</li>\n<li>这里要注意<code>方法入参</code>和<code>方法出参</code>的区别，有可能在中间被修改导致前后不一致，除了 <code>-b</code> 事件点 <code>params</code> 代表方法入参外，其余事件都代表方法出参</li>\n<li>当使用 <code>-b</code> 时，由于观察事件点是在方法调用前，此时返回值或异常均不存在</li>\n</ul>\n<h4 id=\"观察方法信息\"><a href=\"#观察方法信息\" class=\"headerlink\" title=\"观察方法信息\"></a>观察方法信息</h4><p><strong>查看入参和出参</strong></p>\n<pre class=\"language-none\"><code class=\"language-none\">$ watch sample.demo.controller.UserController getUser '{params[0],returnObj}'</code></pre>\n\n<p><img src=\"/images/2020/08/1597402871452.png\" alt=\"1597402871452\" loading=\"lazy\"></p>\n<p><strong>查看入参和出参大小</strong></p>\n<pre class=\"language-none\"><code class=\"language-none\">$ watch sample.demo.controller.UserController getUser '{params[0],returnObj.size}'</code></pre>\n\n<p><img src=\"/images/2020/08/1597402936287.png\" alt=\"1597402936287\" loading=\"lazy\"></p>\n<p><strong>查看入参和出参 String</strong></p>\n<pre class=\"language-none\"><code class=\"language-none\">$ watch sample.demo.controller.UserController getUser '{params[0],returnObj.toString()}'</code></pre>\n\n<p><img src=\"/images/2020/08/1597402988837.png\" alt=\"1597402988837\" loading=\"lazy\"></p>\n<p><strong>查看方法异常之后</strong></p>\n<pre class=\"language-none\"><code class=\"language-none\">$ watch sample.demo.controller.UserController getUser '{params[0],returnObj}' -e</code></pre>\n\n<p><img src=\"/images/2020/08/1597403442198.png\" alt=\"1597403442198\" loading=\"lazy\"></p>\n<h3 id=\"stack（方法调用路径）\"><a href=\"#stack（方法调用路径）\" class=\"headerlink\" title=\"stack（方法调用路径）\"></a>stack（方法调用路径）</h3><h4 id=\"方法介绍-3\"><a href=\"#方法介绍-3\" class=\"headerlink\" title=\"方法介绍\"></a>方法介绍</h4><p>stack 输出当前方法被调用的调用路径。</p>\n<p>官方文档：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbGliYWJhLmdpdGh1Yi5pby9hcnRoYXMvc3RhY2suaHRtbA==\">https://alibaba.github.io/arthas/stack.html<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h4 id=\"参数说明-3\"><a href=\"#参数说明-3\" class=\"headerlink\" title=\"参数说明\"></a>参数说明</h4><p>使用 <code>stack --help</code> 获取 stack 命令的帮助信息：</p>\n<p><img src=\"/images/2020/08/1597403694320.png\" alt=\"1597403694320\" loading=\"lazy\"></p>\n<p>主要参数如下：</p>\n<table>\n<thead>\n<tr>\n<th>参数名称</th>\n<th>参数说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><em> class-pattern</em></td>\n<td> 类名表达式匹配</td>\n</tr>\n<tr>\n<td><em> method-pattern</em></td>\n<td> 方法名表达式匹配</td>\n</tr>\n<tr>\n<td><em> condition-express</em></td>\n<td> 条件表达式</td>\n</tr>\n<tr>\n<td> [E]</td>\n<td> 开启正则表达式匹配，默认为通配符匹配</td>\n</tr>\n<tr>\n<td><code>[n:]</code></td>\n<td>执行次数限制</td>\n</tr>\n</tbody></table>\n<h4 id=\"方法调用路径\"><a href=\"#方法调用路径\" class=\"headerlink\" title=\"方法调用路径\"></a>方法调用路径</h4><pre class=\"language-none\"><code class=\"language-none\">$ stack sample.demo.controller.UserController getUser</code></pre>\n\n<p><img src=\"/images/2020/08/1597403757289.png\" alt=\"1597403757289\" loading=\"lazy\"></p>\n<h3 id=\"tt（方法调用时空隧道）\"><a href=\"#tt（方法调用时空隧道）\" class=\"headerlink\" title=\"tt（方法调用时空隧道）\"></a>tt（方法调用时空隧道）</h3><h4 id=\"方法介绍-4\"><a href=\"#方法介绍-4\" class=\"headerlink\" title=\"方法介绍\"></a>方法介绍</h4><p>tt 方法执行数据的时空隧道，记录下指定方法每次调用的入参和返回信息，并能对这些不同的时间下调用进行观测。</p>\n<p>官方文档：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbGliYWJhLmdpdGh1Yi5pby9hcnRoYXMvdHQuaHRtbA==\">https://alibaba.github.io/arthas/tt.html<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h4 id=\"参数说明-4\"><a href=\"#参数说明-4\" class=\"headerlink\" title=\"参数说明\"></a>参数说明</h4><ul>\n<li><p><code>-t</code></p>\n<p>tt 命令有很多个主参数，<code>-t</code> 就是其中之一。这个参数的表明希望记录下类 <code>*Test</code> 的 <code>print</code> 方法的每次执行情况。</p>\n</li>\n<li><p><code>-n 3</code></p>\n<p>当你执行一个调用量不高的方法时可能你还能有足够的时间用 <code>CTRL+C</code> 中断 tt 命令记录的过程，但如果遇到调用量非常大的方法，瞬间就能将你的 JVM 内存撑爆。</p>\n<p>此时你可以通过 <code>-n</code> 参数指定你需要记录的次数，当达到记录次数时 Arthas 会主动中断 tt 命令的记录过程，避免人工操作无法停止的情况。</p>\n</li>\n</ul>\n<h4 id=\"返回结果说明\"><a href=\"#返回结果说明\" class=\"headerlink\" title=\"返回结果说明\"></a>返回结果说明</h4><table>\n<thead>\n<tr>\n<th>表格字段</th>\n<th>字段解释</th>\n</tr>\n</thead>\n<tbody><tr>\n<td> INDEX</td>\n<td> 时间片段记录编号，每一个编号代表着一次调用，后续 tt 还有很多命令都是基于此编号指定记录操作，非常重要。</td>\n</tr>\n<tr>\n<td>TIMESTAMP</td>\n<td> 方法执行的本机时间，记录了这个时间片段所发生的本机时间</td>\n</tr>\n<tr>\n<td> COST(ms)</td>\n<td> 方法执行的耗时</td>\n</tr>\n<tr>\n<td> IS-RET</td>\n<td> 方法是否以正常返回的形式结束</td>\n</tr>\n<tr>\n<td> IS-EXP</td>\n<td> 方法是否以抛异常的形式结束</td>\n</tr>\n<tr>\n<td> OBJECT</td>\n<td> 执行对象的 <code>hashCode()</code>，注意，曾经有人误认为是对象在 JVM 中的内存地址，但很遗憾他不是。但他能帮助你简单的标记当前执行方法的类实体</td>\n</tr>\n<tr>\n<td> CLASS</td>\n<td> 执行的类名</td>\n</tr>\n<tr>\n<td> METHOD</td>\n<td> 执行的方法名</td>\n</tr>\n</tbody></table>\n<h4 id=\"方法调用时空隧道\"><a href=\"#方法调用时空隧道\" class=\"headerlink\" title=\"方法调用时空隧道\"></a>方法调用时空隧道</h4><p><strong>记录方法调用信息</strong></p>\n<pre class=\"language-none\"><code class=\"language-none\">$ tt -t sample.demo.controller.UserController getUser</code></pre>\n\n<p><img src=\"/images/2020/08/1597403958714.png\" alt=\"1597403958714\" loading=\"lazy\"></p>\n<p><strong>查看记录的调用信息</strong></p>\n<pre class=\"language-none\"><code class=\"language-none\">tt -l</code></pre>\n\n<p><img src=\"/images/2020/08/1597404208135.png\" alt=\"1597404208135\" loading=\"lazy\"></p>\n<p><strong>查看记录的详细信息</strong></p>\n<pre class=\"language-none\"><code class=\"language-none\">tt -i 1001</code></pre>\n\n<p><img src=\"/images/2020/08/1597404218381.png\" alt=\"1597404218381\" loading=\"lazy\"></p>\n<p><strong>重新发起调用</strong></p>\n<pre class=\"language-none\"><code class=\"language-none\">tt -i 1001 -p</code></pre>\n\n<p><img src=\"/images/2020/08/1597404320236.png\" alt=\"1597404320236\" loading=\"lazy\"></p>\n","categories":["Java","Arthas"],"tags":["Java","Java诊断","Arthas"]},{"title":"使用 Jrebel，实现热部署","url":"/2020/08/2020-08-13-%E4%BD%BF%E7%94%A8Jrebel%EF%BC%8C%E5%AE%9E%E7%8E%B0%E7%83%AD%E9%83%A8%E7%BD%B2/","content":"<p>JRebel 是一套 JavaEE 开发工具。JRebel 允许开发团队在有限的时间内完成更多的任务修正更多的问题，发布更高质量的软件产品。 </p>\n<h3 id=\"什么是热部署？\"><a href=\"#什么是热部署？\" class=\"headerlink\" title=\"什么是热部署？\"></a>什么是热部署？</h3><p>所谓热部署，就是在应用正在运行的时候升级软件，却不需要重新启动应用。对于 Java 应用程序来说，热部署就是在运行时更新 Java 类文件。</p>\n<p>在基于 Java 的应用服务器实现热部署的过程中，类装入器扮演着重要的角色。大多数基于 Java 的应用服务器，包括 EJB 服务器和 Servlet 容器，都支持热部署。类装入器不能重新装入一个已经装入的类，但只要使用一个新的类装入器实例，就可以将类再次装入一个正在运行的应用程序。</p>\n<h3 id=\"Jrebel-介绍\"><a href=\"#Jrebel-介绍\" class=\"headerlink\" title=\"Jrebel 介绍\"></a>Jrebel 介绍</h3><p>官网：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYW51YWxzLmpyZWJlbC5jb20vanJlYmVsLw==\">https://manuals.jrebel.com/jrebel/<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p>JRebel 是一个 JVM Java 代理，它与应用程序服务器集成，从而使类可以使用现有的类加载器<strong>重新</strong>加载。只有更改的类会重新编译并立即重新加载到正在运行的应用程序中。</p>\n<h3 id=\"Jrebel-功能\"><a href=\"#Jrebel-功能\" class=\"headerlink\" title=\"Jrebel 功能\"></a>Jrebel 功能</h3><p>Jrebel 可以实现基于类、XML 文件的增删查改，也能够实现方法体的增删查改的热部署。</p>\n<p>JRebel 工作在与 HotSwap 不同的一个抽象层面上。鉴于 HotSwap 是工作在虚拟机层面上，且依赖于 JVM 的内部运作，JRebel 用到了 JVM 的两个显著的功能特征 —— 抽象的字节码和类加载器。类加载器允许 JRebel 辨别出类被加载的时刻，然后实时地翻译字节码，用以在虚拟机和可执行代码之间创建另一个抽象层。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">支持类别</th>\n<th align=\"left\"> Jrebel</th>\n<th align=\"left\">JVM Hot Swap</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"> 方法体内代码的修改</td>\n<td align=\"left\">支持</td>\n<td align=\"left\">支持</td>\n</tr>\n<tr>\n<td align=\"left\">方法参数、名称、返回值的变动</td>\n<td align=\"left\">支持</td>\n<td align=\"left\">不支持</td>\n</tr>\n<tr>\n<td align=\"left\">方法体注解的变动</td>\n<td align=\"left\">支持</td>\n<td align=\"left\">不支持</td>\n</tr>\n<tr>\n<td align=\"left\">新增、删除 N (N&gt;0) 个方法</td>\n<td align=\"left\">支持</td>\n<td align=\"left\">不支持</td>\n</tr>\n<tr>\n<td align=\"left\">类的增删查改，其他类对此新增类的引用</td>\n<td align=\"left\">支持</td>\n<td align=\"left\">不支持</td>\n</tr>\n<tr>\n<td align=\"left\">新增接口，以及它的实现类</td>\n<td align=\"left\">支持</td>\n<td align=\"left\">不支持</td>\n</tr>\n<tr>\n<td align=\"left\">改变静态字段值（仅 static）</td>\n<td align=\"left\">不支持</td>\n<td align=\"left\">不支持</td>\n</tr>\n<tr>\n<td align=\"left\">改变常量字段值（final static or final）</td>\n<td align=\"left\">支持</td>\n<td align=\"left\">不支持</td>\n</tr>\n<tr>\n<td align=\"left\">枚举类 / 值（增删查改），并对它调用</td>\n<td align=\"left\">支持</td>\n<td align=\"left\">不支持</td>\n</tr>\n</tbody></table>\n<h3 id=\"Jrebel-安装\"><a href=\"#Jrebel-安装\" class=\"headerlink\" title=\"Jrebel 安装\"></a>Jrebel 安装</h3><h4 id=\"安装-Jrebel\"><a href=\"#安装-Jrebel\" class=\"headerlink\" title=\"安装 Jrebel\"></a>安装 Jrebel</h4><p>参考：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYW51YWxzLmpyZWJlbC5jb20vanJlYmVsL2lkZS9pbmRleC5odG1s\">https://manuals.jrebel.com/jrebel/ide/index.html<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p><img src=\"/images/2020/08/1597297821144.png\" alt=\"1597297821144\" loading=\"lazy\"></p>\n<h4 id=\"破解Jrebel\"><a href=\"#破解Jrebel\" class=\"headerlink\" title=\"破解Jrebel\"></a>破解 Jrebel</h4><ol>\n<li>点击打开网站：<span class=\"exturl\" data-url=\"aHR0cDovL215bmlnaHQudG9wOjEwMDg2Lw==\">http://mynight.top:10086<i class=\"fa fa-external-link-alt\"></i></span>，复制第二行链接</li>\n<li><img src=\"/images/2020/08/1597297837282.png\" alt=\"1597297837282\" loading=\"lazy\"></li>\n<li><img src=\"/images/2020/08/1597297849629.png\" alt=\"1597297849629\" loading=\"lazy\"></li>\n<li><img src=\"/images/2020/08/1597297856954.png\" alt=\"1597297856954\" loading=\"lazy\"></li>\n<li><img src=\"/images/2020/08/1597297962755.png\" alt=\"1597297962755\" loading=\"lazy\"></li>\n<li>至此 Jrebel 全部破解完毕。</li>\n</ol>\n<h3 id=\"Jrebel-注意事项\"><a href=\"#Jrebel-注意事项\" class=\"headerlink\" title=\"Jrebel 注意事项\"></a>Jrebel 注意事项</h3><ol>\n<li><p>每次重新编译加载 classes 文件的时候，控制台 console 都会输出一段文字：</p>\n<p>（2018-03-30 10:49:53 JRebel: Reloading class “包名。类名.class”.）</p>\n<p>这段文字代表该类已经重加载完毕，请确保这段文字输出以后，再调试。</p>\n</li>\n<li><p>以 Spring boot，启动的项目需要注意：<br>执行重新编译（recompile）类的时候，需要注意 被编译类 的依赖顺序。</p>\n<p>例如：A 类实现了 B 接口（类 A 和接口 B 都被修改的前提下），那么需要先重新编译（recompile）B 接口<br>再重新编译（recompile）A 类。</p>\n<p>当然，如果只修改了类 A 的内容，接口 B 未做修改，则只需要重新编译（recompile）类 A</p>\n</li>\n</ol>\n","categories":["软件","IDE"],"tags":["软件","IDE"]},{"title":"kafka-manager 的安装和使用","url":"/2020/08/2020-08-14-kafka-manager%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/","content":"<h3 id=\"kafka-manager地址\"><a href=\"#kafka-manager地址\" class=\"headerlink\" title=\"kafka-manager地址\"></a>kafka-manager 地址</h3><p>GitHub 地址：</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3lhaG9vL0NNQUs=\">https://github.com/yahoo/CMAK<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<p>下载地址：</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3lhaG9vL0NNQUsvcmVsZWFzZXM=\">https://github.com/yahoo/CMAK/releases<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<h3 id=\"kafka-manager简介\"><a href=\"#kafka-manager简介\" class=\"headerlink\" title=\"kafka-manager简介\"></a>kafka-manager 简介</h3><p>kafka-manager 是目前最受欢迎的 kafka 集群管理工具，最早由雅虎开源，用户可以在 Web 界面执行一些简单的集群管理操作。具体支持以下内容：</p>\n<ul>\n<li>管理多个集群</li>\n<li>轻松检查群集状态（主题，消费者，偏移，代理，副本分发，分区分发）</li>\n<li>运行首选副本选举</li>\n<li>使用选项生成分区分配以选择要使用的代理</li>\n<li>运行分区重新分配（基于生成的分配）</li>\n<li>使用可选主题配置创建主题（0.8.1.1 具有与 0.8.2 + 不同的配置）</li>\n<li>删除主题（仅支持 0.8.2 + 并记住在代理配置中设置 delete.topic.enable = true）</li>\n<li>主题列表现在指示标记为删除的主题（仅支持 0.8.2+）</li>\n<li>批量生成多个主题的分区分配，并可选择要使用的代理</li>\n<li>批量运行重新分配多个主题的分区</li>\n<li>将分区添加到现有主题</li>\n<li>更新现有主题的配置</li>\n</ul>\n<h3 id=\"安装kafka-manager\"><a href=\"#安装kafka-manager\" class=\"headerlink\" title=\"安装kafka-manager\"></a>安装 kafka-manager</h3><h4 id=\"普通安装\"><a href=\"#普通安装\" class=\"headerlink\" title=\"普通安装\"></a>普通安装</h4><h5 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h5><pre class=\"language-none\"><code class=\"language-none\">wget 'https://github.com/yahoo/CMAK/releases/download/3.0.0.5/cmak-3.0.0.5.zip'\nunzip cmak-3.0.0.5.zip\ncd cmak-3.0.0.5</code></pre>\n\n<h5 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h5><p>修改  <code>conf/application.conf</code> 文件：</p>\n<pre class=\"language-conf\" data-language=\"conf\"><code class=\"language-conf\">kafka-manager.zkhosts=\"127.0.0.1:2181\"\nkafka-manager.zkhosts=${?ZK_HOSTS}\ncmak.zkhosts=\"127.0.0.1:2181\"\ncmak.zkhosts=${?ZK_HOSTS}</code></pre>\n\n<h5 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h5><pre class=\"language-none\"><code class=\"language-none\">$ bin/cmak &amp;</code></pre>\n\n<h4 id=\"docker-安装\"><a href=\"#docker-安装\" class=\"headerlink\" title=\"docker 安装\"></a>docker 安装</h4><p>DockerHub：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS9yL3NoZWVwa2lsbGVyL2thZmthLW1hbmFnZXI=\">https://hub.docker.com/r/sheepkiller/kafka-manager<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p>安装命令：</p>\n<pre class=\"language-shell\" data-language=\"shell\"><code class=\"language-shell\">docker run -it <span class=\"token punctuation\">\\</span>\n    --name kafka-manager <span class=\"token punctuation\">\\</span>\n    -p <span class=\"token number\">9000</span>:9000 <span class=\"token punctuation\">\\</span>\n    -e <span class=\"token assign-left variable\">ZK_HOSTS</span><span class=\"token operator\">=</span><span class=\"token number\">127.0</span>.0.1:2181 <span class=\"token punctuation\">\\</span>\n    -e <span class=\"token assign-left variable\">KAFKA_MANAGER_AUTH_ENABLED</span><span class=\"token operator\">=</span>true <span class=\"token punctuation\">\\</span>\n    -e <span class=\"token assign-left variable\">KAFKA_MANAGER_USERNAME</span><span class=\"token operator\">=</span>admin <span class=\"token punctuation\">\\</span>\n    -e <span class=\"token assign-left variable\">KAFKA_MANAGER_PASSWORD</span><span class=\"token operator\">=</span>admin <span class=\"token punctuation\">\\</span>\n    -d sheepkiller/kafka-manager:latest</code></pre>\n\n<h3 id=\"配置-kafka-manager\"><a href=\"#配置-kafka-manager\" class=\"headerlink\" title=\"配置 kafka-manager\"></a>配置 kafka-manager</h3><p>kafka-manager 默认的端口是 9000。</p>\n<ol>\n<li><p>添加集群</p>\n<p><img src=\"/images/2020/08/1597386588682.png\" alt=\"1597386588682\" loading=\"lazy\"></p>\n</li>\n<li><p>配置集群</p>\n<p><img src=\"/images/2020/08/1597386711921.png\" alt=\"1597386711921\" loading=\"lazy\"></p>\n</li>\n</ol>\n<h3 id=\"问题解决\"><a href=\"#问题解决\" class=\"headerlink\" title=\"问题解决\"></a>问题解决</h3><p>如果使用 kafka-manager 监控，需要开启 JMX，则需要勾选：</p>\n<p><img src=\"/images/2020/08/1597405340838.png\" alt=\"1597405340838\" loading=\"lazy\"></p>\n<p>否则会有以下报错：</p>\n<pre class=\"language-none\"><code class=\"language-none\">2020-08-14 17:30:58,236 - [ERROR] k.m.j.KafkaJMX$ - Failed to connect to service:jmx:rmi:///jndi/rmi://dm161.bjth.163.org:-1/jmxrmi\njava.lang.IllegalArgumentException: requirement failed: No jmx port but jmx polling enabled!</code></pre>\n\n<p>启动 kafka 服务时指定 <code>JMX_PORT</code> 值:</p>\n<pre class=\"language-none\"><code class=\"language-none\">JMX_PORT=9999 nohup bin/kafka-server-start.sh config/server.properties &amp;</code></pre>\n\n","categories":["Linux","软件"],"tags":["Linux","软件","Kafka"]},{"title":"Ognl 表达式的基本使用方法","url":"/2020/08/2020-08-15-Ognl%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/","content":"<p>OGNL 是 <code>Object-Graph Navigation Language</code>（<strong>对象导航图语言</strong>）的缩写，它是一种功能强大的表达式语言，通过它简单一致的表达式语法，可以存取对象的任意属性，调用对象的方法，遍历整个对象的结构图，实现字段类型转化等功能。它使用相同的表达式去存取对象的属性。这样可以更好的取得数据。</p>\n<h3 id=\"Ognl-语言介绍\"><a href=\"#Ognl-语言介绍\" class=\"headerlink\" title=\"Ognl 语言介绍\"></a>Ognl 语言介绍</h3><p>OGNL 表达式官方指南：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jb21tb25zLmFwYWNoZS5vcmcvcHJvcGVyL2NvbW1vbnMtb2dubC9sYW5ndWFnZS1ndWlkZS5odG1s\">https://commons.apache.org/proper/commons-ognl/language-guide.html<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h4 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h4><p>Ognl 是一个功能强大的表达式语言，用来获取和设置 java 对象的属性 ，它旨在提供一个更高抽象度语法来对 java 对象图进行导航。</p>\n<p>另外，java 中很多可以做的事情，也可以使用 OGNL 来完成，例如：列表映射和选择。</p>\n<p>对于开发者来说，使用 OGNL，可以用简洁的语法来完成对 java 对象的导航。通常来说：通过一个 “路径” 来完成对象信息的导航，这个 “路径” 可以是到 java bean 的某个属性，或者集合中的某个索引的对象，等等，而不是直接使用 get 或者 set 方法来完成。</p>\n<h4 id=\"三要素\"><a href=\"#三要素\" class=\"headerlink\" title=\"三要素\"></a>三要素</h4><p><strong>首先来介绍下 OGNL 的三要素：</strong></p>\n<ul>\n<li><p><strong>表达式（Expression）</strong>：</p>\n<p>表达式是整个 OGNL 的核心内容，所有的 OGNL 操作都是针对表达式解析后进行的。通过表达式来告诉 OGNL 操作到底要干些什么。因此，表达式其实是一个带有语法含义的字符串，整个字符串将规定操作的类型和内容。OGNL 表达式支持大量的表达式，如 “链式访问对象”、表达式计算、甚至还支持 Lambda 表达式。</p>\n</li>\n<li><p><strong>Root 对象</strong>：</p>\n<p>OGNL 的 Root 对象可以理解为 OGNL 的操作对象。当我们指定了一个表达式的时候，我们需要指定这个表达式针对的是哪个具体的对象。而这个具体的对象就是 Root 对象，这就意味着，如果有一个 OGNL 表达式，那么我们需要针对 Root 对象来进行 OGNL 表达式的计算并且返回结果。</p>\n</li>\n<li><p><strong>上下文环境</strong>：</p>\n<p>有个 Root 对象和表达式，我们就可以使用 OGNL 进行简单的操作了，如对 Root 对象的赋值与取值操作。但是，实际上在 OGNL 的内部，所有的操作都会在一个特定的数据环境中运行。这个数据环境就是上下文环境（Context）。OGNL 的上下文环境是一个 Map 结构，称之为 OgnlContext。Root 对象也会被添加到上下文环境当中去。</p>\n<p>说白了上下文就是一个 MAP 结构，它实现了 java.utils.Map 的接口。</p>\n</li>\n</ul>\n<h3 id=\"使用-Ognl\"><a href=\"#使用-Ognl\" class=\"headerlink\" title=\"使用 Ognl\"></a>使用 Ognl</h3><p>引入 Maven：</p>\n<pre class=\"language-xml\" data-language=\"xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>ognl<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>ognl<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">&gt;</span></span>3.1.19<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">&gt;</span></span></code></pre>\n\n<p>示例代码：</p>\n<p>示例类：<code>sample.ognl.Address</code></p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Data</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Address</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> port<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> address<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> port<span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span> address<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> port<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>address <span class=\"token operator\">=</span> address<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\n<p>示例类 <code>sample.ognl.User</code>：</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Data</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Address</span> address<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age <span class=\"token operator\">=</span> age<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\n<h3 id=\"Ognl-的基本语法\"><a href=\"#Ognl-的基本语法\" class=\"headerlink\" title=\"Ognl 的基本语法\"></a>Ognl 的基本语法</h3><h4 id=\"对Root对象的访问\"><a href=\"#对Root对象的访问\" class=\"headerlink\" title=\"对Root对象的访问\"></a>对 Root 对象的访问</h4><p>OGNL 使用的是一种链式的风格进行对象的访问。</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">23</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Address</span> address <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"330108\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"杭州市滨江区\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nuser<span class=\"token punctuation\">.</span><span class=\"token function\">setAddress</span><span class=\"token punctuation\">(</span>address<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// test</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name.length\"</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 4</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"address\"</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// Address(port=330108, address=杭州市滨江区)</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"address.port\"</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 110003</span></code></pre>\n\n<h4 id=\"对上下文对象的访问\"><a href=\"#对上下文对象的访问\" class=\"headerlink\" title=\"对上下文对象的访问\"></a>对上下文对象的访问</h4><p>使用 OGNL 的时候如果不设置上下文对象，系统会自动创建一个上下文对象，如果传入的参数当中包含了上下文对象则会使用传入的上下文对象。</p>\n<p>** 当访问上下文环境当中的参数时候，需要在表达式前面加上 '#'**，表示了与访问 Root 对象的区别。</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">demo2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">OgnlException</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">23</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Address</span> address <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"330108\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"杭州市滨江区\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    user<span class=\"token punctuation\">.</span><span class=\"token function\">setAddress</span><span class=\"token punctuation\">(</span>address<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">&gt;</span></span> context <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    context<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"init\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    context<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#init\"</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// hello</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#user.name\"</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// test</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// test</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"this is demo2 method\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\n<h4 id=\"对静态变量的访问\"><a href=\"#对静态变量的访问\" class=\"headerlink\" title=\"对静态变量的访问\"></a>对静态变量的访问</h4><p>在 OGNL 表达式当中也可以访问静态变量或者调用静态方法，** 格式如 @[class]@[field/method ()]**。</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> ONE <span class=\"token operator\">=</span> <span class=\"token string\">\"one\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 对静态变量的访问（@[class]@[field/method()]）</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">demo3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">OgnlException</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Object</span> object1 <span class=\"token operator\">=</span> <span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@sample.ognl.OgnlDemo@ONE\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Object</span> object2 <span class=\"token operator\">=</span> <span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@sample.ognl.OgnlDemo@demo2()\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// hello、test、test</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>object1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// one    </span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>object2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// this is demo2 method</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\n<h4 id=\"方法的调用\"><a href=\"#方法的调用\" class=\"headerlink\" title=\"方法的调用\"></a>方法的调用</h4><p>如果需要调用 Root 对象或者上下文对象当中的方法也可以使用.+ 方法的方式来调用。甚至可以传入参数。</p>\n<p>赋值的时候可以选择上下文当中的元素进行给 Root 对象的 name 属性赋值。</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">&gt;</span></span> context <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rcx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getName()\"</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// null</span>\n<span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"setName(#name)\"</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getName()\"</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// rcx</span></code></pre>\n\n<h4 id=\"对数组和集合的访问\"><a href=\"#对数组和集合的访问\" class=\"headerlink\" title=\"对数组和集合的访问\"></a>对数组和集合的访问</h4><p>OGNL 支持对数组按照数组下标的顺序进行访问。此方式也适用于对集合的访问，对于 Map 支持使用键进行访问。</p>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">&gt;</span></span> context <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> strings  <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"aa\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"bb\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> list <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nlist<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"aa\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nlist<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bb\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> map <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"key1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"value1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"key2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"value2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"strings\"</span><span class=\"token punctuation\">,</span> strings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"map\"</span><span class=\"token punctuation\">,</span> map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#strings[0]\"</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// aa</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#list[0]\"</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// aa</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#list[0 + 1]\"</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// bb</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#map['key1']\"</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// value1</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#map['key' + '2']\"</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>     <span class=\"token comment\">// value2</span></code></pre>\n\n<p>从上面代码不仅看到了访问数组与集合的方式同时也可以看出来 OGNL 表达式当中支持操作符的简单运算。有如下所示：</p>\n<ul>\n<li>2 + 4 // 整数相加（同时也支持减法、乘法、除法、取余 [% /mod]、）</li>\n<li>\"hell\" + \"lo\" // 字符串相加</li>\n<li> i++ // 递增、递减</li>\n<li> i == j // 判断</li>\n<li> var in list // 是否在容器当中</li>\n</ul>\n<h4 id=\"投影与选择\"><a href=\"#投影与选择\" class=\"headerlink\" title=\"投影与选择\"></a>投影与选择</h4><p>OGNL 支持类似数据库当中的选择与投影功能。</p>\n<ul>\n<li><p><strong>投影</strong>：选出集合当中的相同属性组合成一个新的集合。语法为 collection.{XXX}，XXX 就是集合中每个元素的公共属性。</p>\n</li>\n<li><p><strong>选择</strong>：选择就是选择出集合当中符合条件的元素组合成新的集合。语法为 collection.{Y XXX}，其中 Y 是一个选择操作符，XXX 是选择用的逻辑表达式。</p>\n<p>选择操作符有 3 种：</p>\n<ul>\n<li>? ：选择满足条件的所有元素</li>\n<li> ^：选择满足条件的第一个元素</li>\n<li> $：选择满足条件的最后一个元素 </li>\n</ul>\n</li>\n</ul>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token class-name\">User</span> p1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name1\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">11</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">User</span> p2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name2\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">22</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">User</span> p3 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name3\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">33</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">User</span> p4 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name4\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">&gt;</span></span> context <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">&gt;</span></span> list <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nlist<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>p1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nlist<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>p2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nlist<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>p3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nlist<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>p4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#list.{age}\"</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    \n<span class=\"token comment\">// [11, 22, 33, 44]</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#list.{age + '-' + name}\"</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    \n<span class=\"token comment\">// [11-name1, 22-name2, 33-name3, 44-name4]</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#list.{? #this.age &gt; 22}\"</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    \n<span class=\"token comment\">// [User(name=name3, age=33, address=null), User(name=name4, age=44, address=null)]</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#list.{^ #this.age &gt; 22}\"</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    \n<span class=\"token comment\">// [User(name=name3, age=33, address=null)]</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#list.{$ #this.age &gt; 22}\"</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    \n<span class=\"token comment\">// [User(name=name4, age=44, address=null)]</span></code></pre>\n\n<h4 id=\"创建对象\"><a href=\"#创建对象\" class=\"headerlink\" title=\"创建对象\"></a>创建对象</h4><p>OGNL 支持直接使用表达式来创建对象。主要有三种情况：</p>\n<ul>\n<li>构造 List 对象：使用 {}, 中间使用 ',' 进行分割如 {\"aa\", \"bb\", \"cc\"}</li>\n<li> 构造 Map 对象：使用 #{}，中间使用 ', 进行分割键值对，键值对使用 ':' 区分，如 #{\"key1\" : \"value1\", \"key2\" : \"value2\"}</li>\n<li> 构造任意对象：直接使用已知的对象的构造方法进行构造。</li>\n</ul>\n<pre class=\"language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#{'key1':'value1'}\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// {key1=value1}</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{'key1','value1'}\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// [key1, value1]</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ognl</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"new sample.ognl.User()\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    \n<span class=\"token comment\">// User(name=null, age=0, address=null)</span></code></pre>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3>","categories":["Java"],"tags":["Java","Ognl"]},{"title":"Robots.txt 文件介绍及生成","url":"/2020/08/2020-08-18-Robots.txt%E6%96%87%E4%BB%B6%E4%BB%8B%E7%BB%8D%E5%8F%8A%E7%94%9F%E6%88%90/","content":"<p>Robots.txt 是存放在站点根目录下的一个纯文本文件。虽然它的设置很简单，但是作用却很强大。它可以指定搜索引擎蜘蛛只抓取指定的内容，或者是禁止搜索引擎蜘蛛抓取网站的部分或全部内容。</p>\n<h3 id=\"使用方法\"><a href=\"#使用方法\" class=\"headerlink\" title=\"使用方法\"></a>使用方法</h3><p>Robots.txt 文件应该放在网站根目录下，并且该文件是可以通过互联网进行访问的。</p>\n<p>例如：如果您的网站地址是 <code>http://www.yourdomain.com/</code>。那么，该文件必须能够通过 <code>http://www.yourdomain.com/robots.txt</code> 打开并看到里面的内容。</p>\n<p>例如：<a href=\"https://jueee.github.io/robots.txt\">https://jueee.github.io/robots.txt</a></p>\n<h3 id=\"格式\"><a href=\"#格式\" class=\"headerlink\" title=\"格式\"></a>格式</h3><h4 id=\"User-agent\"><a href=\"#User-agent\" class=\"headerlink\" title=\"User-agent\"></a>User-agent</h4><p>用于描述搜索引擎蜘蛛的名字，在 \"Robots.txt\" 文件中，如果有多条 User-agent 记录说明有多个搜索引擎蜘蛛会受到该协议的限制，对该文件来说，至少要有一条 User-agent 记录。</p>\n<p>如果该项的值设为 <code>*</code>，则该协议对任何搜索引擎蜘蛛均有效，在 \"Robots.txt\" 文件中，\"<code>User-agent:*</code>\" 这样的记录只能有一条。</p>\n<h4 id=\"Disallow\"><a href=\"#Disallow\" class=\"headerlink\" title=\"Disallow\"></a>Disallow</h4><p>用于描述不希望被访问到的一个 URL，这个 URL 可以是一条完整的路径，也可以是部分的，任何以 Disallow 开头的 URL 均不会被 Robot 访问到。</p>\n<p>举例：</p>\n<p>例一：\"Disallow:/help\" 是指 /help.html 和 /help/index.html 都不允许搜索引擎蜘蛛抓取。</p>\n<p>例二：\"Disallow:/help/\" 是指允许搜索引擎蜘蛛抓取 /help.html，而不能抓取 /help/index.html。</p>\n<p>例三：Disallow 记录为空说明该网站的所有页面都允许被搜索引擎抓取，在 \"/robots.txt\" 文件中，至少要有一条 Disallow 记录。如果 \"/robots.txt\" 是一个空文件，则对于所有的搜索引擎蜘蛛，该网站都是开放的可以被抓取的。</p>\n<h4 id=\"注释符\"><a href=\"#注释符\" class=\"headerlink\" title=\"注释符\"></a>注释符</h4><p><code>#</code> 是 Robots.txt 协议中的注释符。</p>\n<h3 id=\"综合例子\"><a href=\"#综合例子\" class=\"headerlink\" title=\"综合例子\"></a>综合例子</h3><p>例一：通过 \"/robots.txt\" 禁止所有搜索引擎蜘蛛抓取 \"/bin/cgi/\" 目录，以及 \"/tmp/\" 目录和 /foo.html 文件，设置方法如下：</p>\n<pre class=\"language-none\"><code class=\"language-none\">User-agent: *\nDisallow: /bin/cgi/\nDisallow: /tmp/\nDisallow: /foo.html</code></pre>\n\n<p>例二：通过 \"/robots.txt\" 只允许某个搜索引擎抓取，而禁止其他的搜索引擎抓取。如：只允许名为 \"slurp\" 的搜索引擎蜘蛛抓取，而拒绝其他的搜索引擎蜘蛛抓取 \"/cgi/\" 目录下的内容，设置方法如下：</p>\n<pre class=\"language-none\"><code class=\"language-none\">User-agent: *\nDisallow: /cgi/\nUser-agent: slurp\nDisallow:</code></pre>\n\n<p>例三：禁止任何搜索引擎抓取我的网站，设置方法如下：</p>\n<pre class=\"language-none\"><code class=\"language-none\">User-agent: *\nDisallow: /</code></pre>\n\n<p>例四：只禁止某个搜索引擎抓取我的网站如：只禁止名为 “slurp” 的搜索引擎蜘蛛抓取，设置方法如下：</p>\n<pre class=\"language-none\"><code class=\"language-none\">User-agent: slurp\nDisallow: /</code></pre>\n\n","categories":["Blog"],"tags":["Blog","SEO"]},{"title":"博客网站管理员工具","url":"/2020/08/2020-08-18-%E5%8D%9A%E5%AE%A2%E7%BD%91%E7%AB%99%E7%AE%A1%E7%90%86%E5%91%98%E5%B7%A5%E5%85%B7/","content":"<p>网站管理员工具需要对网站域名所有权进行验证，通常是通过上传指定文件、增加 META 或者修改网站 DNS 来验证管理员身份，通过验证后，网站管理员可以查询到自己网站的各类统计信息。</p>\n<a id=\"more\"></a>\n\n<h3 id=\"网站管理员工具\"><a href=\"#网站管理员工具\" class=\"headerlink\" title=\"网站管理员工具\"></a>网站管理员工具</h3><h4 id=\"Google网站管理员工具\"><a href=\"#Google网站管理员工具\" class=\"headerlink\" title=\"Google网站管理员工具\"></a>Google 网站管理员工具</h4><p>设置<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS93ZWJtYXN0ZXJzL3Rvb2xz\"> Google 网站站长工具<i class=\"fa fa-external-link-alt\"></i></span>的验证字符串 用于提交站点地图。</p>\n<p>登录到 Google 网站站长工具，然后转到验证方法并选择 <code>HTML Tag</code>，您将获得一些代码：</p>\n<pre class=\"language-none\"><code class=\"language-none\">&lt;meta name=\"google-site-verification\" content=\"XXXXXXXXXXXXXXXXXXXXXXX\"&gt;</code></pre>\n\n<p>复制 <code>XXXXXXXXXXXXXXXXXXXXXXX</code> 的价值 <code>content</code> 的关键。<br>编辑主题配置文件并添加或更改 <code>google_site_verification</code> 部分：</p>\n<pre class=\"language-yml\" data-language=\"yml\"><code class=\"language-yml\">google_site_verification: XXXXXXXXXXXXXXXXXXXXXXX</code></pre>\n\n<h4 id=\"Bing网站管理员工具\"><a href=\"#Bing网站管理员工具\" class=\"headerlink\" title=\"Bing网站管理员工具\"></a>Bing 网站管理员工具</h4><p>设置<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmluZy5jb20vd2VibWFzdGVyLw==\"> Bing 网站管理员工具<i class=\"fa fa-external-link-alt\"></i></span>的验证字符串 用于提交站点地图。</p>\n<p>登录到 Bing 网站管理员工具，然后转到验证方法并选择 <code>HTML Tag</code>，您将获得一些代码：</p>\n<pre class=\"language-none\"><code class=\"language-none\">&lt;meta name=\"msvalidate.01\" content=\"XXXXXXXXXXXXXXXXXXXXXXX\"&gt;</code></pre>\n\n<p>复制 <code>XXXXXXXXXXXXXXXXXXXXXXX</code> 的价值 <code>content</code> 的关键。<br>编辑主题配置文件并添加或更改 <code>bing_site_verification</code> 部分：</p>\n<pre class=\"language-yml\" data-language=\"yml\"><code class=\"language-yml\">bing_site_verification: XXXXXXXXXXXXXXXXXXXXXXX</code></pre>\n\n<h4 id=\"Yandex网站管理员工具\"><a href=\"#Yandex网站管理员工具\" class=\"headerlink\" title=\"Yandex网站管理员工具\"></a>Yandex 网站管理员工具</h4><p>设置<span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZWJtYXN0ZXIueWFuZGV4LnJ1Lw==\"> Yandex 网站管理员工具<i class=\"fa fa-external-link-alt\"></i></span>的验证字符串 用于提交站点地图。</p>\n<p>登录到 Yandex 网站管理员工具，然后转到验证方法并选择 <code>Meta Tag</code>，您将获得一些代码：</p>\n<pre class=\"language-none\"><code class=\"language-none\">&lt;meta name=\"yandex-verification\" content=\"XXXXXXXXXXXXXXXXXXXXXXX\"&gt;</code></pre>\n\n<p>复制 <code>XXXXXXXXXXXXXXXXXXXXXXX</code> 的价值 <code>content</code> 的关键。<br>编辑主题配置文件并添加或更改 <code>yandex_site_verification</code> 部分：</p>\n<pre class=\"language-yml\" data-language=\"yml\"><code class=\"language-yml\">yandex_site_verification: XXXXXXXXXXXXXXXXXXXXXXX</code></pre>\n\n<h4 id=\"百度网站管理员工具\"><a href=\"#百度网站管理员工具\" class=\"headerlink\" title=\"百度网站管理员工具\"></a>百度网站管理员工具</h4><p>设置<span class=\"exturl\" data-url=\"aHR0cHM6Ly96aXl1YW4uYmFpZHUuY29tL3NpdGUv\">百度网站管理员工具<i class=\"fa fa-external-link-alt\"></i></span>的验证字符串 用于提交站点地图。</p>\n<p>登录百度网站管理员工具，转到验证方法并选择 <code>HTML Tag</code>，您将获得一些代码：</p>\n<pre class=\"language-none\"><code class=\"language-none\">&lt;meta name=\"baidu-site-verification\" content=\"XXXXXXXXXXXXXXXXXXXXXXX\"&gt;</code></pre>\n\n<p>复制 <code>XXXXXXXXXXXXXXXXXXXXXXX</code> 的价值 <code>content</code> 的关键。<br>编辑主题配置文件并添加或更改 <code>baidu_site_verification</code> 部分：</p>\n<pre class=\"language-yml\" data-language=\"yml\"><code class=\"language-yml\">baidu_site_verification: XXXXXXXXXXXXXXXXXXXXXXX</code></pre>\n\n<p>NexT 还支持百度推送，以便博客将 URL 自动推送到百度，这对于 SEO 非常有用。您可以通过将值设置 <code>baidu_push</code> 为 <code>true</code>in 来启用它主题配置文件。</p>\n<pre class=\"language-yml\" data-language=\"yml\"><code class=\"language-yml\">baidu_push: true</code></pre>\n\n<h3 id=\"网站管理员工具优化\"><a href=\"#网站管理员工具优化\" class=\"headerlink\" title=\"网站管理员工具优化\"></a>网站管理员工具优化</h3><h4 id=\"多个-h1-标记\"><a href=\"#多个-h1-标记\" class=\"headerlink\" title=\"多个 h1 标记\"></a>多个 h1 标记</h4><p>通过 Bing 的 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmluZy5jb20vd2VibWFzdGVycy91cmxpbnNwZWN0aW9uP3NpdGVVcmw9aHR0cDovL2p1ZWVlLmdpdGh1Yi5pby8=\">URL 检查<i class=\"fa fa-external-link-alt\"></i></span>，可以发现” 多个 h1 标记 “ 的问题：</p>\n<p><img src=\"/images/2020/08/1597744034857.png\" alt=\"1597744034857\" loading=\"lazy\"></p>\n<p>发现是由于站点标题和博客标题都采用了 h1 标记导致的。</p>\n<p>H1 标签是用来修饰主标题的，如果用多个 H1 标签，就可能会让搜索引擎不知道你这个网站的主要标题内容是什么，然后就可能会淡化标题关键词的排名。</p>\n<p>需要修改 <code>node_modules\\hexo-theme-next\\layout\\_partials\\header\\brand.njk</code> 的 <code>site-title</code> 为 h2：</p>\n<p><img src=\"/images/2020/08/1597744215606.png\" alt=\"1597744215606\" loading=\"lazy\"></p>\n","categories":["Blog"],"tags":["Blog","SEO"]},{"title":"Arthas 之根据输入查找命令执行类","url":"/2020/08/2020-08-17-Arthas%E4%B9%8B%E6%A0%B9%E6%8D%AE%E8%BE%93%E5%85%A5%E6%9F%A5%E6%89%BE%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%B1%BB/","content":"<p>本文介绍 Arthas 命令路由的整个过程，包括如何注册命令、如何读取客户端的输入、如何根据输入找到对应的命令执行类。最后以一个基础命令 help 为例，简要介绍命令执行类是如何执行，如何接收参数，以及如何向客户端返回数据的。</p>\n<h3 id=\"在ShellServer中注册命令\"><a href=\"#在ShellServer中注册命令\" class=\"headerlink\" title=\"在ShellServer中注册命令\"></a>在 ShellServer 中注册命令</h3><p>ShellServer 是与命令行交互的服务端的核心类，启动 Arthas 服务端的整个过程（<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL21haW4vamF2YS9jb20vdGFvYmFvL2FydGhhcy9jb3JlL3NlcnZlci9BcnRoYXNCb290c3RyYXAuamF2YQ==\">com.taobao.arthas.core.server.ArthasBootstrap<i class=\"fa fa-external-link-alt\"></i></span> 类的 bind () 方法）都是围绕着 ShellServer 进行的。</p>\n<p>ShellServer 是开源项目 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2VjbGlwc2UtdmVydHgvdmVydC54\">vert.x<i class=\"fa fa-external-link-alt\"></i></span> 提供的，Arthas 仅在此之上进行了少量的二次开发。</p>\n<p>在<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL21haW4vamF2YS9jb20vdGFvYmFvL2FydGhhcy9jb3JlL3NlcnZlci9BcnRoYXNCb290c3RyYXAuamF2YQ==\"> ArthasBootstrap<i class=\"fa fa-external-link-alt\"></i></span>&nbsp;类的 bind () 方法中，首先通过一个自建的类 <code>BuiltinCommandPack</code> 来读取所有的命令类：</p>\n<p><img src=\"/images/2020/08/1597663881528.png\" alt=\"1597663881528\" loading=\"lazy\"></p>\n<p>而这个 <code>BuiltinCommandPack</code> 是怎样运转的呢？非常简单，仅仅是将一个个类添加到一个 list 里而已。</p>\n<p>见 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL21haW4vamF2YS9jb20vdGFvYmFvL2FydGhhcy9jb3JlL2NvbW1hbmQvQnVpbHRpbkNvbW1hbmRQYWNrLmphdmE=\">BuiltinCommandPack.java<i class=\"fa fa-external-link-alt\"></i></span>：</p>\n<p><img src=\"/images/2020/08/1597663968735.png\" alt=\"1597663968735\" loading=\"lazy\"></p>\n<p>接着将所有的 CommandResolver 都调用 ShellServer 的 registerCommandResolver () 方法注册进 ShellServer，整个命令注册的过程就完成了：</p>\n<p><img src=\"/images/2020/08/1597664133197.png\" alt=\"1597664133197\" loading=\"lazy\"></p>\n<h3 id=\"读取客户端的输入\"><a href=\"#读取客户端的输入\" class=\"headerlink\" title=\"读取客户端的输入\"></a>读取客户端的输入</h3><p>真正接收客户端输入的是 ShellServer 中注册的 TermServer，Arthas 默认注册了两个 TermServer：</p>\n<ul>\n<li>提供 Telnet 客户端的<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL21haW4vamF2YS9jb20vdGFvYmFvL2FydGhhcy9jb3JlL3NoZWxsL3Rlcm0vaW1wbC9UZWxuZXRUZXJtU2VydmVyLmphdmE=\"> TelnetTermServer<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li>提供 WebSocket 客户端的<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL21haW4vamF2YS9jb20vdGFvYmFvL2FydGhhcy9jb3JlL3NoZWxsL3Rlcm0vaW1wbC9IdHRwVGVybVNlcnZlci5qYXZh\"> HttpTermServer<i class=\"fa fa-external-link-alt\"></i></span></li>\n</ul>\n<p>见 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL21haW4vamF2YS9jb20vdGFvYmFvL2FydGhhcy9jb3JlL3NlcnZlci9BcnRoYXNCb290c3RyYXAuamF2YQ==\">ArthasBootstrap<i class=\"fa fa-external-link-alt\"></i></span> 类的 bind () 方法：</p>\n<p><img src=\"/images/2020/08/1597664402161.png\" alt=\"1597664402161\" loading=\"lazy\"></p>\n<p>这两个 TermServer 的实现在读取客户端输入的部分是一样的：</p>\n<p><img src=\"/images/2020/08/1597664489423.png\" alt=\"1597664489423\" loading=\"lazy\"></p>\n<p>客户端的输入到来时，通过 TermServer 来 handle，而这个 TermServer 是哪儿来的呢？是从<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL21haW4vamF2YS9jb20vdGFvYmFvL2FydGhhcy9jb3JlL3NoZWxsL3Rlcm0vaW1wbC9IdHRwVGVybVNlcnZlci5qYXZh\"> ShellServerImpl<i class=\"fa fa-external-link-alt\"></i></span> 中传来的 TermServerTermHandler。</p>\n<p>而这个<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL21haW4vamF2YS9jb20vdGFvYmFvL2FydGhhcy9jb3JlL3NoZWxsL2hhbmRsZXJzL3NlcnZlci9UZXJtU2VydmVyVGVybUhhbmRsZXIuamF2YQ==\"> TermServerTermHandler<i class=\"fa fa-external-link-alt\"></i></span>是怎样 handle 的呢？调用 ShellServer 的 handleTerm () 方法。</p>\n<p><img src=\"/images/2020/08/1597665051394.png\" alt=\"1597665051394\" loading=\"lazy\"></p>\n<p>在这里，一个 session 就是一个客户端的连接（这很容易理解），而 ShellImpl 的 readline () 方法，就是读取客户端输入的方法。见：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL21haW4vamF2YS9jb20vdGFvYmFvL2FydGhhcy9jb3JlL3NoZWxsL2ltcGwvU2hlbGxJbXBsLmphdmE=\">ShellImpl<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p><img src=\"/images/2020/08/1597665260376.png\" alt=\"1597665260376\" loading=\"lazy\"></p>\n<h3 id=\"查找对应的命令执行类\"><a href=\"#查找对应的命令执行类\" class=\"headerlink\" title=\"查找对应的命令执行类\"></a>查找对应的命令执行类</h3><p>ShellImpl 的 readline () 方法，最终将客户端的输入转换为 String，交给 ShellLineHandler 的 handle () 方法来处理。</p>\n<p>在<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL21haW4vamF2YS9jb20vdGFvYmFvL2FydGhhcy9jb3JlL3NoZWxsL2hhbmRsZXJzL3NoZWxsL1NoZWxsTGluZUhhbmRsZXIuamF2YQ==\"> ShellLineHandler<i class=\"fa fa-external-link-alt\"></i></span>的 handle () 方法中，首先把 String 类型的输入转换为第三方组件 CLI 中的 CliToken 的 List：</p>\n<p><img src=\"/images/2020/08/1597665436179.png\" alt=\"1597665436179\" loading=\"lazy\"></p>\n<p>在 List<clitoken> 中，first 是输入的命令，而剩余部分则是命令的参数。在拿到输入的命令后，先做一些判断，处理几个内建命令：</clitoken></p>\n<p><img src=\"/images/2020/08/1597665536086.png\" alt=\"1597665536086\" loading=\"lazy\"></p>\n<ul>\n<li>输入的是 exit、logout 或 quit，将会直接关闭客户端。</li>\n<li>输入的是 jobs，将会返回当前正在后台执行的异步任务。</li>\n<li>输入的是 fg，将会将暂停的异步任务拉到前台执行。</li>\n<li>输入的是 bg，将会将暂停的异步任务放到后台执行。</li>\n<li>输入的是 kill，将会强制终止所有<span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbGliYWJhLmdpdGh1Yi5pby9hcnRoYXMvYXN5bmMuaHRtbA==\">异步任务<i class=\"fa fa-external-link-alt\"></i></span>。</li>\n</ul>\n<p>如果输入的不是这些关键词，则开始创建 Job。</p>\n<p>创建 Job 又是一个非常绕的过程，从 ShellLineHandler.createJob () 走到 ShellImpl.createJob () 再走到 JobControllerImpl.createJob ()。</p>\n<p>见：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL21haW4vamF2YS9jb20vdGFvYmFvL2FydGhhcy9jb3JlL3NoZWxsL3N5c3RlbS9pbXBsL0pvYkNvbnRyb2xsZXJJbXBsLmphdmE=\">JobControllerImpl.java<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p><img src=\"/images/2020/08/1597665729558.png\" alt=\"1597665729558\" loading=\"lazy\"></p>\n<p>主要是调用 createProcess () 方法创建 Process，判断是在前台执行还是在后台执行，然后用 Process 生成 Job。</p>\n<p>核心的 createProcess () 方法：</p>\n<p><img src=\"/images/2020/08/1597665851789.png\" alt=\"1597665851789\" loading=\"lazy\"></p>\n<p>然后到了将输入路由到命令执行类的地方了！</p>\n<p>开始看<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL21haW4vamF2YS9jb20vdGFvYmFvL2FydGhhcy9jb3JlL3NoZWxsL3N5c3RlbS9pbXBsL0ludGVybmFsQ29tbWFuZE1hbmFnZXIuamF2YQ==\"> InternalCommandManager<i class=\"fa fa-external-link-alt\"></i></span>的 getCommand () 方法：</p>\n<p><img src=\"/images/2020/08/1597665933730.png\" alt=\"1597665933730\" loading=\"lazy\"></p>\n<p>到这里，根据客户端的输入寻找对应的命令执行类的整个流程终于结束了，接下来就是各个命令执行类自己发挥的时刻了。</p>\n<h3 id=\"help命令的执行过程\"><a href=\"#help命令的执行过程\" class=\"headerlink\" title=\"help命令的执行过程\"></a>help 命令的执行过程</h3><p>下面我以基础命令 help 为例，简要介绍命令执行类是如何执行，如何接收参数，以及如何向客户端返回数据的。</p>\n<p>help 命令对应的命令执行类是<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL21haW4vamF2YS9jb20vdGFvYmFvL2FydGhhcy9jb3JlL2NvbW1hbmQvYmFzaWMxMDAwL0hlbHBDb21tYW5kLmphdmE=\"> HelpCommand<i class=\"fa fa-external-link-alt\"></i></span>，其中 process () 方法是命令执行类的核心方法：</p>\n<p><img src=\"/images/2020/08/1597666134279.png\" alt=\"1597666134279\" loading=\"lazy\"></p>\n<p>可以看到，help 命令的 process () 方法非常简单，就是获取所有的命令，生成 String 类型的文本。</p>\n<p>不过这里有一点特殊之处，help 指令可以输入参数。根据参数中传来的命令生成的命令帮助内容。</p>\n<ul>\n<li>如果参数是空，返回 mainHelp () 方法生成的全局帮助内容</li>\n<li>如果参数不为空，则返回 commandHelp () 方法</li>\n</ul>\n<p>那么，help 指令是如何接收参数的呢？奥妙就在下面的这个方法里了：</p>\n<p><img src=\"/images/2020/08/1597666365077.png\" alt=\"1597666365077\" loading=\"lazy\"></p>\n<p>使用 @Argument 注解的方法用来接收参数，在这里就是把输入的内容放到 cmd 这个变量里，然后 findCommand () 方法去判断 cmd 变量的内容是否有命令与之相匹配：</p>\n<p><img src=\"/images/2020/08/1597666394962.png\" alt=\"1597666394962\" loading=\"lazy\"></p>\n<p>另外，输出到客户端的内容并不是简单的文本，而是通过淘宝的 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvdGV4dC11aQ==\">text-ui<i class=\"fa fa-external-link-alt\"></i></span> 包进行了排版。</p>\n<p>见 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFzL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL21haW4vamF2YS9jb20vdGFvYmFvL2FydGhhcy9jb3JlL2NvbW1hbmQvdmlldy9IZWxwVmlldy5qYXZh\">HelpView.java<i class=\"fa fa-external-link-alt\"></i></span>：</p>\n<p><img src=\"/images/2020/08/1597666484624.png\" alt=\"1597666484624\" loading=\"lazy\"></p>\n<h3 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h3><ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3M/X19iaXo9TXpVNE9EYzBPVGsyTmc9PSZtaWQ9MjI0NzQ4MzkwNyZpZHg9MSZzbj0wNmIwZGU1YjY0OTU1ZGZkMzlmNjA1YjZjMjJlMzMxZSZjaGtzbT1mZGQ5NGZlMmNhYWVjNmY0YzhlZmUzNjUzZWY0M2NhMzg3MzJlMGY4YTdjZWYwNjA5Nzg1ZGRkMjAzZDExZDM4ZjQ2NWJlZGZlYzdkJm1wc2hhcmU9MSZzY2VuZT0xJnNyY2lkPTA4MTVpY3NRYWtuVDNWMFRjcWNXZmR3UyZzaGFyZXJfc2hhcmV0aW1lPTE1OTc0MjExODkwMjEmc2hhcmVyX3NoYXJlaWQ9NDljNjExMjFmOTIwMDQ5MDJiZWNlYTcwNTcxNmNjYTcma2V5PWRlODc5ZDFkMDllMmE4YjcyODQ2ZjgzMDg5MDc1OGRhZjc2NzdkNGI4M2U5ZTViZmQ3OTIwYjBhZTY0N2U3MjRmZDkyYjIyODUyNTA0OWEyMDc2MjMwZWI2YzA1YWI2ZGZlZTE4MDI4NjUyZGZmOTFjOTI4OWU1M2JjNjk0OTYzNmM3ZGVhNGE4OTUzMzAzNjdmNmYyYzY0OTZjZTQ2N2ZjNDZmMGNiNzBlZWQ2ZDhiYmEyNjAzY2EwZTEwZWZkMzZlZDMyZWU3ZTM3NTYwMDEzYTgyNmI5NTc0YmZhYzM4MmE4NTY4MDZhMjg1NTMxOTRhN2E2ZjE4NjMxYjQzMDUmYXNjZW5lPTEmdWluPU1UZzBORGsxTlRjd01nPT0mZGV2aWNldHlwZT1XaW5kb3dzKzEwK3g2NCZ2ZXJzaW9uPTYyMDkwNTI5Jmxhbmc9emhfQ04mZXhwb3J0a2V5PUFkNXh6QU5jVmVNeDJ4T2s2Q3plajZFPSZwYXNzX3RpY2tldD12bXFmejVvZ1IxL3dnQXZqdXhraklxOWxwRGtzcnhVdDVEbEJPelhyZ0QyaXRSUEtBcE9zL3A4R3VybGx2Ynpv\">参考<i class=\"fa fa-external-link-alt\"></i></span></li>\n</ul>\n","categories":["Java","Arthas"],"tags":["Java","Java诊断","Arthas"]},{"title":"为博客新增评论系统","url":"/2020/08/2020-08-19-%E4%B8%BA%E5%8D%9A%E5%AE%A2%E6%96%B0%E5%A2%9E%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F/","content":"<h3 id=\"开启多个评论系统\"><a href=\"#开启多个评论系统\" class=\"headerlink\" title=\"开启多个评论系统\"></a>开启多个评论系统</h3><pre class=\"language-yml\" data-language=\"yml\"><code class=\"language-yml\">comments:\n  lazyload: false\n  active: gitalk\n  nav:\n    gitalk:\n      text: 登录 GitHub 评论\n      order: 1\n    valine:\n      text: 不登录进行评论\n      order: 2</code></pre>\n\n<h3 id=\"添加-Valine-评论系统\"><a href=\"#添加-Valine-评论系统\" class=\"headerlink\" title=\"添加 Valine 评论系统\"></a>添加 Valine 评论系统</h3><p>Valine 是基于 Leancloud 的快速，简单和高效的无后端评论系统。</p>\n<h4 id=\"注册\"><a href=\"#注册\" class=\"headerlink\" title=\"注册\"></a>注册</h4><p>创建一个帐户或登录 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWFuY2xvdWQuY24vZGFzaGJvYXJkL2xvZ2luLmh0bWwjL3NpZ25pbg==\">LeanCloud<i class=\"fa fa-external-link-alt\"></i></span>，然后单击左下角以<span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWFuY2xvdWQuY24vZGFzaGJvYXJkL2FwcGxpc3QuaHRtbCMvbmV3YXBw\">创建应用程序<i class=\"fa fa-external-link-alt\"></i></span>在<span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWFuY2xvdWQuY24vZGFzaGJvYXJkL2FwcGxpc3QuaHRtbCMvYXBwcw==\">仪表板中<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n<p>转到您刚创建的应用程序，<code>Settings → App Keys</code> 在左下角选择，您将看到您的 APP ID 和 APP Key。</p>\n<h4 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h4><p>将值设置 <code>enable</code> 为 <code>true</code>，添加获得的 APP ID（<code>appId</code>）和 APP Key（<code>appKey</code>），然后 <code>valine</code> 在主题配置文件 如下：</p>\n<pre class=\"language-none\"><code class=\"language-none\">valine:\n  enable: false\n  appId:  # your leancloud application appid\n  appKey:  # your leancloud application appkey\n  placeholder: Just go go # comment box placeholder\n  avatar: mm # gravatar style\n  meta: [nick, mail, link] # Custom comment header\n  pageSize: 10 # pagination size\n  visitor: false # leancloud-counter-security is not supported for now. When visitor is set to be true, appid and appkey are recommended to be the same as leancloud_visitors' for counter compatibility. Article reading statistic https://valine.js.org/visitor.html\n  comment_count: true # If false, comment count will only be displayed in post page, not in home page\n  recordIP: false # Whether to record the commenter IP\n  serverURLs: # When the custom domain name is enabled, fill it in here (it will be detected automatically by default, no need to fill in)</code></pre>\n\n<h4 id=\"评论效果\"><a href=\"#评论效果\" class=\"headerlink\" title=\"评论效果\"></a>评论效果</h4><p><img src=\"/images/2020/08/1597836434746.png\" alt=\"1597836434746\" loading=\"lazy\"></p>\n<h3 id=\"添加-Gitalk-评论系统\"><a href=\"#添加-Gitalk-评论系统\" class=\"headerlink\" title=\"添加 Gitalk 评论系统\"></a>添加 Gitalk 评论系统</h3><p>Gitalk 是一个基于 Github issues 的评论系统。使用之前需要确保你指定的 Github 仓库是公开的，并开启了 issues 功能。</p>\n<h4 id=\"注册-Gitalk\"><a href=\"#注册-Gitalk\" class=\"headerlink\" title=\"注册 Gitalk\"></a>注册 Gitalk</h4><p>首先，你需要注册一个新的 <strong>GitHub Application</strong> 来授权，点击<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NldHRpbmdzL2FwcGxpY2F0aW9ucy9uZXc=\">这里<i class=\"fa fa-external-link-alt\"></i></span>注册。这样可以获取所需的 <code>client ID</code> 和 <code>client secret</code>。</p>\n<p><img src=\"/images/2020/08/1597836162033.png\" alt=\"1597836162033\" loading=\"lazy\"></p>\n<p>注册成功后，可以在 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NldHRpbmdzL2RldmVsb3BlcnM=\">开发者页面<i class=\"fa fa-external-link-alt\"></i></span> 看到如下配置：</p>\n<p><img src=\"/images/2020/08/1597836277711.png\" alt=\"1597836277711\" loading=\"lazy\"></p>\n<h4 id=\"配置-1\"><a href=\"#配置-1\" class=\"headerlink\" title=\"配置\"></a>配置</h4><pre class=\"language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">gitalk</span><span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># 是否启用</span>\n  <span class=\"token key atrule\">enable</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token comment\"># Github 用户名</span>\n  <span class=\"token key atrule\">owner</span><span class=\"token punctuation\">:</span> Jueee\n  <span class=\"token comment\"># Github 仓库名（需要是公开的仓库）</span>\n  <span class=\"token key atrule\">repo</span><span class=\"token punctuation\">:</span> jueee<span class=\"token punctuation\">-</span>blog\n  <span class=\"token comment\"># Github 应用程序客户端 ID</span>\n  <span class=\"token key atrule\">clientID</span><span class=\"token punctuation\">:</span> e61b622bb2d41a9820db\n  <span class=\"token comment\"># Github 应用程序客户端密钥</span>\n  <span class=\"token key atrule\">clientSecret</span><span class=\"token punctuation\">:</span> 23dafd8976002c89a46d97d426ea8e5a253dba40\n  <span class=\"token comment\"># GitHub 仓库所有者和合作者，只有这些人可以初始化 Gitalk</span>\n  <span class=\"token key atrule\">admin</span><span class=\"token punctuation\">:</span> Jueee\n  <span class=\"token comment\"># 类似于 B 站的关灯模式</span>\n  <span class=\"token key atrule\">distractionFreeMode</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token comment\"># 如果你想让每一个参观你网站的人看到统一的语言，你可以在这里设置，</span>\n  <span class=\"token comment\"># 可选值：en, zh-CN, es-ES, fr, ru, zh-TW</span>\n  <span class=\"token key atrule\">language</span><span class=\"token punctuation\">:</span> zh<span class=\"token punctuation\">-</span>CN</code></pre>\n\n<p>如果你遇到了问题，请查看 Gitalk 的文档：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2dpdGFsay9naXRhbGslRTMlODAlODI=\">https://github.com/gitalk/gitalk。<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h4 id=\"评论效果-1\"><a href=\"#评论效果-1\" class=\"headerlink\" title=\"评论效果\"></a>评论效果</h4><p><img src=\"/images/2020/08/1597836674463.png\" alt=\"1597836674463\" loading=\"lazy\"></p>\n","categories":["Blog"],"tags":["Blog","HTML"]},{"title":"404","url":"//404.html","content":"<pre class=\"language-none\"><code class=\"language-none\">██╗  ██╗ ██████╗ ██╗  ██╗    ███╗   ██╗ ██████╗ ████████╗\n██║  ██║██╔═████╗██║  ██║    ████╗  ██║██╔═══██╗╚══██╔══╝\n███████║██║██╔██║███████║    ██╔██╗ ██║██║   ██║   ██║\n╚════██║████╔╝██║╚════██║    ██║╚██╗██║██║   ██║   ██║\n     ██║╚██████╔╝     ██║    ██║ ╚████║╚██████╔╝   ██║\n     ╚═╝ ╚═════╝      ╚═╝    ╚═╝  ╚═══╝ ╚═════╝    ╚═╝\n\n    ███████╗ ██████╗ ██╗   ██╗███╗   ██╗██████╗\n    ██╔════╝██╔═══██╗██║   ██║████╗  ██║██╔══██╗\n    █████╗  ██║   ██║██║   ██║██╔██╗ ██║██║  ██║\n    ██╔══╝  ██║   ██║██║   ██║██║╚██╗██║██║  ██║\n    ██║     ╚██████╔╝╚██████╔╝██║ ╚████║██████╔╝\n    ╚═╝      ╚═════╝  ╚═════╝ ╚═╝  ╚═══╝╚═════╝</code></pre>\n"},{"title":"所有分类","url":"/categories/index.html","content":""},{"title":"所有标签","url":"/tags/index.html","content":""},{"title":"阅读笔记合集","url":"/nodes/index.html","content":"<style>/* .link-grid-1 */\n\n.link-grid-1 .links-container {\n    margin: 0 auto;\n    text-align: center;\n    width: 100%;\n}\n\n.link-grid-1 .links-container::after {\n    content: \" \";\n    display: block;\n    clear: both;\n}\n\n.link-grid-1 .link-item {\n    display: block;\n    float: left;\n    width: 130px;\n    height: auto;\n    margin-bottom: 16px;\n    border-radius: 4px;\n    box-shadow: 0 2px 6px 0 rgba(0, 0, 0, .12);\n    background: #f5f5f5;\n    text-decoration: none;\n    border: none!important;\n    transition: transform .5s ease;\n}\n\n.link-grid-1 .link-item:link,\n.link-grid-1 .link-item:visited,\n.link-grid-1 .link-item:hover,\n.link-grid-1 .link-item:active,\n.link-grid-1 .link-item:focus {\n    text-decoration: none;\n}\n\n.link-grid-1 .link-item {\n    margin-left: 8px;\n    margin-right: 8px;\n}\n\n@media(max-width:567px) {\n    .link-grid-1 .link-item {\n        width: calc((100% - 32px) / 2);\n    }\n}\n\n@media(min-width:567px) {\n    .link-grid-1 .link-item {\n        width: calc((100% - 48px) / 3);\n    }\n}\n\n@media(min-width:768px) {\n    .link-grid-1 .link-item {\n        width: calc((100% - 64px) / 4);\n    }\n}\n\n@media(min-width:1200px) {\n    .link-grid-1 .link-item {\n        width: calc((100% - 80px) / 5);\n    }\n}\n\n.link-grid-1 .link-cover-container {\n    overflow: hidden;\n    width: 100%;\n    padding: 0;\n    border-top-left-radius: 4px;\n    border-top-right-radius: 4px;\n}\n\n.link-grid-1 .link-cover {\n    width: 100%;\n    height: auto;\n    padding-bottom: 100%;\n    background-size: 100% 100%!important;\n    background-position: 50% 50%;\n    background-size: cover;\n}\n\n.link-grid-1 .link-item:hover {\n    transform: scale(1.1);\n    box-shadow: 0 2px 6px 0 rgba(0, 0, 0, .12), 0 0 6px 0 rgba(0, 0, 0, .04);\n}\n\n.link-grid-1 .link-info {\n    padding-bottom: 0;\n    height: 52px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n\n.link-grid-1 .link-nickname p {\n    margin: 0;\n    padding: 10px 5px;\n    font-style: normal;\n    color: #2bbc8a;\n    font-weight: 700;\n    font-size: 16px;\n    line-height: 16px;\n    word-break: break-all;\n}\n\n.link-grid-1 .link-item:hover .link-nickname p {\n    color: #d480aa;\n}\n\n\n/* .link-grid-2 */\n\n.link-grid-2 .links-container {\n    margin: 0 auto;\n    text-align: center;\n    width: 100%;\n}\n\n.link-grid-2 .links-container::after {\n    content: \" \";\n    display: block;\n    clear: both;\n}\n\n.link-grid-2 .link-item {\n    display: block;\n    float: left;\n    width: 130px;\n    height: auto;\n    margin-bottom: 16px;\n    border-radius: 4px;\n    box-shadow: 2px 2px 6px 0 rgba(0, 0, 0, .12);\n    background: #f5f5f5;\n    text-decoration: none;\n    border: none!important;\n    transition: box-shadow .5s ease;\n}\n\n.link-grid-2 .link-item:link,\n.link-grid-2 .link-item:visited,\n.link-grid-2 .link-item:hover,\n.link-grid-2 .link-item:active,\n.link-grid-2 .link-item:focus {\n    text-decoration: none;\n}\n\n.link-grid-2 .link-item {\n    margin-left: 8px;\n    margin-right: 8px;\n}\n\n.link-grid-2 .link-cover-container {\n    width: 100%;\n    padding: 0;\n    border-top-left-radius: 4px;\n    border-top-right-radius: 4px;\n    position: relative;\n    overflow: hidden;\n}\n\n.link-grid-2 .link-cover {\n    width: 100%;\n    height: auto;\n    padding-bottom: 100%;\n    background-size: 100% 100%!important;\n    background-position: 50% 50%;\n    background-size: cover;\n    transition: transform .5s ease, filter .2s ease;\n}\n\n.link-grid-2 .link-item:hover {\n    box-shadow: 4px 4px 6px 0 rgba(0, 0, 0, .3);\n}\n\n.link-grid-2 .link-info {\n    padding-bottom: 0;\n    height: 52px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n\n.link-grid-2 .link-nickname p {\n    margin: 0;\n    padding: 10px 5px;\n    font-style: normal;\n    color: #2bbc8a;\n    font-weight: 700;\n    font-size: 16px;\n    line-height: 16px;\n    word-break: break-all;\n}\n\n.link-grid-2 .link-item:hover .link-nickname p {\n    color: #d480aa;\n}\n\n.link-grid-2 .link-intro {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    margin: 0;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    background-color: rgba(0, 0, 0, 0);\n    transition: background-color .5s ease;\n}\n\n.link-grid-2 .link-intro p {\n    margin: 0;\n    padding: 20px 16px;\n    font-size: 16px;\n    line-height: 16px;\n    overflow: hidden;\n    word-break: break-all;\n    opacity: 0;\n    color: #eee;\n    transform: translateY(20px);\n    -webkit-transform: translateY(20px);\n    transition: opacity .5s ease, transform .5s ease;\n}\n\n.link-grid-2 .link-item:hover .link-intro {\n    background-color: rgba(0, 0, 0, .5);\n}\n\n.link-grid-2 .link-item:hover .link-intro p {\n    transform: translateY(0px);\n    -webkit-transform: translateY(0px);\n    opacity: 1;\n}\n\n.link-grid-2 .link-item:hover .link-cover {\n    -webkit-transform: scale(1.05);\n    -moz-transform: scale(1.05);\n    transform: scale(1.05);\n    -webkit-filter: blur(4px);\n    -moz-filter: blur(4px);\n    filter: blur(4px);\n}\n\n@media(max-width:567px) {\n    .link-grid-2 .link-item {\n        width: calc((100% - 32px) / 2);\n    }\n}\n\n@media(min-width:567px) {\n    .link-grid-2 .link-item {\n        width: calc((100% - 48px) / 3);\n    }\n}\n\n@media(min-width:768px) {\n    .link-grid-2 .link-item {\n        width: calc((100% - 64px) / 4);\n    }\n}\n\n@media(min-width:1200px) {\n    .link-grid-2 .link-item {\n        width: calc((100% - 80px) / 5);\n    }\n    .link-grid-2 .link-intro p {\n        padding: 16px 12px;\n        font-size: 12px;\n        line-height: 12px;\n    }\n}\n\n\n/* .link-grid-3 */\n\n.link-grid-3 .links-container {\n    margin: 0 auto;\n    text-align: center;\n    width: 100%;\n}\n\n.link-grid-3 .link-item {\n    display: inline-block;\n    float: none;\n    width: 140px;\n    max-height: 180px;\n    min-height: 180px;\n    margin: 10px;\n    border-radius: 4px;\n    box-shadow: 2px 2px 6px 0 rgba(0, 0, 0, .12);\n    background-color: #f5f5f5;\n    text-align: center;\n    position: relative;\n    text-decoration: none;\n    border: none!important;\n    overflow: hidden;\n}\n\n.link-grid-3 .link-item:link,\n.link-grid-3 .link-item:visited,\n.link-grid-3 .link-item:hover,\n.link-grid-3 .link-item:active,\n.link-grid-3 .link-item:focus {\n    text-decoration: none;\n}\n\n.link-grid-3 .link-cover {\n    width: 100%;\n    height: auto;\n    padding-bottom: 100%;\n    background-size: 100% 100%!important;\n    transition: transform .5s ease, filter .5s ease;\n    background-position: 50% 50%;\n    background-size: cover;\n}\n\n.link-grid-3 .link-info {\n    margin: 0;\n    padding: 0;\n    width: 100%;\n    height: 140px;\n    position: absolute;\n    top: 140px;\n    background: #f5f5f5;\n    transition: top .5s ease-out;\n}\n\n.link-grid-3 .link-nickname p {\n    margin: 0;\n    padding: 10px 5px;\n    font-style: normal;\n    color: #2bbc8a;\n    font-weight: 700;\n    border: 0;\n    font-size: 16px;\n    line-height: 16px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n\n.link-grid-3 .link-item:hover {\n    box-shadow: 4px 4px 6px 0 rgba(0, 0, 0, .3);\n}\n\n.link-grid-3 .link-item:hover .link-info {\n    top: 40px;\n}\n\n.link-grid-3 .link-item:hover .link-info .link-nickname p {\n    color: #d480aa;\n    text-decoration: none;\n}\n\n.link-grid-3 .link-line {\n    width: 100%;\n    height: 4px;\n    background-color: #1fb554;\n}\n\n.link-grid-3 .link-intro {\n    height: 64px;\n    overflow: hidden;\n}\n\n.link-grid-3 .link-intro p {\n    margin: 0;\n    padding: 0 5px;\n    overflow: hidden;\n    font-size: 12px;\n}\n\n.link-grid-3 .link-tag {\n    margin: 0;\n    height: 36px;\n    background-color: #1d9d74;\n}\n\n.link-grid-3 .link-tag p {\n    margin: 0;\n    padding: 10px 5px;\n    font-style: normal;\n    color: #f5f5f5;\n    font-weight: 700;\n    border: 0;\n    font-size: 16px;\n    line-height: 16px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n\n\n/* .link-grid-4 */\n\n.link-grid-4 .links-container {\n    margin: 0 auto;\n    text-align: center;\n    width: 100%;\n}\n\n.link-grid-4 .link-item {\n    display: block;\n    width: 130px;\n    height: auto;\n    margin-bottom: 16px;\n    border-radius: 4px;\n    box-shadow: 2px 2px 6px 0 rgba(0, 0, 0, .12);\n    background: #f5f5f5;\n    text-decoration: none;\n    border: none!important;\n}\n\n.link-grid-4 .link-item:link,\n.link-grid-4 .link-item:visited,\n.link-grid-4 .link-item:hover,\n.link-grid-4 .link-item:active,\n.link-grid-4 .link-item:focus {\n    text-decoration: none;\n}\n\n.link-grid-4 .link-cover-container {\n    overflow: hidden;\n    width: 100%;\n    padding: 0;\n    border-top-left-radius: 4px;\n    border-top-right-radius: 4px;\n}\n\n.link-grid-4 .link-cover {\n    width: 100%;\n    height: auto;\n    padding-bottom: 100%;\n    background-size: 100% 100%!important;\n    background-position: 50% 50%;\n    background-size: cover;\n    transition: transform .5s ease;\n}\n\n.link-grid-4 .link-item:hover .link-cover {\n    transform: scale(1.1);\n}\n\n.link-grid-4 .link-info {\n    padding-bottom: 10px;\n}\n\n.link-grid-4 .link-nickname p {\n    margin: 0;\n    padding: 10px 5px;\n    font-style: normal;\n    color: #2bbc8a;\n    font-weight: 700;\n    font-size: 16px;\n    line-height: 16px;\n    word-break: break-all;\n}\n\n.link-grid-4 .link-item:hover .link-nickname p {\n    color: #d480aa;\n}\n\n.link-grid-4 .link-intro p {\n    margin: 0;\n    padding: 0 5px;\n    color: #2bbc8a;\n    font-size: 12px;\n}</style><h4 id=\"容器化相关笔记\"><a href=\"#容器化相关笔记\" class=\"headerlink\" title=\"容器化相关笔记\"></a>容器化相关笔记</h4><div class=\"link-grid\"><div class=\"link-grid-container\">\n<div class=\"link-grid-image\" style=\"background-image: url(/images/nodes/docker.jpg);\"></div>\n<p>docker 相关</p><p>docker 相关学习笔记</p>\n<a href=\"https://jueee.github.io/docker-doc/\"></a>\n</div><div class=\"link-grid-container\">\n<div class=\"link-grid-image\" style=\"background-image: url(/images/nodes/kubernetes.jpg);\"></div>\n<p>kubernetes 相关</p><p>kubernetes 相关学习笔记</p>\n<a href=\"https://jueee.github.io/kubernetes-doc/\"></a>\n</div></div>\n\n<h4 id=\"Java-相关笔记\"><a href=\"#Java-相关笔记\" class=\"headerlink\" title=\"Java 相关笔记\"></a>Java 相关笔记</h4><div class=\"link-grid\"><div class=\"link-grid-container\">\n<div class=\"link-grid-image\" style=\"background-image: url(/images/nodes/design-patterns.png);\"></div>\n<p>设计模式</p><p>《设计模式：可复用面向对象软件的基础》学习笔记</p>\n<a href=\"https://jueee.github.io/design-patterns/\"></a>\n</div><div class=\"link-grid-container\">\n<div class=\"link-grid-image\" style=\"background-image: url(/images/nodes/Effective-Java.png);\"></div>\n<p>Effective Java</p><p>《Effective Java 第三版》学习笔记</p>\n<a href=\"https://jueee.github.io/effective-Java/\"></a>\n</div><div class=\"link-grid-container\">\n<div class=\"link-grid-image\" style=\"background-image: url(/images/nodes/ConcurrencyWithJava.png);\"></div>\n<p>Java 并发编程</p><p>《精通 Java 并发编程（第 2 版 ）》学习笔记</p>\n<a href=\"https://jueee.github.io/ConcurrencyWithJava/\"></a>\n</div><div class=\"link-grid-container\">\n<div class=\"link-grid-image\" style=\"background-image: url(/images/nodes/JavaTestDrivenDev.png);\"></div>\n<p>Java 测试驱动开发</p><p>《Java 测试驱动开发》学习笔记</p>\n<a href=\"https://jueee.github.io/JavaTestDrivenDev/\"></a>\n</div><div class=\"link-grid-container\">\n<div class=\"link-grid-image\" style=\"background-image: url(/images/nodes/lambda.png);\"></div>\n<p>Java 8 函数式编程</p><p>《Java 8 函数式编程》学习笔记</p>\n<a href=\"https://jueee.github.io/Java8Lambdas/\"></a>\n</div><div class=\"link-grid-container\">\n<div class=\"link-grid-image\" style=\"background-image: url(/images/nodes/spring-boot.png);\"></div>\n<p>Spring Boot 实战</p><p>《 Spring Boot 实战（第 4 版）》 学习笔记</p>\n<a href=\"https://jueee.github.io/spring-boot-in-action/\"></a>\n</div></div>\n\n<h4 id=\"Spark-相关笔记\"><a href=\"#Spark-相关笔记\" class=\"headerlink\" title=\"Spark 相关笔记\"></a>Spark 相关笔记</h4><div class=\"link-grid\"><div class=\"link-grid-container\">\n<div class=\"link-grid-image\" style=\"background-image: url(/images/nodes/spark.png);\"></div>\n<p>Spark 大数据分析</p><p>《Spark 快速大数据分析》学习笔记</p>\n<a href=\"https://jueee.github.io/SparkFastDataAnalysis/\"></a>\n</div><div class=\"link-grid-container\">\n<div class=\"link-grid-image\" style=\"background-image: url(/images/nodes/scala.png);\"></div>\n<p>Scala 程序设计</p><p>《 Scala 程序设计（第 2 版）》学习笔记</p>\n<a href=\"https://jueee.github.io/ScalaProgramming/\"></a>\n</div></div>\n\n<h4 id=\"Python-相关笔记\"><a href=\"#Python-相关笔记\" class=\"headerlink\" title=\"Python 相关笔记\"></a>Python 相关笔记</h4><div class=\"link-grid\"><div class=\"link-grid-container\">\n<div class=\"link-grid-image\" style=\"background-image: url(/images/nodes/python.jpg);\"></div>\n<p>Python 标准库</p><p>《Python Standard Library》学习笔记</p>\n<a href=\"http://jueee.github.io/PythonStandardLibrary/\"></a>\n</div></div>"}]